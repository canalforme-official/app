<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Planning du jour</title>
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://mcusercontent.com/74abea872abd45d46efed5d41/images/20d3fcd8-43fc-852e-95b2-55ad6e8befe6.png">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Oswald:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Meta viewport to prevent zooming -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

  <style>
    /* Styles généraux */
    :root {
      /* Polices */
      --font-title: 'Oswald', sans-serif;
      --font-text: 'Lora', serif;
      
      /* Couleurs principales */
      --primary-color: #480607;
      --secondary-color: #FFA630;
      
      /* Dégradé piscine/aqua (bleu uniquement) */
      --pool-blue: #35767c;
      --pool-middle: #42464d;
      --gradient-pool: radial-gradient(circle, var(--pool-blue) 0%, var(--pool-middle) 100%);
      
      /* Dégradé femmes uniquement (violet uniquement) */
      --women-light: #ddace7;
      --women-middle: #9e6187;
      --gradient-women: radial-gradient(circle, var(--women-light) 0%, var(--women-middle) 100%);
      
      /* Couleurs spécifiques */
      --women-color: #E4A672;
      --pool-color: #78D1B6;
      
      /* Couleurs de fond */
      --background-main: #F5F5F5;
      --background-card: #FFFFFF;
      
      /* Couleurs de texte */
      --text-primary: #333333;
      --text-secondary: #666666;
      --text-tertiary: #555555;
      --text-light: #FFFFFF;
      
      /* Transparences primary */
      --primary-overlay: rgba(72, 6, 7, 0.95);
      --primary-light: rgba(72, 6, 7, 0.8);
      --primary-lighter: rgba(72, 6, 7, 0.5);
      
      /* Transparences secondary */
      --secondary-light: rgba(255, 166, 48, 0.75);
      --secondary-lighter: rgba(255, 166, 48, 0.7);
      
      /* Transparences spécifiques */
      --women-color-light: rgba(228, 166, 114, 0.3);
      --pool-color-light: rgba(120, 209, 182, 0.3);
      
      /* Ombres */
      --shadow-light: rgba(200, 200, 200, 0.3);
      --shadow-medium: rgba(150, 150, 150, 0.5);
      --shadow-dark: rgba(0, 0, 0, 0.4);
      
      /* États */
      --state-past: #aaaaaa;
      --overlay-light: rgba(255, 255, 255, 0.3);
      --overlay-lighter: rgba(255, 255, 255, 0.2);
    }
    body.planning-ramadan {
      --primary-color: #1a472a;
      --primary-overlay: rgba(26, 71, 42, 0.95);
      --primary-light: rgba(26, 71, 42, 0.85);
      --secondary-color: #c9a227;
      --secondary-light: rgba(201, 162, 39, 0.75);
      position: relative;
    }
    body.planning-ramadan::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      min-height: 100vh;
      z-index: 0;
      pointer-events: none;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/46685c10-b83c-7d4f-0cbd-4ead782d61a4.png');
      background-repeat: repeat;
      background-size: 40px 40px;
      background-position: 0 0;
      opacity: 0.04;
      filter: sepia(1) hue-rotate(335deg) saturate(2.5);
    }
    /* Contenu au-dessus du fond (sans toucher aux éléments en position: fixed/absolute) */
    body.planning-ramadan > #planningViewSwitcher,
    body.planning-ramadan > #dayOfWeek,
    body.planning-ramadan > #timeline {
      position: relative;
      z-index: 1;
    }
    /* Garder la date en haut à droite : ne pas écraser son position: absolute, seulement z-index */
    body.planning-ramadan > .date {
      z-index: 1;
    }
    #planningViewSwitcher { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; padding: 2px 0; margin: 0 0 2px 0; }
    #planningViewSwitcher button { padding: 8px 14px; border-radius: 8px; border: 1px solid var(--primary-color); background: var(--background-card); color: var(--primary-color); font-size: 0.9em; cursor: pointer; }
    #planningViewSwitcher button.active { background: var(--primary-color); color: var(--text-light); }
    #planningViewSwitcher button:not(.active):hover { background: var(--primary-lighter); color: #fff; }

    body {
      font-family: var(--font-text);
      background-color: var(--background-main);
      color: var(--text-primary);
      margin: 0;
      padding: 20px;
      scroll-behavior: smooth;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      overflow-x: visible;
      width: 100%;
      max-width: 100vw;
      box-sizing: border-box;
    }

    /* Images non sélectionnables */
    img {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    /* Exception pour les champs de texte et les zones éditables */
    input, textarea, [contenteditable] {
      user-select: text;
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
    }

    h1 {
      font-family: var(--font-title);
      color: var(--primary-color);
      font-size: 2.5em;
      margin: 0;
      padding: 20px 0 10px 0;
      position: relative;
      font-weight: 600;
      padding-left: 18px;
    }

    .date {
      font-family: var(--font-title);
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 1.4em;
      color: var(--primary-color);
      font-weight: 400;
    }

    /* Styles pour la timeline */
    .timeline {
      position: relative;
      width: 100%;
      max-width: 1000px;
      margin: 0;
      padding-left: 35px;
      box-sizing: border-box;
      overflow: visible;
    }

    .timeline.has-courses {
      display: block;
      margin-left: 15px;
    }

    .timeline:empty {
      border-left: none;
    }

    /* Nouveau style pour les jours sans cours */
    .timeline.no-courses {
      padding-left: 0;
    }

    .timeline-block {
      margin-bottom: 20px;
      position: relative;
      overflow: visible;
    }

    /* Styles de base pour le point (cours passés, à venir, sur le point de commencer) */
    .timeline-block::before {
      content: '';
      position: absolute;
      left: -35px; /* Décalé vers la droite par rapport à l'icône */
      top: calc(50% + 12px); /* Décalé vers le bas */
      width: 10px;
      height: 10px;
      background-color: var(--primary-color);
      border-radius: 50%;
      opacity: 1;
      transition: opacity 0.3s ease;
      pointer-events: none;
      transform: translate(calc(-50% - 3px), calc(-50% - 4px));
    }

    /* Animation pour les cours en cours : pulse + rotation (exagéré) */
    @keyframes rotate-icon {
      0% {
        transform: translate(-50%, -50%) rotate(0deg) scale(0.1); /* Très petit (3px) */
      }
      25% {
        transform: translate(-50%, -50%) rotate(90deg) scale(1.3); /* Plus grand que la taille normale (39px) */
      }
      50% {
        transform: translate(-50%, -50%) rotate(180deg) scale(1.3); /* Plus grand que la taille normale */
      }
      75% {
        transform: translate(-50%, -50%) rotate(270deg) scale(1.3); /* Plus grand que la taille normale */
      }
      100% {
        transform: translate(-50%, -50%) rotate(360deg) scale(0.1); /* Retour très petit (3px) */
      }
    }

    /* Application de l'animation pour les cours en cours */
    .timeline-block.current::before {
      left: -52px; /* Centre à -37px : -37px - 15px (rayon) = -52px */
      top: 50%;
      width: 30px;
      height: 30px;
      background-color: transparent;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/d983712e-5b70-9ebc-9696-6a677290a963.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      border-radius: 0;
      transform-origin: center center;
      animation: rotate-icon 3s cubic-bezier(0.4, 0, 0.2, 1) infinite;
    }

    /* Correction de la transparence pour le point des cours passés */
    .timeline-block.past::before {
      opacity: 0.5;
    }

    /* Les cours à venir et sur le point de démarrer gardent le point par défaut */

    .time {
      font-family: var(--font-title);
      font-size: 1.4em;
      color: rgba(72, 6, 7, 0.7);
      position: relative;
      top: 0;
      margin-left: 0;
      font-weight: 400;
    }

    /* Styles pour les blocs de cours */
    .course-block {
      position: relative;
      background-color: var(--background-card);
      padding: 20px 25px;
      border-radius: 15px;
      box-shadow: 0px 4px 15px var(--shadow-light);
      transition: all 0.3s ease;
      width: calc(100% - 20px);
      max-width: 950px;
      box-sizing: border-box;
      overflow: visible;
      margin: 0;
      min-height: 120px;
    }

    /* Styles pour le titre du cours */
    .course-title {
      font-family: var(--font-title);
      font-size: 1.5em;
      font-weight: 500;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      min-height: 40px; /* Hauteur minimale pour le titre sans logo */
    }

    .course-title h3 {
      margin: 0;
      padding: 0;
    }

    .course-title img {
      max-width: 150px;
      max-height: 55px;
      object-fit: contain;
      margin-bottom: 12px;
    }

    /* Styles pour le type de cours */
    .course-type {
      font-family: var(--font-title);
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 0.9em;
      font-weight: 500;
      padding: 4px 8px;
      border-radius: 4px;
      color: var(--primary-color);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Type de cours pour "100% Femmes" */
    .course-block.women-only {
      background-color: var(--women-color-light);
      position: relative;
    }

    /* Dégradé femmes - mais pas si c'est aussi piscine */
    .course-block.women-only:not(.piscine)::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--gradient-women) !important;
      opacity: 0.4;
      border-radius: 15px;
      pointer-events: none;
      z-index: 0;
    }

    .course-block.women-only .course-title,
    .course-block.women-only .course-coach,
    .course-block.women-only .countdown {
      position: relative;
      z-index: 1;
    }

    .course-block.women-only .course-type,
    .course-block.women-only .course-studio {
      z-index: 1;
    }

    /* Type de cours en blanc pour 100% femmes (sans piscine) */
    .course-block.women-only:not(.piscine) .course-type {
      color: var(--text-light);
    }

    /* Type de cours pour "Mixte" */
    .course-block.mixte .course-type {
      color: var(--primary-color);
    }

    /* Type de cours pour "Piscine" - priorité sur women-only */
    .course-block.piscine {
      background-color: var(--pool-color-light);
      position: relative;
    }

    .course-block.piscine::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--gradient-pool) !important;
      opacity: 0.4;
      border-radius: 15px;
      pointer-events: none;
      z-index: 0;
    }

    .course-block.piscine .course-title,
    .course-block.piscine .course-coach,
    .course-block.piscine .countdown {
      position: relative;
      z-index: 1;
    }

    .course-block.piscine .course-type,
    .course-block.piscine .course-studio {
      z-index: 1;
    }

    /* Type de cours en blanc pour piscine/aqua */
    .course-block.piscine .course-type {
      color: var(--text-light);
    }

    /* Cours passés */
    .course-block.past {
      opacity: 0.5;
      box-shadow: 0px 3px 10px var(--shadow-light);
      color: var(--state-past);
    }

    /* Titre des cours aqua/piscine passés - couleur plus foncée pour la lisibilité */
    .course-block.past.piscine .course-title h3,
    .course-block.past.piscine .course-title {
      color: var(--text-primary);
      opacity: 0.8;
    }

    /* Titre des cours 100% femmes passés - couleur plus foncée pour la lisibilité */
    .course-block.past.women-only:not(.piscine) .course-title h3,
    .course-block.past.women-only:not(.piscine) .course-title {
      color: var(--text-primary);
      opacity: 0.8;
    }

    /* Cours à venir */
    .course-block.upcoming {
      box-shadow: 0px 6px 15px var(--shadow-medium);
    }

    /* Cours qui vont bientôt démarrer */
    .course-block.starting-soon {
      font-size: 1.1em;
      padding: 20px 30px;
      animation: heartbeat-blink 1.5s ease-in-out infinite;
      box-shadow: 0px 6px 20px var(--shadow-dark);
    }

    .course-block.starting-soon.mixte {
      animation: heartbeat-blink 1.5s ease-in-out infinite, blink-mixte 1.5s ease-in-out infinite;
    }

    .course-block.starting-soon.women-only {
      animation: heartbeat-blink 1.5s ease-in-out infinite, blink-femmes 1.5s ease-in-out infinite;
      box-shadow: 0px 0px 15px 5px var(--women-color-light);
    }

    .course-block.women-only.starting-soon:not(.piscine)::before {
      opacity: 0.4;
    }

    /* Cours en cours */
    .course-block.current {
      font-size: 1.1em;
      padding: 20px 30px;
      box-shadow: 0px 6px 20px var(--shadow-dark);
    }

    .course-block.current.mixte {
      background-color: var(--background-card);
      color: var(--text-primary);
    }

    .course-block.current.women-only:not(.piscine) {
      background-color: var(--women-color-light);
      color: var(--text-primary);
      box-shadow: 0px 0px 15px 5px var(--women-color-light);
    }

    /* RÈGLE CRITIQUE : Dégradé rose pour les cours 100% femmes en cours (sans piscine) - PRIORITÉ MAXIMALE */
    .course-block.current.women-only:not(.piscine)::before,
    .course-block.women-only.current:not(.piscine)::before {
      background: var(--gradient-women) !important;
      opacity: 0.4 !important;
    }

    /* RÈGLE CRITIQUE : Dégradé bleu pour les cours piscine en cours - PRIORITÉ MAXIMALE (même si aussi women-only) */
    .course-block.piscine.current::before,
    .course-block.current.piscine::before,
    .course-block.piscine.current.women-only::before,
    .course-block.current.piscine.women-only::before,
    .course-block.women-only.piscine.current::before,
    .course-block.women-only.current.piscine::before {
      background: var(--gradient-pool) !important;
      opacity: 0.4 !important;
    }

    /* Animation pour le rebond */
    @keyframes heartbeat-blink {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.01); }
    }

    /* Clignotement pour les cours mixtes */
    @keyframes blink-mixte {
      0%, 100% { background-color: var(--background-card); }
      50% { background-color: rgba(255, 255, 255, 0.9); }
    }

    /* Clignotement pour les cours "100% Femmes" */
    @keyframes blink-femmes {
      0%, 100% { background-color: var(--background-card); }
      50% { background-color: rgba(228, 166, 114, 0.2); }
    }

    .course-coach {
      font-size: 1em;
      color: var(--text-secondary);
      margin-bottom: 5px;
    }

    /* Noms des coachs en blanc pour piscine/aqua */
    .course-block.piscine .course-coach {
      color: var(--text-light);
    }

    /* Noms des coachs en blanc pour 100% femmes (sans piscine) */
    .course-block.women-only:not(.piscine) .course-coach {
      color: var(--text-light);
    }

    .course-studio {
      position: absolute;
      bottom: 0;
      right: 10px;
      z-index: 10;
    }

    .course-studio img {
      width: 68px;
      height: 68px;
      object-fit: contain;
      margin: 0;
      display: block;
    }

    /* Styles pour le compte à rebours */
    .countdown {
      font-family: var(--font-title);
      position: absolute;
      bottom: -20px; /* Compenser le padding-bottom de 20px du course-block */
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.9em;
      font-weight: 500;
      color: var(--primary-color);
      background: none;
      padding: 4px 8px;
      text-transform: uppercase;
      text-align: center;
      width: auto;
      white-space: nowrap;
    }

    .focus {
      scroll-margin-top: 50px;
    }

    .logo {
      text-align: center;
      margin-top: 40px;
    }

    .logo img {
      width: 25%;
    }

    /* Styles pour les boutons de navigation */
    .navigation {
      position: fixed;
      top: 50%;
      left: 10px;
      right: 10px;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
      z-index: 1000;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: none; /* Caché par défaut */
    }

    .navigation.loaded {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }

    .nav-button {
      background: rgba(255, 255, 255, 0.35);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      pointer-events: all;
      outline: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      backdrop-filter: blur(10px);
    }

    .nav-segments {
      position: relative;
      width: 20px;
      height: 20px;
    }

    .segment {
      position: absolute;
      background: var(--primary-color);
      border-radius: 1px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Segments pour le bouton précédent */
    .prev-button .segment-1 {
      width: 16px;
      height: 3px;
      top: 8px;
      right: 1px;
      transform: rotate(45deg);
      transform-origin: left center;
    }

    .prev-button .segment-2 {
      width: 16px;
      height: 3px;
      top: 10px;
      right: 1px;
      transform: rotate(-45deg);
      transform-origin: left center;
    }

    /* Segments pour le bouton suivant */
    .next-button .segment-1 {
      width: 16px;
      height: 3px;
      top: 8px;
      left: 1px;
      transform: rotate(-45deg);
      transform-origin: right center;
    }

    .next-button .segment-2 {
      width: 16px;
      height: 3px;
      top: 10px;
      left: 1px;
      transform: rotate(45deg);
      transform-origin: right center;
    }

    /* Effets hover pour les boutons avec segments */
    @media (hover: hover) {
      .nav-button:hover {
        background: var(--primary-color);
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .nav-button:hover .segment {
        background: white;
      }
    }

    /* Effet actif */
    .nav-button:active {
      transform: scale(0.95);
    }

    .nav-button:disabled {
      visibility: hidden;
    }

    @media screen and (min-width: 1025px) {
      .navigation {
        display: none;
      }
      
      .daily-grid-view-button {
        display: none;
      }
      
      .weekly-view-button {
        display: none;
      }
    }

    /* Overlay de chargement */
    #loadingOverlay {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      background-color: var(--primary-overlay) !important;
      z-index: 999999 !important;
      display: flex;
      overflow: hidden !important;
      pointer-events: all !important;
      opacity: 1 !important;
      transition: opacity 0.5s ease;
    }

    #loadingOverlay.fade-out {
      opacity: 0 !important;
    }

    /* Style du message de chargement */
    #loadingMessage {
      font-size: 1.2em !important;
      color: var(--text-light) !important;
      text-align: center !important;
      width: 80% !important;
      max-width: 600px !important;
      background-color: var(--overlay-light) !important;
      padding: 10px !important;
      border-radius: 10px !important;
      pointer-events: none !important;
      margin-top: -15px !important;
    }

    /* Logo animé lors du chargement */
    .loading-logo {
      display: flex;
      justify-content: center;
      align-items: center;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(calc(-50% - 3px), calc(-50% - 4px));
    }

    .loading-logo img {
      width: 80px;
      height: auto;
      animation: zoom-logo 2s ease-in-out infinite;
    }

    .loading-logo img {
      width: 80px;
      height: auto;
      animation: zoom-logo 2s ease-in-out infinite;
    }

    @keyframes zoom-logo {
      0% {
        transform: scale(1);
        opacity: 0.9;
      }
      50% {
        transform: scale(1.05);
        opacity: 1;
      }
      100% {
        transform: scale(1);
        opacity: 0.9;
      }
    }

    @keyframes zoomPulse {
      0%, 80% {
        transform: translate(-50%, -50%) scale(1);
      }
      50% {
        transform: translate(-50%, -50%) scale(1.1);
      }
    }

    /* Styles spécifiques aux cours du studio "Piscine" */
    .course-block.piscine {
      background-color: var(--pool-color-light);
    }

    /* Styles pour les cours en cours dans "Piscine" - garder le background et le dégradé bleu */
    .course-block.piscine.current {
      background-color: var(--pool-color-light);
    }

    .course-block.piscine.starting-soon {
      animation: heartbeat-blink 1.5s ease-in-out infinite, blink-piscine 1.5s ease-in-out infinite;
    }

    /* Animation pour le clignotement des cours "Piscine" */
    @keyframes blink-piscine {
      0%, 100% { 
        background-color: var(--pool-color-light);
      }
      50% { 
        background-color: rgba(120, 209, 182, 0.2);
      }
    }

    /* Styles pour les appareils mobiles */
    @media screen and (max-width: 1024px) {
      body {
        padding: 10px 15px;
        overflow-x: hidden;
      }

      .timeline {
        padding-left: 35px;
      }

      .timeline.has-courses {
        margin-left: 15px;
      }

      .timeline-block::before {
        left: -35px; /* Même position que la règle de base */
      }
      
      .timeline-block.current::before {
        left: -52px; /* L'icône garde sa position originale */
      }

      .time {
        margin-left: 0;
      }

      .timeline-block .time {
        margin-left: 0;
      }

      .course-block {
        width: calc(100% - 20px);
        margin: 0;
      }

      .course-block.past .course-title,
      .course-block.upcoming .course-title {
        font-size: 1.2em;
      }

      .course-block.current .course-title,
      .course-block.starting-soon .course-title {
        font-size: 1.3em;
      }

      .course-coach {
        font-size: 0.9em;
      }

      .course-studio img {
        width: 56px;
        height: 56px;
      }

      .logo img {
        width: 50%;
        max-height: 80px;
        height: auto;
      }

      .navigation {
        display: flex;
      }

      .daily-grid-view-button {
        display: block;
        opacity: 1;
        transform: translateY(0);
        pointer-events: all;
      }
      
      .weekly-view-button {
        display: block;
        opacity: 1;
        transform: translateY(0);
        pointer-events: all;
      }
    }

    .coach-images {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      align-items: center;
    }

    .coach-item {
      display: flex;
      align-items: center;
    }

    .coach-item.single {
      margin-right: 10px;
    }

    .coach-photo {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      margin-right: 5px;
    }

    .coach-photo.multiple {
      width: 35px;
      height: 35px;
      margin-right: 0;
    }

    .course-coach img {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      vertical-align: middle;
      margin-right: 10px;
    }

    /* Style pour le bouton daily-grid-view */
    .daily-grid-view-button {
      position: fixed;
      top: 50px;
      right: 10px;
      z-index: 1000;
      background: none;
      padding: 0;
      width: 60px;
      height: 60px;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      pointer-events: none;
      display: none;
    }

    @keyframes subtle-zoom-grid {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.08);
      }
    }

    .daily-grid-view-button.loaded {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
      animation: subtle-zoom-grid 6s ease-in-out infinite;
    }

    .daily-grid-view-button::before {
      content: '';
      position: absolute;
      width: 60px;
      height: 60px;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/fb81e2ef-51c6-9062-55f8-2f317e6974da.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      transform-origin: center;
      pointer-events: none;
    }

    .daily-grid-view-button::after {
      content: '1';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(calc(-50% - 1px), calc(-50% - 2px));
      font-family: var(--font-title);
      font-size: 1.8em;
      font-weight: 600;
      color: #8dceb9;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      pointer-events: none;
      z-index: 2;
    }

    .daily-grid-view-button a {
      z-index: 3;
      width: 100%;
      height: 100%;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      outline: none;
      pointer-events: all;
    }

    .daily-grid-view-button img {
      display: none;
    }

    /* Style pour le bouton daily-grid-view */
    .daily-grid-view-button {
      position: fixed;
      top: 50px;
      right: 10px;
      z-index: 1000;
      background: none;
      padding: 0;
      width: 60px;
      height: 60px;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      pointer-events: none;
      display: none;
    }

    @keyframes subtle-zoom-grid {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.08);
      }
    }

    .daily-grid-view-button.loaded {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
      animation: subtle-zoom-grid 6s ease-in-out infinite;
    }

    .daily-grid-view-button::before {
      content: '';
      position: absolute;
      width: 60px;
      height: 60px;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/fb81e2ef-51c6-9062-55f8-2f317e6974da.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      transform-origin: center;
      pointer-events: none;
    }

    .daily-grid-view-button::after {
      content: '1';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(calc(-50% - 1px), calc(-50% - 2px));
      font-family: var(--font-title);
      font-size: 1.8em;
      font-weight: 600;
      color: #8dceb9;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      pointer-events: none;
      z-index: 2;
    }

    .daily-grid-view-button a {
      z-index: 3;
      width: 100%;
      height: 100%;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      outline: none;
      pointer-events: all;
    }

    .daily-grid-view-button img {
      display: none;
    }

    /* Style pour le bouton weekly-view */
    .weekly-view-button {
      position: fixed;
      top: 130px;
      right: 10px;
      z-index: 1000;
      background: none;
      padding: 0;
      width: 60px;
      height: 60px;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      pointer-events: none;
      display: none;
    }

    @keyframes subtle-zoom {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.08);
      }
    }

    .weekly-view-button.loaded {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
      animation: subtle-zoom 6s ease-in-out infinite;
    }

    .weekly-view-button::before {
      content: '';
      position: absolute;
      width: 60px;
      height: 60px;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/eb3b6e4d-5f0f-8674-90ee-871bf873cc0e.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      transform-origin: center;
      pointer-events: none;
    }

    .weekly-view-button::after {
      content: '7';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, calc(-50% - 2px));
      font-family: var(--font-title);
      font-size: 1.8em;
      font-weight: 600;
      color: var(--secondary-color);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      pointer-events: none;
      z-index: 2;
    }

    .weekly-view-button a {
      z-index: 3;
      width: 100%;
      height: 100%;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      outline: none;
      pointer-events: all;
    }

    .weekly-view-button img {
      display: none;
    }

    /* Style pour le bouton today-view */
    .today-view-button {
      position: fixed;
      top: 55px;
      right: 10px;
      z-index: 1000;
      background: none;
      padding: 0;
      width: 55px;
      height: 55px;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      pointer-events: none;
      animation: none;
      display: none;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .today-view-button.visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }

    .today-view-button::before {
      content: '';
      position: absolute;
      width: 55px;
      height: 55px;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/d983712e-5b70-9ebc-9696-6a677290a963.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      animation: rotate-icon 6s cubic-bezier(0.4, 0, 0.2, 1) infinite;
      transform-origin: center;
      pointer-events: none;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      -webkit-transform-style: preserve-3d;
      transform-style: preserve-3d;
      will-change: transform;
    }

    .today-view-button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      background-color: var(--background-main);
      border-radius: 50%;
      box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      pointer-events: none;
      z-index: 2;
    }

    .today-view-button button {
      z-index: 3;
      width: 100%;
      height: 100%;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      outline: none;
      pointer-events: all;
    }

    @keyframes rotate-icon {
      0% {
        transform: rotate(0deg);
      }
      50% {
        transform: rotate(180deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    @keyframes auraPulse {
      0%, 100% {
        box-shadow: 0 0 15px var(--overlay-light), 0 0 30px var(--overlay-lighter), 0 0 45px var(--overlay-lighter);
      }
      5% {
        box-shadow: 0 0 25px var(--overlay-lighter), 0 0 40px var(--overlay-lighter), 0 0 55px var(--overlay-lighter);
      }
      10% {
        box-shadow: 0 0 15px var(--overlay-light), 0 0 30px var(--overlay-lighter), 0 0 45px var(--overlay-lighter);
      }
      15%, 100% {
        box-shadow: 0 0 15px var(--overlay-light), 0 0 30px var(--overlay-lighter), 0 0 45px var(--overlay-lighter);
      }
    }

    .sticky-day-name {
      font-family: var(--font-title);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      margin: auto;
      width: 80%;
      max-width:200px;
      padding: 10px;
      background-color: var(--overlay-light);
      backdrop-filter: blur(5px);
      border-radius: 10px;
      text-align: center;
      font-size: 1.7em;
      font-weight: 500;
      color: var(--primary-color);
      box-shadow: 0 2px 5px var(--shadow-light);
      z-index: 1000;
      opacity: 0;
      transform: translateY(-100%);
      transition: opacity 0.3s ease, transform 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .sticky-day-name .day-name {
      font-size: 1em;
      font-weight: 500;
      line-height: 1.2;
    }

    .sticky-day-name .day-date {
      font-size: 0.5em;
      font-weight: 300;
      color: var(--text-secondary);
      opacity: 0.7;
      line-height: 1.2;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Style pour le texte en tant que citation */
    .quote-text {
      font-family: var(--font-text);
      font-size: 1.4em;
      color: var(--primary-color);
      line-height: 1.6em;
      position: relative;
      padding: 20px;
      display: inline-block;
      font-style: italic;
    }

    .quote-text::before,
    .quote-text::after {
      content: '';
      position: absolute;
      font-size: 2.5em;
      color: var(--secondary-color);
      font-weight: bold;
      line-height: 1;
      opacity: 0.8;
      z-index: 1;
    }

    .quote-text::before {
      content: '«';
      left: -10px;
      top: -10px;
    }

    .quote-text::after {
      content: '»';
      right: -10px;
      bottom: -10px;
      top: auto;
      line-height: 0;
    }

    .modal-backdrop {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      background-color: var(--primary-overlay) !important;
      z-index: 999999 !important;
      display: none;
      overflow: hidden !important;
      pointer-events: all !important;
    }

    .timeline-container {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .timeline-line {
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: var(--primary-color);
      transform: translateX(-50%);
    }

    .time-marker {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      color: var(--primary-color);
      font-weight: bold;
    }

    .time-marker.start {
      top: 0;
    }

    .time-marker.end {
      bottom: 0;
    }

    /* Style par défaut pour mobile */
    .modal-center-container img {
      width: 100px !important;
      height: auto !important;
      animation: zoom-logo 2s infinite !important;
      pointer-events: none !important;
    }

    /* Style pour tablettes */
    @media screen and (min-width: 768px) {
      .modal-center-container img {
        width: 140px !important;
      }
    }

    /* Style pour desktop */
    @media screen and (min-width: 1024px) {
      .modal-center-container img {
        width: 170px !important;
      }
    }

    /* Styles pour le bouton weekly-view */
    .daily-grid-view-button {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .daily-grid-view-button.loaded {
      opacity: 1;
      transform: translateY(0);
    }

    .weekly-view-button {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .weekly-view-button.loaded {
      opacity: 1;
      transform: translateY(0);
    }

    /* Animation d'apparition du contenu */
    .content-wrapper {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    body:not(.loading) .content-wrapper {
      opacity: 1;
      transform: translateY(0);
    }

    /* Styles pour l'overlay de chargement */
    #loadingOverlay {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      background-color: var(--primary-overlay) !important;
      z-index: 999999 !important;
      display: flex;
      overflow: hidden !important;
      pointer-events: all !important;
      opacity: 1 !important;
      transition: opacity 0.5s ease;
    }

    #loadingOverlay.fade-out {
      opacity: 0 !important;
    }

    .modal-center-container {
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
      width: auto !important;
      height: auto !important;
      pointer-events: none !important;
      gap: 50px !important;
      background-color: transparent !important;
    }

    .upcoming-class {
      position: relative;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      animation: subtlePulse 5s ease-in-out infinite;
    }

    @keyframes subtlePulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 rgba(255, 255, 255, 0.03);
      }
      50% {
        transform: scale(1.001);
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.05);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 rgba(255, 255, 255, 0.03);
      }
    }

    /* Désactivation temporaire de l'overlay de chargement pour mobile uniquement */
    @media screen and (max-width: 768px) {
      #loadingOverlay {
        display: none !important;
      }
      
      body.loading {
        opacity: 1 !important;
      }
      
      .modal-center-container {
        display: none !important;
      }
    }

    @media (min-width: 768px) {
      .loading-logo img {
        width: 100px;
      }
    }

    @media (min-width: 1024px) {
      .loading-logo img {
        width: 140px;
      }
    }

  </style>
</head>
<body onload="initializePage();" class="loading">
  <!-- Bloc de texte collant pour le nom du jour -->
  <div id="stickyDayName" class="sticky-day-name">
    <span class="day-name"></span>
    <span class="day-date"></span>
  </div>

  <!-- Bouton Daily Grid view -->
  <div class="daily-grid-view-button">
    <a href="./daily_grid.html">
      <img src="https://mcusercontent.com/74abea872abd45d46efed5d41/images/fb81e2ef-51c6-9062-55f8-2f317e6974da.png" alt="Vue Grille">
    </a>
  </div>

  <!-- Bouton Weekly view -->
  <div class="weekly-view-button">
    <a href="./weekly_vertical.html">
      <img src="https://mcusercontent.com/74abea872abd45d46efed5d41/images/8f9d5808-3db0-84ba-a4c9-24d99ec7043b.png" alt="Vue Hebdomadaire">
    </a>
  </div>

  <!-- Bouton pour revenir à aujourd'hui -->
  <div class="today-view-button" id="todayViewButton">
    <button onclick="returnToToday()">
    </button>
  </div>

  <!-- Boutons de navigation -->
  <div class="navigation">
    <button id="prevDay" onclick="changeDay(-1)" class="nav-button prev-button">
      <div class="nav-segments">
        <div class="segment segment-1"></div>
        <div class="segment segment-2"></div>
      </div>
    </button>
    <button id="nextDay" onclick="changeDay(1)" class="nav-button next-button">
      <div class="nav-segments">
        <div class="segment segment-1"></div>
        <div class="segment segment-2"></div>
      </div>
    </button>
  </div>

  <h1 id="dayOfWeek"></h1>
  <div class="date" id="dateStr"></div>
  <div id="planningViewSwitcher" style="display: none;"></div>
  <div class="timeline" id="timeline">
    <!-- Les cours seront injectés ici -->
  </div>

  <!-- Overlay de chargement -->
  <div id="loadingOverlay">
    <div class="modal-center-container">
      <img src="https://mcusercontent.com/74abea872abd45d46efed5d41/images/8fd797c9-5e06-60a8-1720-128bcf9390cf.png" alt="Logo du Club">
    </div>
  </div>

  <script>
    let currentDayIndex = new Date().getDay();
  const apiUrl = 'https://raw.githubusercontent.com/canalforme-official/app-data/main/planning-v2.json';
  //const apiUrl = './planning-v2.json';
    let allData = [];
    var activePlanningView = 'regulier';
    function getCurrentPlanning() {
      if (!allData || !allData.planning) return {};
      if (activePlanningView === 'ramadan' && allData.planningRamadan) {
        var pr = allData.planningRamadan;
        var hasCourses = Object.keys(pr).some(function(day) { return pr[day] && pr[day].length > 0; });
        if (hasCourses) return pr;
      }
      return allData.planning;
    }
    function initPlanningView(data) {
      var params = new URLSearchParams(window.location.search);
      var urlView = params.get('planning');
      var stored = localStorage.getItem('planningView');
      var today = new Date().toISOString().slice(0, 10);
      var ramadanStart = data.metadata && data.metadata.ramadanStart;
      var ramadanEnd = data.metadata && data.metadata.ramadanEnd;
      var inRamadan = ramadanStart && ramadanEnd && today >= ramadanStart && today <= ramadanEnd;
      if (urlView === 'ramadan' || urlView === 'regulier') { activePlanningView = urlView; localStorage.setItem('planningView', urlView); }
      else if (stored === 'ramadan' || stored === 'regulier') { activePlanningView = stored; }
      else if (inRamadan) { activePlanningView = 'ramadan'; localStorage.setItem('planningView', 'ramadan'); }
      else { activePlanningView = 'regulier'; localStorage.setItem('planningView', 'regulier'); }
      document.body.classList.toggle('planning-ramadan', activePlanningView === 'ramadan');
    }
    function renderPlanningViewSwitcher(data) {
      var container = document.getElementById('planningViewSwitcher');
      if (!container) return;
      var meta = data.metadata || {};
      var ramadanStart = meta.ramadanStart, ramadanEnd = meta.ramadanEnd;
      var today = new Date().toISOString().slice(0, 10);
      var inRamadan = ramadanStart && ramadanEnd && today >= ramadanStart && today <= ramadanEnd;
      var daysBefore = 7;
      var showSwitcher = (data.planningRamadan && ramadanStart) && (inRamadan || (today < ramadanStart && (new Date(ramadanStart) - new Date(today)) / (24*60*60*1000) <= daysBefore));
      if (!showSwitcher) { container.style.display = 'none'; container.innerHTML = ''; return; }
      container.innerHTML = '';
      var btn = document.createElement('button');
      if (activePlanningView === 'ramadan') { btn.textContent = 'Voir planning régulier'; btn.classList.add('active'); btn.onclick = function() { setPlanningView('regulier'); }; }
      else { var dateDebut = ramadanStart ? (function(s) { var p = s.split('-'); if (p.length !== 3) return ''; var mois = ['janvier','février','mars','avril','mai','juin','juillet','août','septembre','octobre','novembre','décembre']; return p[2] + ' ' + (mois[parseInt(p[1],10)-1] || ''); })(ramadanStart) : ''; btn.textContent = inRamadan ? 'Voir planning Ramadan' : 'Voir planning Ramadan' + (dateDebut ? ' (' + dateDebut + ')' : ' (à venir)'); btn.onclick = function() { setPlanningView('ramadan'); }; }
      container.appendChild(btn);
      container.style.display = 'flex';
    }
    function setPlanningView(view) {
      activePlanningView = view;
      localStorage.setItem('planningView', view);
      document.body.classList.toggle('planning-ramadan', view === 'ramadan');
      displaySchedule(currentDayIndex);
      renderPlanningViewSwitcher(allData);
    }

    // Option pour afficher/masquer les images des cours
    const SHOW_COURSE_IMAGES = true; // Mettre à true pour afficher les images, false pour n'afficher que les noms

    function updateTodayButtonPosition() {
      const weeklyButton = document.querySelector('.weekly-view-button');
      const todayButton = document.querySelector('.today-view-button');
      
      if (weeklyButton && todayButton && todayButton.style.display !== 'none') {
        const weeklyButtonRect = weeklyButton.getBoundingClientRect();
        const spacing = 15;
        todayButton.style.top = `${weeklyButtonRect.bottom + spacing}px`;
      }
    }

    function handleResize() {
      const isMobile = window.innerWidth <= 1024;
      const dailyGridButton = document.querySelector('.daily-grid-view-button');
      const weeklyButton = document.querySelector('.weekly-view-button');
      const todayButton = document.querySelector('.today-view-button');
      const navigation = document.querySelector('.navigation');
      
      if (isMobile) {
        if (dailyGridButton) {
          dailyGridButton.style.display = 'block';
          dailyGridButton.classList.add('loaded');
        }
        if (weeklyButton) {
          weeklyButton.style.display = 'block';
          weeklyButton.classList.add('loaded');
        }
        if (todayButton) {
          todayButton.style.display = 'block';
        }
        if (navigation) {
          navigation.style.display = 'flex';
        }
      } else {
        if (dailyGridButton) {
          dailyGridButton.style.display = 'none';
          dailyGridButton.classList.remove('loaded');
        }
        if (weeklyButton) {
          weeklyButton.style.display = 'none';
          weeklyButton.classList.remove('loaded');
        }
        if (todayButton) {
          todayButton.style.display = 'none';
          todayButton.classList.remove('visible');
        }
        if (navigation) {
          navigation.style.display = 'none';
        }
      }
      
      updateTodayButtonPosition();
    }

    function hideLoadingOverlay() {
      const loadingOverlay = document.getElementById('loadingOverlay');
      const modalContainer = document.querySelector('.modal-center-container');

      if (modalContainer) {
        modalContainer.style.display = 'none';
      }

      loadingOverlay.classList.add('fade-out');

      const isMobile = window.innerWidth <= 1024;
      const navigation = document.querySelector('.navigation');
      const dailyGridButton = document.querySelector('.daily-grid-view-button');
      const weeklyButton = document.querySelector('.weekly-view-button');
      
      if (isMobile) {
        if (navigation) navigation.classList.add('loaded');
        if (dailyGridButton) {
          dailyGridButton.classList.add('loaded');
          dailyGridButton.style.opacity = '1';
          dailyGridButton.style.transform = 'translateY(0)';
          dailyGridButton.style.pointerEvents = 'all';
        }
        if (weeklyButton) {
          weeklyButton.classList.add('loaded');
          weeklyButton.style.opacity = '1';
          weeklyButton.style.transform = 'translateY(0)';
          weeklyButton.style.pointerEvents = 'all';
        }
      }

      document.body.classList.remove('loading');

      updateTodayButtonPosition();

      setTimeout(() => {
        loadingOverlay.style.display = 'none';
      }, 300);
    }

    async function fetchAllData() {
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        
        allData = data;
        initPlanningView(data);
        renderPlanningViewSwitcher(data);

        localStorage.setItem('planningData', JSON.stringify(allData));
        localStorage.setItem('lastUpdate', new Date().toISOString());

        displaySchedule(currentDayIndex);
        hideLoadingOverlay();
      } catch (error) {
        console.error('Erreur lors du chargement des données:', error);
        // En cas d'erreur, essayer d'utiliser les données en cache
        const cachedData = localStorage.getItem('planningData');
        if (cachedData) {
          allData = JSON.parse(cachedData);
          initPlanningView(allData);
          renderPlanningViewSwitcher(allData);
          displaySchedule(currentDayIndex);
          hideLoadingOverlay();
        }
      }
    }

    function displaySchedule(dayIndex) {
      const scheduleContainer = document.getElementById('timeline');
      if (!scheduleContainer) return;

      const days = ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'];
      const dayOfWeek = days[dayIndex];
      
      // Mettre à jour le titre du jour
      const dayOfWeekElement = document.getElementById('dayOfWeek');
      const displayDayOfWeek = dayOfWeek.charAt(0).toUpperCase() + dayOfWeek.slice(1);
      dayOfWeekElement.innerText = displayDayOfWeek;

      // Mettre à jour la date
      const today = new Date();
      today.setDate(today.getDate() + (dayIndex - today.getDay() + 7) % 7);
      const dateStr = today.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long' });
      document.getElementById('dateStr').innerText = dateStr;
      
      // Mettre à jour le sticky header avec le jour et la date
      const stickyDayName = document.getElementById('stickyDayName');
      const stickyDayNameSpan = stickyDayName.querySelector('.day-name');
      const stickyDayDateSpan = stickyDayName.querySelector('.day-date');
      if (stickyDayNameSpan) {
        stickyDayNameSpan.innerText = displayDayOfWeek;
      }
      if (stickyDayDateSpan) {
        const day = String(today.getDate()).padStart(2, '0');
        const month = today.toLocaleDateString('fr-FR', { month: 'long' }).toUpperCase();
        stickyDayDateSpan.innerText = `${day} ${month}`;
      }
      
      const planning = getCurrentPlanning();
      if (!planning || !planning[dayOfWeek]) {
        console.error('Pas de planning pour le jour:', dayOfWeek);
        scheduleContainer.className = 'timeline no-courses';
        scheduleContainer.innerHTML = displayNoCourseMessage();
        return;
      }

      const courses = planning[dayOfWeek];
      
      if (courses.length === 0) {
        scheduleContainer.className = 'timeline no-courses';
        scheduleContainer.innerHTML = displayNoCourseMessage();
        return;
      }

      scheduleContainer.className = 'timeline has-courses';
      
      let scheduleHTML = '';

      courses.forEach(course => {
        const cours = allData.cours.find(c => c.id === course.coursId);
        const coachs = course.coachIds.map(coachId => allData.coachs.find(c => c.id === coachId)).filter(Boolean);
        const isMultipleCoachs = coachs.length > 1;
        const studio = allData.studios.find(s => s.id === course.studioId);

        if (!cours || !coachs.length) {
          console.error('Données manquantes pour le cours:', course);
          return;
        }

        // Déterminer le type de cours depuis le planning
        let courseTypeClass = '';
        let courseTypeText = course.type || 'Mixte'; // Utiliser le type du cours depuis le planning

        if (courseTypeText === '100% Femmes') {
          courseTypeClass = 'women-only';
        } else if (courseTypeText === 'Mixte') {
          courseTypeClass = 'mixte';
        }

        // Studio "Piscine" ou "AQUA"
        if (studio.name.toLowerCase().includes('piscine') || studio.name.toLowerCase().includes('aqua')) {
          courseTypeClass += ' piscine';
        }

        // Déterminer l'état du cours
        let courseStatusClass = '';
        const now = new Date();
        const currentTime = now.getHours() * 60 + now.getMinutes();
        const [startHour, startMinute] = course.startTime.split(':').map(Number);
        const [endHour, endMinute] = course.endTime.split(':').map(Number);
        const courseStartTime = startHour * 60 + startMinute;
        const courseEndTime = endHour * 60 + endMinute;

        if (isToday(dayIndex)) {
          if (currentTime >= courseStartTime && currentTime <= courseEndTime) {
            courseStatusClass = 'current focus';
          } else if (currentTime < courseStartTime && courseStartTime - currentTime <= 15) {
            courseStatusClass = 'starting-soon focus';
          } else if (currentTime < courseStartTime) {
            courseStatusClass = 'upcoming';
          } else {
            courseStatusClass = 'past';
          }
        } else {
          courseStatusClass = 'upcoming';
        }

        const coachImagesHTML = coachs.map(coach => `
          <div class="coach-item ${isMultipleCoachs ? '' : 'single'}">
            <img class="coach-photo ${isMultipleCoachs ? 'multiple' : ''}" 
                 src="${coach.imageUrl || 'https://mcusercontent.com/74abea872abd45d46efed5d41/images/8fd797c9-5e06-60a8-1720-128bcf9390cf.png'}" 
                 alt="${coach.name}">
            ${!isMultipleCoachs ? `<span>${coach.name}</span>` : ''}
          </div>
        `).join('');

        scheduleHTML += `
          <div class="timeline-block ${courseStatusClass.includes('past') ? 'past' : ''} ${courseStatusClass.includes('current') ? 'current' : ''}" data-start-time="${course.startTime}" data-end-time="${course.endTime}">
            <div class="time">${course.startTime} - ${course.endTime}</div>
            <div class="course-block ${courseTypeClass} ${courseStatusClass}" id="${courseStatusClass.includes('focus') ? 'focus-course' : ''}">
              <div class="course-studio">
                ${studio.imageUrl 
                  ? `<img src="${studio.imageUrl}" alt="${studio.name}">`
                  : ''}
              </div>
              <div class="course-type">${courseTypeText}</div>
              <div class="course-title">
                ${SHOW_COURSE_IMAGES && cours.logo 
                  ? `<img src="${cours.logo}" alt="${cours.name}" style="max-width: 150px; max-height: 55px;" />`
                  : `<h3>${cours.name}</h3>`}
              </div>
              <div class="course-coach">
                <div class="coach-images">
                  ${coachImagesHTML}
                </div>
              </div>
              ${courseStatusClass.includes('starting-soon') ? `<div class="countdown" data-start-time="${course.startTime}"></div>` : ''}
            </div>
          </div>
        `;
      });

      scheduleContainer.innerHTML = scheduleHTML;
      toggleTodayButton(currentDayIndex);

      if (isToday(currentDayIndex)) {
        if (areAllCoursesInThePast(courses)) {
          window.scrollTo({
            top: document.body.scrollHeight,
            behavior: 'smooth'
          });
        } else {
          scrollToNextUpcomingCourse();
        }
        initializeCountdowns();
      } else {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      updateTodayButtonPosition();
    }

    function isToday(dayIndex) {
      const today = new Date();
      const currentDay = today.getDay();
      return dayIndex === currentDay;
    }

    function getDayName(dayIndex) {
      const days = ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'];
      return days[dayIndex];
    }

    function returnToToday() {
      const todayIndex = new Date().getDay();

      if (currentDayIndex !== todayIndex) {
        // Masquer d'abord le bouton avec animation
        const todayButton = document.getElementById('todayViewButton');
        if (todayButton) {
          todayButton.classList.remove('visible');
          setTimeout(() => {
            todayButton.style.display = 'none';
            // Une fois le bouton masqué, changer la page
            currentDayIndex = todayIndex;
            displaySchedule(currentDayIndex);
            
            // S'assurer qu'il n'y a pas de défilement horizontal
            window.scrollTo({
              top: 0,
              left: 0,
              behavior: 'smooth'
            });

            // Mettre à jour la position du bouton today-view après le retour à aujourd'hui
            updateTodayButtonPosition();

            // Ajouter un délai pour s'assurer que le DOM est complètement chargé
            setTimeout(() => {
              scrollToNextUpcomingCourse();
            }, 100);
          }, 300);
        }
      }
    }

    function toggleTodayButton(dayIndex) {
      const todayIndex = new Date().getDay();
      const todayButton = document.getElementById('todayViewButton');
      const scheduleContainer = document.getElementById('timeline');
      
      // Vérifier si on est sur un jour sans cours
      const isNoCourses = scheduleContainer.classList.contains('no-courses');
      
      if (dayIndex === todayIndex) {
        // S'assurer que le bouton est visible avant de le masquer
        todayButton.style.display = 'block';
        todayButton.classList.add('visible');
        
        // Attendre le prochain frame pour l'animation de disparition
        requestAnimationFrame(() => {
          todayButton.classList.remove('visible');
          setTimeout(() => {
            todayButton.style.display = 'none';
          }, 300);
        });
      } else {
        // Afficher le bouton si on est sur un jour différent ou s'il n'y a pas de cours
        todayButton.style.display = 'block';
        // Attendre le prochain frame pour calculer la position
        requestAnimationFrame(() => {
          updateTodayButtonPosition();
          // Attendre que la position soit mise à jour pour rendre le bouton visible
          requestAnimationFrame(() => {
            todayButton.classList.add('visible');
          });
        });
      }
    }

    function changeDay(direction) {
      const weekDays = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
      
      currentDayIndex = (currentDayIndex + direction + 7) % 7;
      
      // Vérifier si on retourne au jour actuel
      const todayIndex = new Date().getDay();
      const todayButton = document.getElementById('todayViewButton');
      
      if (currentDayIndex === todayIndex && todayButton) {
        // Si on retourne au jour actuel, masquer le bouton avec animation
        todayButton.classList.remove('visible');
        setTimeout(() => {
          todayButton.style.display = 'none';
        }, 300); // Attendre la fin de l'animation de fade-out
      }
      
      displaySchedule(currentDayIndex);
      
      // S'assurer qu'il n'y a pas de défilement horizontal
      window.scrollTo({
        top: 0,
        left: 0,
        behavior: 'smooth'
      });
    }

    function areAllCoursesInThePast(courses) {
      const now = new Date();
      const currentTime = now.getHours() * 60 + now.getMinutes();

      return courses.every(course => {
        const [endHour, endMinute] = course.endTime.split(':').map(Number);
        const courseEndTime = endHour * 60 + endMinute;
        return courseEndTime < currentTime;
      });
    }

    function scrollToNextUpcomingCourse() {
      const now = new Date();
      const currentTime = now.getHours() * 60 + now.getMinutes();
      let firstCurrentCourse = null;
      let nextUpcomingCourse = null;
      let allPast = true;
      let earliestStartTime = Infinity;

      const courseBlocks = document.querySelectorAll('.timeline-block');

      courseBlocks.forEach((block) => {
        const timeElement = block.querySelector('.time');
        const [startTime, endTime] = timeElement.innerText.split(" - ");
        const [startHour, startMin] = startTime.split(":").map(Number);
        const [endHour, endMin] = endTime.split(":").map(Number);
        const courseStartTime = startHour * 60 + startMin;
        const courseEndTime = endHour * 60 + endMin;

        if (currentTime >= courseStartTime && currentTime <= courseEndTime) {
          if (!firstCurrentCourse || courseStartTime < earliestStartTime) {
            firstCurrentCourse = block;
            earliestStartTime = courseStartTime;
          }
          allPast = false;
        }
        else if (currentTime < courseStartTime) {
          if (!nextUpcomingCourse || courseStartTime < earliestStartTime) {
            nextUpcomingCourse = block;
            earliestStartTime = courseStartTime;
          }
          allPast = false;
        }
      });

      if (firstCurrentCourse) {
        firstCurrentCourse.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start',
          inline: 'nearest'
        });
      } else if (nextUpcomingCourse) {
        nextUpcomingCourse.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start',
          inline: 'nearest'
        });
      } else if (allPast) {
        window.scrollTo({ 
          top: document.body.scrollHeight, 
          behavior: 'smooth',
          left: 0
        });
      }
    }

    const noCourseMessages = [
      "Profitez de cette journée pour vous reposer et reprendre des forces ! Nous vous attendons demain pour un entraînement intense. 💪",
      "Prenez soin de vous aujourd'hui, et retrouvez-nous dès demain pour continuer vos objectifs !",
      "Conseil du jour : Hydratez-vous bien et pensez à inclure des protéines et des légumes dans vos repas ! 🌱🥤",
      "Le saviez-vous ? Dormir au moins 7 heures améliore la récupération et les performances sportives ! 😴",
      "Suggestions pour aujourd'hui : ✨ Méditation guidée, 🚶 Promenade en plein air, 🧘 Étirements et relaxation"
    ];

    const noCourseImages = [
      "https://mcusercontent.com/74abea872abd45d46efed5d41/images/70a8506a-23ce-3fc3-0e6d-2bc78a5b13d6.png",
      "https://mcusercontent.com/74abea872abd45d46efed5d41/images/fc0db061-f08d-2db2-ab2e-341f4d9a067d.png",
      "https://mcusercontent.com/74abea872abd45d46efed5d41/images/54cf9bc8-ad8e-2aef-1c5a-ae060b1f6d9b.png",
      "https://mcusercontent.com/74abea872abd45d46efed5d41/images/2e02ff47-a45e-f793-0166-8a61a5c3cb1d.png",
      "https://mcusercontent.com/74abea872abd45d46efed5d41/images/5a6492bf-169c-0807-fa9b-fbc2cc5bfaa8.png"
    ];

    function displayNoCourseMessage() {
      const today = new Date().toLocaleDateString('fr-FR');
      const cachedDate = localStorage.getItem('noCourseMessageDate');
      const cachedMessage = localStorage.getItem('noCourseMessage');
      const cachedImage = localStorage.getItem('noCourseImage');

      let message, image;

      if (cachedDate === today && cachedMessage && cachedImage) {
        message = cachedMessage;
        image = cachedImage;
      } else {
        const randomIndex = Math.floor(Math.random() * noCourseMessages.length);
        message = noCourseMessages[randomIndex];
        image = noCourseImages[randomIndex];

        localStorage.setItem('noCourseMessageDate', today);
        localStorage.setItem('noCourseMessage', message);
        localStorage.setItem('noCourseImage', image);
      }

      return `
        <div style="text-align: center; font-style: italic; font-size: 1.2em; margin: 20px;">
          <img src="${image}" alt="Image de repos" style="max-width: 100%; height: auto; margin-bottom: 20px; border-radius: 10px;">
          <p class="quote-text">${message}</p>
        </div>
      `;
    }

    function initializeCountdowns() {
      updateCountdowns();
      setInterval(updateCountdowns, 1000);
    }

    function updateCountdowns() {
      const countdownElements = document.querySelectorAll('.countdown');
      countdownElements.forEach(el => {
        const startTimeStr = el.getAttribute('data-start-time');
        const [startHour, startMinute] = startTimeStr.split(':').map(Number);
        const startTime = new Date();
        startTime.setHours(startHour, startMinute, 0, 0);
        const now = new Date();
        const diff = startTime - now;
        
        // Récupérer le bloc parent du cours
        const courseBlock = el.closest('.timeline-block');
        
        if (diff > 0) {
          const minutes = Math.floor(diff / 60000);
          const seconds = Math.floor((diff % 60000) / 1000);
          el.innerHTML = `Démarrage dans&nbsp;<span style="display: inline-block; min-width: 45px; text-align: center;">${minutes}:${seconds.toString().padStart(2, '0')}</span>`;
        } else if (diff > -60 * 1000) {
          el.innerHTML = 'Démarrage imminent';
        } else {
          el.remove();
          if (!courseBlock.classList.contains('current')) {
            courseBlock.classList.add('current', 'focus');
            courseBlock.classList.remove('starting-soon');
            // Retirer la classe starting-soon du course-block aussi
            const courseBlockElement = courseBlock.querySelector('.course-block');
            if (courseBlockElement) {
              courseBlockElement.classList.remove('starting-soon');
            }
          }
        }
      });
    }

    function initializePage() {
      document.body.classList.add('loading');
      
      const todayButton = document.getElementById('todayViewButton');
      if (todayButton) {
        todayButton.style.display = 'none';
        todayButton.classList.remove('visible');
      }
      
      const loadingOverlay = document.getElementById('loadingOverlay');
      if (loadingOverlay) {
        loadingOverlay.style.display = 'flex';
      }

      fetchAllData().then(() => {
        window.addEventListener('resize', handleResize);
        handleResize(); // Appel initial pour configurer l'état correct
        updateButtonVisibility(); // Appliquer le masquage si nécessaire
      });
    }

    document.addEventListener('DOMContentLoaded', function () {
      // Observer pour le titre sticky
      const dayOfWeekElement = document.getElementById('dayOfWeek');
      const stickyDayNameElement = document.getElementById('stickyDayName');

      const observerOptions = {
        root: null,
        threshold: 0,
      };

      // Utiliser requestAnimationFrame pour optimiser les mises à jour visuelles
      const observer = new IntersectionObserver(function(entries) {
        requestAnimationFrame(() => {
          entries.forEach(entry => {
            if (!entry.isIntersecting) {
              stickyDayNameElement.style.cssText = 'opacity: 1; transform: translateY(0);';
            } else {
              stickyDayNameElement.style.cssText = 'opacity: 0; transform: translateY(-100%);';
            }
          });
        });
      }, observerOptions);

      observer.observe(dayOfWeekElement);
    });

    // Ajout d'un gestionnaire d'événements pour empêcher le défilement horizontal
    document.addEventListener('DOMContentLoaded', function() {
      // Empêcher le défilement horizontal
      window.addEventListener('scroll', function() {
        if (window.scrollX !== 0) {
          window.scrollTo(0, window.scrollY);
        }
      });

      // Empêcher le défilement horizontal lors du redimensionnement
      window.addEventListener('resize', function() {
        if (window.scrollX !== 0) {
          window.scrollTo(0, window.scrollY);
        }
      });
    });
  </script>

  <footer></footer>
</body>
</html> 
