<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://mcusercontent.com/74abea872abd45d46efed5d41/images/57464fd1-2801-45f5-cb10-2b6b52aecf16.png">
    <title>Status Leaderboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            background: #480607;
            color: #333;
            z-index: 0;
            transition: background 0.5s ease;
            position: relative;
            min-height: 100vh;
        }

        body.loaded {
            background: linear-gradient(145deg, #480607, #822026);
        }

        .header {
            display: none;
        }

        .medal-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Emp√™che l'interaction avec les √©l√©ments */
            overflow: hidden;
            z-index: 1; /* En arri√®re-plan */
            background: transparent;
        }

        .medal {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            animation: floatDown 8s ease-in-out forwards;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
            will-change: transform, opacity;
        }

        @keyframes floatDown {
            0% {
                transform: translateY(-100%) rotate(0deg) scale(0.8);
                opacity: 0;
            }
            10% {
                opacity: 0.5;
            }
            20% {
                transform: translateY(0) rotate(180deg) scale(1);
                opacity: 0.8;
            }
            80% {
                transform: translateY(80vh) rotate(360deg) scale(0.8);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) rotate(540deg) scale(0.6);
                opacity: 0;
            }
        }

        /* Animation pour les changements de donn√©es */
        @keyframes highlightChange {
            0% {
                background-color: rgba(255, 255, 255, 0.2);
            }
            100% {
                background-color: transparent;
            }
        }

        .highlight {
            animation: highlightChange 1s ease-out;
        }

        /* Am√©lioration de la visibilit√© des tableaux */
        .table {
            background: white;
            border-radius: 15px;
            padding: 12px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            position: relative;
            overflow: visible;
        }

        .table::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .table::before {
            display: none;
        }

        .table::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05));
            pointer-events: none;
            z-index: 1;
        }

        .table h3 {
            display: flex;
            align-items: center;
            font-size: 1.2em;
            margin-bottom: 8px;
            position: absolute;
            top: -30px;
            left: 15px;
            color: #ffffff;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: rgba(72, 6, 7, 0.9);
            border: none;
            height: 50px;
            width: calc(100% - 30px);
            padding: 0 12px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            z-index: 2;
        }

        .table h3 img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .table:hover h3 img {
            transform: scale(1.1);
        }

        .table h3 span {
            margin-top: 10px;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 0.5px;
            table-layout: fixed;
        }

        table td {
            position: relative;
            padding: 6px 6px;
            transition: all 0.3s ease;
            white-space: normal;
            overflow: visible;
        }

        table td:first-child {
            font-weight: 700;
            color: #480607;
            width: 35px;
            min-width: 35px;
            max-width: 35px;
            text-align: left;
            padding-left: 6px;
            padding-right: 0;
        }

        table td:nth-child(2) {
            font-weight: 500;
            width: 40%;
            padding-left: 2px;
            padding-right: 3px;
        }

        table td:last-child {
            text-align: right;
            font-weight: 600;
            width: 45%;
            padding-right: 6px;
        }

        table td span.meps {
            background: rgba(72, 6, 7, 0.05);
            border: 1px solid rgba(72, 6, 7, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            letter-spacing: 0.5px;
            display: inline-block;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            white-space: nowrap;
            width: auto;
            min-width: 110px;
            text-align: center;
            margin-right: 0;
            position: relative;
        }

        table td div {
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: normal;
            overflow: visible;
        }

        table td div img {
            flex-shrink: 0;
        }

        table td span.meps strong {
            font-weight: 700;
            color: #480607;
            font-family: 'Montserrat', sans-serif;
            opacity: 1 !important;
            margin-right: 3px;
            position: relative;
            z-index: 1;
        }

        table td span.meps::after {
            content: "MEPS";
            opacity: 0.5;
            font-size: 0.8em;
            letter-spacing: 1px;
            color: #480607;
            position: relative;
            z-index: 1;
        }

        /* Style pour les positions sp√©ciales avec ic√¥nes */
        tr[data-position="1"] td:first-child::before {
            content: 'üëë';
            margin-right: 2px;
            font-size: 1.2em;
            vertical-align: middle;
            display: inline-block;
            animation: crownShine 2s infinite;
        }
        tr[data-position="2"] td:first-child::before {
            content: 'ü•à';
            margin-right: 2px;
            font-size: 1.2em;
            vertical-align: middle;
            display: inline-block;
        }
        tr[data-position="3"] td:first-child::before {
            content: 'ü•â';
            margin-right: 2px;
            font-size: 1.2em;
            vertical-align: middle;
            display: inline-block;
        }

        tr[data-position="1"] td:first-child,
        tr[data-position="2"] td:first-child,
        tr[data-position="3"] td:first-child {
            font-size: inherit;
            color: #480607;
        }

        @keyframes crownShine {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Am√©lioration du compte √† rebours */
        .countdown {
            background: #ffffff;
            border: 1px solid rgba(72, 6, 7, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 10px 15px;
            margin: 15px auto;
            max-width: 300px;
            text-align: center;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #480607;
        }

        .countdown:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 6, 7, 0.15);
        }

        /* Animation pour les nouvelles donn√©es */
        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .new-data {
            animation: slideIn 0.5s ease-out;
        }

        .page-title {
            text-align: center;
            background-color: transparent;
            color: #ffffff;
            padding: 15px 0;
            margin-bottom: 15px;
            z-index: 10;
            position: relative;
        }

        .page-title h1 {
            font-size: 1.6em;
            font-weight: 700;
            margin: 0;
            letter-spacing: 1px;
            font-family: 'Montserrat', sans-serif;
            color: #ffffff;
            text-transform: uppercase;
            position: relative;
            display: inline-block;
        }

        .page-title h1::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: linear-gradient(to right, #480607, #822026);
            border-radius: 2px;
        }

        .container {
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            opacity: 1;
            will-change: transform, opacity;
            backface-visibility: hidden;
            transform: none;
            -webkit-transform: none;
        }

        .table:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(72, 6, 7, 0.3);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .description {
            font-size: 0.85em;
            color: #666;
            margin: 8px 0 25px 0;
            font-weight: 500;
            text-align: center;
            padding: 0 8px;
            white-space: normal;
            word-wrap: break-word;
            position: relative;
            top: 5px;
        }

        .status-count {
            font-size: 0.75em;
            color: #666;
            font-weight: 600;
            margin: 8px 0;
            text-align: center;
            background-color: rgba(72, 6, 7, 0.05);
            padding: 3px 6px;
            border-radius: 4px;
            display: inline-block;
            position: relative;
            top: 5px;
        }

        table tr:hover td {
            background-color: rgba(72, 6, 7, 0.05);
        }

        table tr {
            transition: transform 0.2s ease;
        }

        table tr:hover {
            transform: translateX(5px);
        }

        .status-icon {
            width: 22px;
            height: 22px;
            margin-right: 5px;
            background-size: cover;
            background-position: center;
            display: inline-block;
            background-color: transparent;
            border: none;
            box-shadow: none;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                padding: 10px;
                gap: 45px;
            }

            .header {
                display: none;
            }

            .table {
                max-height: none;
                margin: 25px 5px;
                padding: 15px;
                border-radius: 12px;
                touch-action: manipulation;
            }

            .page-title h1 {
                font-size: 1.5em;
            }

            table th, table td {
                padding: 4px 4px;
                font-size: 0.95em;
                position: relative;
            }

            table td:first-child {
                width: 40px;
            }

            table td:nth-child(2) {
                max-width: 120px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            table td:last-child {
                text-align: right;
                padding-right: 12px;
            }

            /* Style pour le swipe */
            .swipe-indicator {
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                color: rgba(255, 255, 255, 0.5);
                font-size: 1.2em;
                pointer-events: none;
            }

            /* Animation de swipe */
            @keyframes swipeRight {
                from { transform: translateX(0); }
                to { transform: translateX(100%); }
            }

            .swipe-right {
                animation: swipeRight 0.3s ease-out forwards;
            }

            /* Style pour le mode plein √©cran */
            .table.fullscreen {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 1000;
                margin: 0;
                border-radius: 0;
                max-height: 100vh;
                overflow-y: auto;
            }

            .fullscreen-close {
                position: fixed;
                top: 10px;
                right: 10px;
                background: rgba(0, 0, 0, 0.5);
                color: white;
                border: none;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                font-size: 24px;
                z-index: 1001;
            }

            .table.fullscreen + .fullscreen-close {
                display: block;
            }

            table td {
                font-size: 0.9em;
                padding: 5px 3px;
            }

            table td:first-child {
                font-size: 0.85em;
            }

            table td:last-child {
                font-size: 0.85em;
            }

            /* Ajustement de la taille des MEPS sur mobile */
            table td span.meps {
                font-size: 1em !important;
                padding: 8px 12px !important;
                min-width: 130px !important;
            }

            table td span.meps strong {
                font-size: 1.1em !important;
            }

            table td span.meps::after {
                font-size: 0.9em !important;
            }
        }

        @media (max-width: 480px) {
            table td {
                padding: 3px 3px;
            }

            table td:first-child {
                font-size: 0.75em;
            }

            table td:last-child {
                font-size: 0.75em;
            }
        }

        /* Animation de chargement */
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(72, 6, 7, 0.4);
            }
            70% {
                transform: scale(1.02);
                box-shadow: 0 0 0 10px rgba(72, 6, 7, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(72, 6, 7, 0);
            }
        }

        .loading {
            animation: pulse 1.5s infinite;
            background: white;
            border: 2px solid rgba(72, 6, 7, 0.1);
            position: relative;
            z-index: 2;
        }

        .loading::after {
            content: "Mise √† jour...";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #480607;
            font-weight: 600;
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Style pour le mode √©tendu */
        .table.expanded {
            animation: none;
            max-height: none;
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .table.expanded tbody {
            display: table-row-group;
        }

        .button-container {
            position: relative;
            width: 100%;
        }

        .expand-button, .collapse-button {
            width: 100%;
            padding: 12px;
            background: rgba(72, 6, 7, 0.05);
            border: 1px solid rgba(72, 6, 7, 0.1);
            color: #480607;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 8px;
            margin: 5px 0;
            text-align: center;
        }

        .expand-button:hover, .collapse-button:hover {
            background: rgba(72, 6, 7, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .table.expanded .expand-button {
            display: none;
        }

        .table.expanded .collapse-button {
            display: block;
        }

        /* Animation pour l'expansion et la r√©duction */
        @keyframes expandTable {
            from {
                max-height: 400px;
                opacity: 0.8;
            }
            to {
                max-height: 2000px;
                opacity: 1;
            }
        }

        @keyframes collapseTable {
            from {
                max-height: 2000px;
                opacity: 1;
            }
            to {
                max-height: 400px;
                opacity: 0.8;
            }
        }

        .table.expanded {
            animation: expandTable 0.5s ease-out forwards;
        }

        .table.collapsing {
            animation: collapseTable 0.5s ease-out forwards;
        }

        /* Animation pour les nouvelles lignes */
        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .new-row {
            animation: slideInUp 0.3s ease-out forwards;
        }

        /* Am√©lioration du chargement initial */
        .container {
            opacity: 1;
            will-change: auto;
            backface-visibility: visible;
            transform: none;
            -webkit-transform: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 1;
            }
            to {
                opacity: 1;
            }
        }

        .table:nth-child(1) { animation-delay: 0s; }
        .table:nth-child(2) { animation-delay: 0s; }
        .table:nth-child(3) { animation-delay: 0s; }
        .table:nth-child(4) { animation-delay: 0s; }
        .table:nth-child(5) { animation-delay: 0s; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Style pour le mode √©tendu */
        .table.expanded {
            animation: none;
            max-height: none;
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .table.expanded tbody {
            display: table-row-group;
        }

        .expand-button, .collapse-button {
            width: 100%;
            padding: 12px;
            background: rgba(72, 6, 7, 0.05);
            border: 1px solid rgba(72, 6, 7, 0.1);
            color: #480607;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 8px;
            margin: 5px 0;
            text-align: center;
        }

        .expand-button {
            display: block;
        }

        .collapse-button {
            display: none;
        }

        .table.expanded .expand-button {
            display: none;
        }

        .table.expanded .collapse-button {
            display: block;
        }

        .expand-button:hover, .collapse-button:hover {
            background: rgba(72, 6, 7, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Animation pour l'expansion et la r√©duction */
        @keyframes expandTable {
            from {
                max-height: 400px;
                opacity: 0.8;
            }
            to {
                max-height: 2000px;
                opacity: 1;
            }
        }

        @keyframes collapseTable {
            from {
                max-height: 2000px;
                opacity: 1;
            }
            to {
                max-height: 400px;
                opacity: 0.8;
            }
        }

        .table.expanded {
            animation: expandTable 0.5s ease-out forwards;
        }

        .table.collapsing {
            animation: collapseTable 0.5s ease-out forwards;
        }

        /* Animation pour les nouvelles lignes */
        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .new-row {
            animation: slideInUp 0.3s ease-out forwards;
        }

        /* Styles pour l'overlay de chargement */
        #loadingOverlay {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background-color: rgba(72,6,7, 1) !important;
            z-index: 999999 !important;
            display: flex;
            overflow: hidden !important;
            pointer-events: all !important;
            opacity: 1 !important;
            transition: opacity 0.5s ease;
        }

        #loadingOverlay.fade-out {
            opacity: 0 !important;
        }

        .modal-center-container {
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            width: auto !important;
            height: auto !important;
            pointer-events: none !important;
            gap: 50px !important;
            background-color: transparent !important;
        }

        /* Style par d√©faut pour mobile */
        .modal-center-container img {
            width: 100px !important;
            height: auto !important;
            animation: zoom-logo 2s infinite !important;
            pointer-events: none !important;
        }

        /* Style pour tablettes */
        @media screen and (min-width: 768px) {
            .modal-center-container img {
                width: 140px !important;
            }
        }

        /* Style pour desktop */
        @media screen and (min-width: 1024px) {
            .modal-center-container img {
                width: 170px !important;
            }
        }

        @keyframes zoom-logo {
            0% {
                transform: scale(1);
                opacity: 0.9;
            }
            50% {
                transform: scale(1.05);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 0.9;
            }
        }
    </style>
</head>
<body>
    <div id="loadingOverlay">
        <div class="modal-center-container">
            <img src="https://mcusercontent.com/74abea872abd45d46efed5d41/images/8fd797c9-5e06-60a8-1720-128bcf9390cf.png" alt="Myzone Logo">
        </div>
    </div>
    <div class="medal-background"></div>
    <div class="page-title">
        <h1>Statuts Myzone</h1>
    </div>

    <div class="countdown" id="countdown">Prochaine mise √† jour dans : 05:00</div>

    <div class="container" id="status-tables">
        <!-- Les tableaux seront g√©n√©r√©s dynamiquement ici -->
    </div>

    <script>
        const jsonUrl = `https://raw.githubusercontent.com/canalforme-official/app-data/main/leaderboard.json?timestamp=${Date.now()}`;
        //const jsonUrl = `./Leaderboard.json?timestamp=${Date.now()}`;

        let medalAnimationInterval = null;
        let medalUrls = [];

        async function fetchLeaderboard() {
            const response = await fetch(jsonUrl);
            const data = await response.json();
            console.log('Donn√©es re√ßues:', data.current.data[0]); // Afficher la structure d'un utilisateur
            return data.current.data;
        }

        function generateTable(status, rank, iconLink, users) {
            const container = document.getElementById('status-tables');
            let existingTable = Array.from(container.children).find(table => table.dataset.status === status);

            if (!existingTable) {
                // Cr√©e le conteneur pour le tableau
                const tableContainer = document.createElement('div');
                tableContainer.classList.add('table');
                tableContainer.dataset.status = status;

                // Cr√©e un conteneur pour aligner les √©l√©ments
                const headerContainer = document.createElement('div');
                headerContainer.style.display = 'flex';
                headerContainer.style.alignItems = 'center';
                headerContainer.style.justifyContent = 'space-between';
                headerContainer.style.gap = '10px';

                // Ajoute le titre avec l'ic√¥ne
                const title = document.createElement('h3');
                if (iconLink) {
                    title.innerHTML = `<img src="${iconLink}" alt="${status}"> ${status}`;
                } else {
                    title.textContent = status;
                }
                title.style.margin = '0';
                headerContainer.appendChild(title);

                // Ajoute la description
                const description = document.createElement('p');
                description.classList.add('description');
                description.style.margin = '0';
                description.textContent = rank > 0 
                    ? `${rank} mois √† 1300 MEPs`
                    : ``;
                headerContainer.appendChild(description);

                // Ajoute le nombre de personnes
                const count = document.createElement('p');
                count.classList.add('status-count');
                count.style.margin = '0';
                count.textContent = `${users.length} users`;
                headerContainer.appendChild(count);

                tableContainer.appendChild(headerContainer);

                // Cr√©e le tableau
                const table = document.createElement('table');
                const tbody = document.createElement('tbody');
                table.appendChild(tbody);

                tableContainer.appendChild(table);
                container.appendChild(tableContainer);
                existingTable = tableContainer;
            }

            // Ajouter une classe de chargement pendant la mise √† jour
            const tableContainer = existingTable;
            tableContainer.classList.add('loading');
            
            // Simuler un d√©lai de chargement pour une meilleure exp√©rience utilisateur
            setTimeout(() => {
                tableContainer.classList.remove('loading');
                // Met √† jour le contenu du tableau
                const tbody = existingTable.querySelector('tbody');
                const oldRows = Array.from(tbody.querySelectorAll('tr'));
                tbody.innerHTML = '';
                
                // Limite le nombre d'utilisateurs affich√©s √† 5
                const displayUsers = users.slice(0, 5);
                displayUsers.forEach((user, index) => {
                    const row = document.createElement('tr');
                    row.setAttribute('data-position', user.position);
                    row.classList.add('new-data');
                    
                    // V√©rifie si les donn√©es ont chang√©
                    const oldRow = oldRows[index];
                    const oldMeps = oldRow ? parseInt(oldRow.querySelector('td:last-child strong').textContent.replace(/\s/g, '')) : null;
                    const hasChanged = oldMeps !== null && oldMeps !== user.meps;
                    
                    row.innerHTML = `
                        <td style="font-weight: bold;">${user.position}</td>
                        <td style="padding-left: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                ${user.coachLink ? `<img src="${user.coachLink}" alt="${user.nickname}" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(72, 6, 7, 0.2);">` : ''}
                                ${user.nickname}
                            </div>
                        </td>
                        <td>
                            <span class="meps">
                                <strong class="${hasChanged ? 'highlight' : ''}">${formatNumber(user.meps)}</strong>
                            </span>
                        </td>
                    `;
                    
                    if (hasChanged) {
                        row.querySelector('td:last-child').classList.add('highlight');
                    }
                    
                    tbody.appendChild(row);
                });

                // Dans la partie o√π on ajoute la ligne "autres"
                if (users.length > 5) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="3" style="text-align: center;">
                            <button class="expand-button">
                                Voir les ${users.length - 5} autres membres
                            </button>
                            <button class="collapse-button">
                                Voir moins
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);

                    // G√©rer le clic sur le bouton d'expansion
                    const expandButton = row.querySelector('.expand-button');
                    const collapseButton = row.querySelector('.collapse-button');
                    
                    expandButton.addEventListener('click', () => {
                        console.log('Clic sur le bouton expand');
                        const table = expandButton.closest('.table');
                        const tbody = table.querySelector('tbody');
                        
                        // Ajouter les lignes suppl√©mentaires avec animation
                        const additionalUsers = users.slice(5);
                        const fragment = document.createDocumentFragment();
                        
                        additionalUsers.forEach((user, index) => {
                            const newRow = document.createElement('tr');
                            newRow.classList.add('new-row');
                            newRow.style.animationDelay = `${index * 0.05}s`;
                            newRow.setAttribute('data-position', user.position);
                            
                            newRow.innerHTML = `
                                <td style="font-weight: bold;">${user.position}</td>
                                <td style="padding-left: 15px;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        ${user.coachLink ? `<img src="${user.coachLink}" alt="${user.nickname}" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(72, 6, 7, 0.2);">` : ''}
                                        ${user.nickname}
                                    </div>
                                </td>
                                <td>
                                    <span class="meps">
                                        <strong>${formatNumber(user.meps)}</strong>
                                    </span>
                                </td>
                            `;
                            
                            fragment.appendChild(newRow);
                        });
                        
                        tbody.insertBefore(fragment, row);
                        table.classList.add('expanded');
                        console.log('Table √©tendue, classes actuelles:', table.classList.toString());
                    });

                    // G√©rer le clic sur le bouton de r√©duction
                    collapseButton.addEventListener('click', () => {
                        console.log('Clic sur le bouton collapse');
                        const table = collapseButton.closest('.table');
                        table.classList.add('collapsing');
                        console.log('Table en cours de collapse, classes actuelles:', table.classList.toString());
                        
                        // Sauvegarder la ligne des boutons avant la suppression
                        const buttonRow = table.querySelector('tr:last-child');
                        console.log('Ligne des boutons avant suppression:', buttonRow ? buttonRow.innerHTML : 'Non trouv√©e');
                        
                        // Supprimer les lignes suppl√©mentaires imm√©diatement
                        const rows = table.querySelectorAll('tr');
                        console.log('Nombre total de lignes avant suppression:', rows.length);
                        
                        // Supprimer toutes les lignes sauf les 5 premi√®res et la ligne des boutons
                        rows.forEach((row, index) => {
                            if (index > 5 && row !== buttonRow) {
                                console.log('Suppression de la ligne:', index, row.innerHTML);
                                row.remove();
                            }
                        });
                        
                        // Retirer les classes apr√®s un court d√©lai pour l'animation
                        setTimeout(() => {
                            table.classList.remove('expanded', 'collapsing');
                            console.log('Classes apr√®s suppression:', table.classList.toString());
                            
                            // V√©rifier si la ligne des boutons existe toujours
                            const currentButtonRow = table.querySelector('tr:last-child');
                            console.log('Ligne des boutons apr√®s suppression:', currentButtonRow ? currentButtonRow.innerHTML : 'Non trouv√©e');
                            
                            if (currentButtonRow) {
                                const expandButton = currentButtonRow.querySelector('.expand-button');
                                const collapseButton = currentButtonRow.querySelector('.collapse-button');
                                console.log('Boutons trouv√©s:', {
                                    expandButton: !!expandButton,
                                    collapseButton: !!collapseButton
                                });
                                
                                if (expandButton && collapseButton) {
                                    console.log('√âtat des boutons avant modification:', {
                                        expandDisplay: expandButton.style.display,
                                        collapseDisplay: collapseButton.style.display
                                    });
                                    expandButton.style.display = 'block';
                                    collapseButton.style.display = 'none';
                                    console.log('√âtat des boutons apr√®s modification:', {
                                        expandDisplay: expandButton.style.display,
                                        collapseDisplay: collapseButton.style.display
                                    });
                                } else {
                                    console.error('Un ou les deux boutons n\'ont pas √©t√© trouv√©s dans la ligne des boutons');
                                    console.log('Contenu complet de la derni√®re ligne:', currentButtonRow.innerHTML);
                                }
                            } else {
                                console.error('Ligne des boutons non trouv√©e');
                                console.log('Nombre de lignes restantes:', table.querySelectorAll('tr').length);
                                console.log('Contenu du tbody:', table.querySelector('tbody').innerHTML);
                            }
                        }, 500);
                    });
                }
            }, 300);
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }

        async function fetchMedals() {
            try {
                const response = await fetch(jsonUrl);
                const data = await response.json();
                medalUrls = [...new Set(data.current.data.map(user => user.iconLink))];
                return medalUrls;
            } catch (error) {
                console.error('Erreur lors du chargement des m√©dailles:', error);
                return [];
            }
        }

        function createMedalAnimation() {
            if (!medalUrls.length) return;
            
            const background = document.querySelector('.medal-background');
            if (!background) return;

            const currentMedals = background.querySelectorAll('.medal').length;
            const isMobile = window.innerWidth <= 768;
            const maxMedals = isMobile ? 2 : 3;
            
            if (currentMedals >= maxMedals) return;

            const medal = document.createElement('img');
            medal.classList.add('medal');
            medal.src = medalUrls[Math.floor(Math.random() * medalUrls.length)];
            
            const leftPosition = 20 + (Math.random() * 60);
            medal.style.left = `${leftPosition}%`;
            medal.style.width = `${isMobile ? 30 : 40}px`;
            
            background.appendChild(medal);

            // Nettoyer la m√©daille apr√®s l'animation
            medal.addEventListener('animationend', () => {
                if (medal.parentNode) {
                    background.removeChild(medal);
                }
            });
        }

        function startMedalAnimation() {
            // Arr√™ter l'animation existante si elle existe
            if (medalAnimationInterval) {
                clearInterval(medalAnimationInterval);
            }

            const isMobile = window.innerWidth <= 768;
            const interval = isMobile ? 10000 : 8000; // Plus long intervalle pour √©viter la surcharge
            
            // D√©marrer une nouvelle animation
            medalAnimationInterval = setInterval(createMedalAnimation, interval);
        }

        async function init() {
            try {
                const data = await fetchLeaderboard();
                
                if (!data || data.length === 0) {
                    console.error('Aucune donn√©e disponible');
                    return;
                }

                const groupedByStatus = data.reduce((acc, user) => {
                    if (!acc[user.status]) {
                        acc[user.status] = [];
                    }
                    acc[user.status].push(user);
                    return acc;
                }, {});

                const statuses = Object.keys(groupedByStatus).sort((a, b) => {
                    const maxRankA = Math.max(...groupedByStatus[a].map(u => u.rank));
                    const maxRankB = Math.max(...groupedByStatus[b].map(u => u.rank));
                    return maxRankB - maxRankA;
                });

                // Cr√©er les tableaux
                statuses.forEach((status, index) => {
                    setTimeout(() => {
                        const users = groupedByStatus[status]
                            .sort((a, b) => b.rank - a.rank);

                        const iconLink = users[0]?.iconLink || '';
                        const rank = users[0]?.rank || 0;
                        generateTable(status, rank, iconLink, users);
                    }, index * 50);
                });

                // Initialiser les interactions mobiles
                initMobileInteractions();
                
                // Charger les m√©dailles et d√©marrer l'animation
                await fetchMedals();
                setTimeout(startMedalAnimation, 2000);
            } catch (error) {
                console.error('Erreur lors de l\'initialisation:', error);
            }
        }

        function startCountdown(duration) {
            const countdownElement = document.getElementById('countdown');
            let timer = duration;

            async function updateCountdown() {
                const minutes = Math.floor(timer / 60);
                const seconds = timer % 60;
                countdownElement.textContent = `Prochaine mise √† jour dans : ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (--timer < 0) {
                    timer = duration;
                    await init();
                }
            }

            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        // Initialiser l'application
        document.addEventListener('DOMContentLoaded', () => {
            init().then(() => {
                startCountdown(300);
            }).catch(error => {
                console.error('Erreur lors du d√©marrage:', error);
            });
        });
    </script>

    <script>
        // Gestion des interactions mobiles
        function initMobileInteractions() {
            const tables = document.querySelectorAll('.table');
            
            tables.forEach(table => {
                const header = table.querySelector('h3');
                let touchStartX = 0;
                let touchEndX = 0;
                let isSwiping = false;

                // Gestion du collapse/expand
                header.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        table.classList.toggle('collapsed');
                    }
                });

                // Gestion du swipe avec option passive
                table.addEventListener('touchstart', (e) => {
                    touchStartX = e.touches[0].clientX;
                    isSwiping = true;
                }, { passive: true });

                table.addEventListener('touchmove', (e) => {
                    if (!isSwiping) return;
                    touchEndX = e.touches[0].clientX;
                }, { passive: true });

                table.addEventListener('touchend', () => {
                    if (!isSwiping) return;
                    isSwiping = false;
                }, { passive: true });
            });
        }

        // Initialiser les interactions mobiles apr√®s le chargement
        document.addEventListener('DOMContentLoaded', () => {
            initMobileInteractions();
        });

        // Mettre √† jour les interactions mobiles apr√®s chaque mise √† jour des donn√©es
        const originalInit = init;
        init = async function() {
            await originalInit();
            initMobileInteractions();
        };
    </script>

    <script>
        // Ajouter une animation de transition pour les changements de donn√©es
        function animateValueChange(element, oldValue, newValue) {
            const duration = 1000;
            const start = Date.now();
            
            function update() {
                const elapsed = Date.now() - start;
                const progress = Math.min(elapsed / duration, 1);
                
                // Fonction d'easing
                const easeOut = t => 1 - Math.pow(1 - t, 3);
                const currentValue = Math.round(oldValue + (newValue - oldValue) * easeOut(progress));
                
                element.textContent = formatNumber(currentValue);
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ajouter la classe loaded au body une fois que tout est charg√©
            setTimeout(() => {
                document.body.classList.add('loaded');
            }, 500);
        });
    </script>

    <script>
        // Gestion de l'overlay de chargement
        document.addEventListener('DOMContentLoaded', function() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            // Afficher l'overlay au chargement
            loadingOverlay.style.display = 'flex';
            
            // Masquer l'overlay apr√®s 2 secondes
            setTimeout(() => {
                loadingOverlay.style.opacity = '0';
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                }, 500);
            }, 2000);
        });
    </script>
</body>
</html>
