<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Planning Hebdomadaire</title>

  <!-- Favicon -->
  <link rel="icon" href="https://mcusercontent.com/74abea872abd45d46efed5d41/images/20d3fcd8-43fc-852e-95b2-55ad6e8befe6.png" type="image/png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  

  <style>
    /* Styles généraux */
    :root {
      /* Couleurs principales */
      --primary-color: #480607;
      --secondary-color: #FFA630;
      
      /* Dégradé piscine/aqua (bleu uniquement) */
      --pool-blue: #35767c;
      --pool-middle: #42464d;
      --gradient-pool: radial-gradient(circle, var(--pool-blue) 0%, var(--pool-middle) 100%);
      
      /* Dégradé femmes uniquement (violet uniquement) */
      --women-light: #ddace7;
      --women-middle: #9e6187;
      --gradient-women: radial-gradient(circle, var(--women-light) 0%, var(--women-middle) 100%);
      
      /* Couleurs spécifiques */
      --women-color: #E4A672;
      --pool-color: #78D1B6;
      
      /* Couleurs de fond */
      --background-main: #F5F5F5;
      --background-card: #FFFFFF;
      
      /* Couleurs de texte */
      --text-primary: #333333;
      --text-secondary: #666666;
      --text-tertiary: #555555;
      --text-light: #FFFFFF;
      
      /* Transparences primary */
      --primary-overlay: rgba(72, 6, 7, 0.95);
      --primary-light: rgba(72, 6, 7, 0.8);
      --primary-lighter: rgba(72, 6, 7, 0.5);
      
      /* Transparences secondary */
      --secondary-light: rgba(255, 166, 48, 0.75);
      --secondary-lighter: rgba(255, 166, 48, 0.7);
      
      /* Transparences spécifiques */
      --women-color-light: rgba(228, 166, 114, 0.3);
      --pool-color-light: rgba(120, 209, 182, 0.3);
      
      /* Ombres */
      --shadow-light: rgba(200, 200, 200, 0.3);
      --shadow-medium: rgba(150, 150, 150, 0.5);
      --shadow-dark: rgba(0, 0, 0, 0.4);
      
      /* États */
      --state-past: #aaaaaa;
      --overlay-light: rgba(255, 255, 255, 0.3);
      --overlay-lighter: rgba(255, 255, 255, 0.2);
    }

    /* Thème Ramadan (couleurs modifiées quand planning Ramadan affiché) */
    body.planning-ramadan {
      --primary-color: #26462d;
      --primary-overlay: rgba(38, 70, 45, 0.95);
      --primary-light: rgba(38, 70, 45, 0.85);
      --secondary-color: #c9a227;
      --secondary-light: rgba(201, 162, 39, 0.75);
    }

    body.planning-ramadan .course-block { border-left-color: var(--primary-color); }
    body.planning-ramadan .weekly-schedule th { background: var(--primary-light); color: #fff; }
    body.planning-ramadan { position: relative; }
    body.planning-ramadan::before {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      min-height: 100vh;
      z-index: 0;
      pointer-events: none;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/46685c10-b83c-7d4f-0cbd-4ead782d61a4.png');
      background-repeat: repeat;
      background-size: 40px 40px;
      background-position: 0 0;
      opacity: 0.04;
      filter: sepia(1) hue-rotate(335deg) saturate(2.5);
    }
    body.planning-ramadan .content-wrapper { position: relative; z-index: 1; }
    /* Icône de rotation en vert Ramadan (#26462d) opaque en mode Ramadan */
    body.planning-ramadan .rotation-view-button::before {
      filter: brightness(0) saturate(0%) invert(27%) sepia(8%) saturate(2000%) hue-rotate(95deg) brightness(90%) contrast(85%) !important;
    }
    /* Icône retour à aujourd'hui en vert Ramadan (#26462d) opaque en mode Ramadan */
    body.planning-ramadan .today-view-button::before {
      filter: brightness(0) saturate(0%) invert(27%) sepia(8%) saturate(2000%) hue-rotate(95deg) brightness(90%) contrast(85%) !important;
    }
    body.planning-ramadan .ramadan-switch-button {
      background: rgba(38, 70, 45, 1);
    }

    /* Bouton switch planning Ramadan — au-dessus du bouton de rotation, mobile uniquement */
    .ramadan-switch-button {
      position: fixed;
      bottom: 145px;
      right: 20px;
      width: auto;
      height: auto;
      background: transparent;
      border: none;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1002;
      overflow: visible;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: auto;
      opacity: 0;
      transform: translateY(20px);
      padding: 0;
    }
    .ramadan-switch-button.loaded {
      opacity: 1;
      transform: translateY(0);
    }
    .ramadan-icon {
      width: 55px;
      height: 55px;
      filter: brightness(0) saturate(0%) invert(8%) sepia(94%) saturate(1352%) hue-rotate(335deg) brightness(95%) contrast(88%) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
      transition: filter 0.3s;
      z-index: 10;
      position: relative;
      display: block;
      animation: float-icon 3s ease-in-out infinite;
    }
    
    @keyframes float-icon {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-8px);
      }
    }
    body.planning-ramadan .ramadan-switch-button {
      background: transparent;
    }
    body.planning-ramadan .ramadan-icon {
      filter: brightness(0) saturate(0%) invert(27%) sepia(8%) saturate(2000%) hue-rotate(95deg) brightness(90%) contrast(85%) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
    }
    .ramadan-switch-button:active {
      transform: translateY(20px) scale(0.9);
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .ramadan-switch-button.loaded:active {
      transform: translateY(0) scale(0.9);
    }
    /* Paillettes d'explosion au clic */
    .confetti-burst {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      pointer-events: none;
      animation: confetti-burst-anim 2s ease-out forwards;
    }
    @keyframes confetti-burst-anim {
      0% {
        transform: translate(0, 0) scale(1) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translate(var(--burst-x, 0), var(--burst-y, 0)) scale(0) rotate(720deg);
        opacity: 0;
      }
    }
    /* Container pour les paillettes */
    .confetti-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: visible;
      z-index: 1;
    }
    @media screen and (min-width: 769px) {
      .ramadan-switch-button { display: none !important; }
    }

    body, button, a, img {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: fixed;
      width: 100%;
      font-family: Arial, sans-serif;
      background-color: var(--background-main);
      color: var(--primary-color);
    }

    body {
      display: flex;
      flex-direction: column;
    }

    .content-wrapper {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      height: 100vh;
      padding: 10px;
      box-sizing: border-box;
      -webkit-overflow-scrolling: touch;
      position: relative;
      scrollbar-width: none;
      -ms-overflow-style: none;
      touch-action: pan-y;
      overscroll-behavior: none;
    }

    /* Masquer la barre de défilement pour Chrome, Safari et Opera */
    .content-wrapper::-webkit-scrollbar {
      display: none;
    }

    /* Style pour la disposition du titre et des filtres */
    .header-wrapper {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      pointer-events: none !important;
    }

    .header-wrapper h1 {
      color: var(--primary-color);
      font-size: 1.8em;
      margin: 0;
    }

    /* Styles pour le conteneur des filtres */
    .filters {
      display: flex;
      align-items: center;
      gap: 10px;
      pointer-events: auto; /* Permettre les interactions avec les filtres */
    }

    .filters label {
      font-size: 0.9em;
      cursor: pointer;
      display: flex;
      align-items: center;
      color: var(--primary-color);
      pointer-events: auto; /* Permettre les interactions avec les labels */
    }

    .filters input[type="checkbox"] {
      margin-right: 5px;
      accent-color: var(--secondary-color);
      pointer-events: auto; /* Permettre les interactions avec les checkboxes */
    }

    /* Style personnalisé pour les checkboxes */
    .filters input[type="checkbox"] {
      appearance: none;
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border: 2px solid #ffffff;
      border-radius: 3px;
      margin-right: 5px;
      position: relative;
      cursor: pointer;
    }

    .filters input[type="checkbox"]:checked {
      background-color: rgba(255, 255, 255, 0.8);
    }

    .filters input[type="checkbox"]:checked::after {
      content: '✓';
      position: absolute;
      color: var(--primary-color);
      font-size: 12px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    /* Style pour le select des coachs */
    .filters select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-color: var(--background-card);
      border: 2px solid var(--secondary-color);
      border-radius: 3px;
      padding: 5px 25px 5px 10px;
      font-size: 0.9em;
      color: var(--primary-color);
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23480607' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
      background-size: 12px;
      margin-left: 5px;
      min-width: 150px;
    }

    .filters select:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .filters select option {
      background-color: var(--background-card);
      color: var(--primary-color);
      padding: 5px;
    }

    .filters select option:checked {
      background-color: var(--secondary-color);
      color: var(--primary-color);
    }

    .filters select option:hover {
      background-color: var(--secondary-light);
    }

    /* Overlay de chargement */
    #loadingOverlay {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      background-color: rgba(72,6,7, 1) !important;
      z-index: 999999 !important;
      display: flex;
      overflow: hidden !important;
      pointer-events: all !important;
      opacity: 1 !important;
      transition: opacity 0.5s ease;
    }

    #loadingOverlay.fade-out {
      opacity: 0 !important;
    }

    /* Style du message de chargement */
    #loadingMessage {
      display: none;
    }


    @keyframes pulse {
      0% {
        transform: scale(1) translateZ(0);
        opacity: 1;
      }
      50% {
        transform: scale(1.02) translateZ(0);
        opacity: 0.95;
      }
      100% {
        transform: scale(1) translateZ(0);
        opacity: 1;
      }
    }

    @keyframes zoomPulse {
      0%, 100% {
        transform: translate(-50%, -50%) scale(1) translateZ(0);
      }
      50% {
        transform: translate(-50%, -50%) scale(1.02) translateZ(0);
      }
    }

/* Style pour le bouton de rotation vers weekly_vertical.html */
.rotation-view-button {
  position: fixed;
  bottom: 80px;
  right: 20px;
  top: auto;
  z-index: 1001;
  background: rgba(255, 255, 255, 0.35);
  backdrop-filter: blur(10px);
  border-radius: 25px;
  padding: 0;
  width: 50px;
  height: 50px;
  min-width: 48px;
  min-height: 48px;
  -webkit-tap-highlight-color: transparent;
  -webkit-user-select: none;
  user-select: none;
  pointer-events: all;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), background 0.2s ease;
  touch-action: manipulation;
}

.rotation-view-button::before {
  content: '';
  position: absolute;
  width: 24px;
  height: 24px;
  background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/665404b9-0908-8116-6c7b-5c61a7075d36.png');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  transform-origin: center;
  pointer-events: none;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  -webkit-transform-style: preserve-3d;
  transform-style: preserve-3d;
}

.rotation-view-button button {
  position: absolute;
  inset: 0;
  z-index: 3;
  width: 100%;
  height: 100%;
  background: none;
  border: none;
  cursor: pointer;
  display: block;
  -webkit-tap-highlight-color: transparent;
  -webkit-user-select: none;
  user-select: none;
  outline: none;
  pointer-events: all;
  border-radius: 25px;
  touch-action: manipulation;
}

/* Animation de clic (compatible mobile : active + classe JS) */
.rotation-view-button:active::before,
.rotation-view-button.tap-active::before {
  animation: click-zoom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.rotation-view-button:hover {
  background: rgba(255, 255, 255, 0.5);
  transform: scale(1.05);
}

.rotation-view-button:active {
  transform: scale(0.98);
}

/* Style pour le bouton de filtre (comme dans weekly_vertical.html) */
.filters-sidebar {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  background: rgba(255, 255, 255, 0.35);
  backdrop-filter: blur(10px);
  border-radius: 25px;
  z-index: 999;
  transition: width 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), border-radius 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  overflow: hidden;
  padding: 0;
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.filters-sidebar.open {
  width: calc(100% - 40px);
  border-radius: 25px;
  overflow: visible;
}

.filters-sidebar .filter-button {
  position: absolute;
  right: 0;
  top: 0;
  background: transparent;
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  min-width: 50px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  outline: none;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  box-shadow: none;
  margin: 0;
  padding: 0;
  z-index: 1001;
  pointer-events: all;
}

.filters-sidebar .filter-button:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.05);
}

.filters-sidebar.open .filter-button:hover {
  background: var(--primary-color);
}

.filters-sidebar.open .filter-button:hover .filter-icon::before,
.filters-sidebar.open .filter-button:hover .filter-icon::after,
.filters-sidebar.open .filter-button:hover .filter-icon span {
  background: white;
}

.filters-sidebar .filter-button:active {
  transform: scale(0.95);
}

.filter-icon {
  width: 24px;
  height: 24px;
  position: relative;
  display: block;
}

.filter-icon::before {
  content: '';
  position: absolute;
  top: 6px;
  left: 50%;
  transform: translateX(-50%);
  width: 18px;
  height: 2.5px;
  background: var(--primary-color);
  border-radius: 1px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1;
}

.filter-icon::after {
  content: '';
  position: absolute;
  top: 11px;
  left: 50%;
  transform: translateX(-50%);
  width: 14px;
  height: 2.5px;
  background: var(--primary-color);
  border-radius: 1px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1;
}

.filter-icon span {
  position: absolute;
  top: 16px;
  left: 50%;
  transform: translateX(-50%);
  width: 10px;
  height: 2.5px;
  background: var(--primary-color);
  border-radius: 1px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: block;
  z-index: 1;
}

.filter-button:hover .filter-icon::before,
.filter-button:hover .filter-icon::after,
.filter-button:hover .filter-icon span {
  background: white;
}

/* Panneau fermé : forcer les barres en bordeaux (annule le :hover collant sur mobile au 2e clic) */
.filters-sidebar:not(.open) .filter-icon::before,
.filters-sidebar:not(.open) .filter-icon::after,
.filters-sidebar:not(.open) .filter-icon span {
  background: var(--primary-color) !important;
}

.filters-sidebar-content {
  display: none;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  gap: 8px;
  flex: 1;
  padding: 0 60px 0 15px;
  white-space: nowrap;
}

.filters-sidebar.open .filters-sidebar-content {
  display: flex;
}

.filters-sidebar h2 {
  display: none;
}

.filters-sidebar .filters {
  display: flex;
  flex-direction: row;
  gap: 8px;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
}

.filters-sidebar .filters label {
  font-size: 0.85em;
  color: var(--primary-color);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  white-space: nowrap;
}

.filters-sidebar .filters input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  border: 2px solid #ffffff;
  border-radius: 3px;
  margin: 0;
  position: relative;
  cursor: pointer;
}

.filters-sidebar .filters input[type="checkbox"]:checked {
  background-color: rgba(255, 255, 255, 0.8);
}

.filters-sidebar .filters input[type="checkbox"]:checked::after {
  content: '✓';
  position: absolute;
  color: var(--primary-color);
  font-size: 12px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-weight: bold;
}

.filters-sidebar .filters select {
  font-size: 0.85em;
  padding: 5px 25px 5px 10px;
  min-width: 120px;
  background-color: rgba(255, 255, 255, 0.9);
}

/* Style pour la liste déroulante personnalisée des coachs */
.coach-dropdown {
  position: relative;
  min-width: 140px;
}

.coach-dropdown-button {
  width: 100%;
  padding: 6px 28px 6px 12px;
  font-size: 0.85em;
  background-color: rgba(255, 255, 255, 0.8);
  border: 1px solid #ffffff;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: var(--primary-color);
}

.coach-dropdown-button:hover {
  background-color: rgba(255, 255, 255, 1);
}

.coach-dropdown-arrow {
  font-size: 0.7em;
  transition: transform 0.3s;
}

.coach-dropdown.open .coach-dropdown-arrow {
  transform: rotate(180deg);
}

.coach-dropdown-content {
  display: none !important;
  position: absolute;
  bottom: 100%;
  top: auto;
  left: 0;
  right: 0;
  background-color: rgba(255, 255, 255, 0.8);
  border: 1px solid #ffffff;
  border-radius: 8px;
  max-height: 200px;
  overflow-y: auto;
  z-index: 1002;
  margin-bottom: 2px;
  margin-top: 0;
  box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.15);
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.2s, visibility 0.2s;
}

.coach-dropdown.open .coach-dropdown-content {
  display: block !important;
  visibility: visible;
  opacity: 1;
}

.coach-dropdown-option {
  padding: 8px 10px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.75em;
  color: var(--primary-color);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.coach-dropdown-option:last-child {
  border-bottom: none;
}

.coach-dropdown-option:hover {
  background-color: rgba(72, 6, 7, 0.1);
}

.coach-dropdown-option input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
  cursor: pointer;
  display: none;
}

.coach-dropdown-option .checkmark {
  color: var(--primary-color);
  font-weight: bold;
  margin-left: auto;
  font-size: 1em;
}

.coach-dropdown-option label {
  display: flex;
  align-items: center;
  width: 100%;
  cursor: pointer;
  gap: 10px;
}

.coach-dropdown-option-photo {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
  background-color: rgba(72, 6, 7, 0.1);
}

.coach-dropdown-option label span:first-of-type {
  flex: 1;
  font-size: 1.15em;
  color: var(--primary-color);
}

/* Style pour le bouton de retour à la vue quotidienne */
.today-view-button {
  position: fixed;
  top: 55px;
  right: 10px;
  z-index: 1000;
  background: none;
  padding: 0;
  width: 55px;
  height: 55px;
  -webkit-tap-highlight-color: transparent;
  -webkit-user-select: none;
  user-select: none;
  pointer-events: all;
  animation: none;
  display: block;
  opacity: 1;
  transform: translateY(0);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.today-view-button::before {
  content: '';
  position: absolute;
  width: 55px;
  height: 55px;
  background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/d983712e-5b70-9ebc-9696-6a677290a963.png');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  animation: rotate-icon 6s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  transform-origin: center;
  pointer-events: none;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  -webkit-transform-style: preserve-3d;
  transform-style: preserve-3d;
  will-change: transform;
  background-color: transparent;
}

.today-view-button::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 10px;
  height: 10px;
  background-color: var(--background-main);
  border-radius: 50%;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  pointer-events: none;
  z-index: 2;
}

.today-view-button.visible {
  opacity: 1;
  transform: translateY(0);
  pointer-events: all;
}

/* Afficher uniquement sur mobile */
@media screen and (max-width: 1024px) {
  .today-view-button {
    display: block;
  }
}

/* Masquer explicitement sur les écrans plus grands */
@media screen and (min-width: 768px) {
  .today-view-button {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
  }
}

/* Styles spécifiques pour les appareils mobiles avec rotation */
@media screen and (max-width: 767px) {
  .today-view-button {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: all !important;
    position: fixed !important;
    top: 55px !important;
    right: 10px !important;
    left: auto !important;
    bottom: auto !important;
    transform: translateY(0) !important;
  }
}

.today-view-button::before {
  content: '';
  position: absolute;
  width: 55px;
  height: 55px;
  background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/d983712e-5b70-9ebc-9696-6a677290a963.png');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  animation: rotate-icon 6s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  transform-origin: center;
  pointer-events: none;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  -webkit-transform-style: preserve-3d;
  transform-style: preserve-3d;
  will-change: transform;
  background-color: transparent;
}

.today-view-button button {
  z-index: 3;
  width: 100%;
  height: 100%;
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  -webkit-tap-highlight-color: transparent;
  -webkit-user-select: none;
  user-select: none;
  outline: none;
  pointer-events: all;
}

/* Suppression des styles hover qui créent l'effet de sélection */
.today-view-button:hover {
  transform: none;
  background: none;
  box-shadow: none;
}

/* Animation de zoom au clic */
.today-view-button:active::before {
  animation: click-zoom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes click-zoom {
  0% {
    transform: scale(1) translateZ(0);
  }
  50% {
    transform: scale(0.95) translateZ(0);
  }
  100% {
    transform: scale(1) translateZ(0);
  }
}

/* Styles pour le tableau du planning hebdomadaire */
.weekly-schedule {
  width: 100%;
  border-collapse: collapse;
  margin: 0 auto;
  table-layout: fixed;
}

/* Première colonne = heures (largeur au contenu), le reste = jours */
.weekly-schedule col.col-hours {
  width: 40px;
}
.weekly-schedule col.col-day {
  width: auto;
}

.weekly-schedule th, .weekly-schedule td {
  padding: 5px;
  vertical-align: top;
  border: none;
}

/* Ligne des titres avec fond rouge moins transparent et texte blanc */
.weekly-schedule thead th {
  background-color: var(--primary-color);
  color: var(--text-light);
  text-align: center;
  font-size: 1.2em;
  border-bottom: 2px solid var(--shadow-light);
  position: sticky;
  top: 0;
  z-index: 10;
  pointer-events: none;
  border-radius: 0;
  margin: 0;
}

/* Rendre invisible la première cellule du thead (cellule des horaires) */
.weekly-schedule thead th:first-child {
  background-color: transparent;
  border: none;
  box-shadow: none;
}

/* Arrondir uniquement les extrémités de la barre de titres */
.weekly-schedule thead th:nth-child(2) {
  border-top-left-radius: 5px;
  border-bottom-left-radius: 5px;
}

.weekly-schedule thead th:last-child {
  border-top-right-radius: 5px;
  border-bottom-right-radius: 5px;
}

/* Animation améliorée pour le jour actuel */
.weekly-schedule thead th.today {
  background-color: #981010;
  position: sticky;
  top: 0;
  z-index: 10;
  color: var(--text-light);
  overflow: hidden;
  pointer-events: none;
  margin: 0;
}

/* Préserver les bordures courbées même quand le jour est surligné */
.weekly-schedule thead th.today:nth-child(2) {
  border-top-left-radius: 5px;
  border-bottom-left-radius: 5px;
}

.weekly-schedule thead th.today:last-child {
  border-top-right-radius: 5px;
  border-bottom-right-radius: 5px;
}

/* Suppression de l'animation de balayage */
.weekly-schedule thead th.today::before {
  display: none;
}

/* Animation de balayage de lumière */
@keyframes lightSweep {
  0% {
    left: -150%;
  }
  100% {
    left: 150%;
  }
}

  /* Cellules de la colonne des heures (la largeur vient de colgroup) */
  .weekly-schedule th:first-child,
  .weekly-schedule td.time-cell {
    text-align: center;
    padding: 2px 1px;
    font-weight: bold;
    color: var(--primary-color);
    white-space: nowrap;
  }

  /* Alternance de couleurs pour les time-cell */
  .weekly-schedule td.time-cell-white {
    background-color: var(--background-card);
    color: var(--primary-color);
    text-align: center;
  }

  .weekly-schedule td.time-cell-grey {
    background-color: var(--background-main);
    color: var(--primary-color);
    text-align: center;
  }

  /* Séparation matin / après-midi : motif 64×64 en tuilage, 50 % opaque ; colonne heures sans fond ni motif */
  .weekly-schedule tr.noon-separator td {
    height: 86px;
    min-height: 86px;
    padding: 0;
    margin: 0;
    border: none;
    background-color: rgba(72, 6, 7, 0.12);
    position: relative;
    vertical-align: middle;
  }

  .weekly-schedule tr.noon-separator td::before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    background-image: url(https://mcusercontent.com/74abea872abd45d46efed5d41/images/2d4c73b7-fe42-6a75-9542-d52da9dcc082.png);
    background-size: 85px 85px;
    background-repeat: repeat;
    opacity: 0.4;
    pointer-events: none;
    z-index: 0;
  }

  /* Ajustement des cellules des cours : largeur pleine pour éviter conteneurs rétrécis */
  .course-cell {
    min-width: 100px;
    text-align: left;
    border-bottom: 1px solid var(--shadow-light);
    position: relative;
    padding: 5px;
    width: 100%;
  }

  /* Styles pour les lignes blanches et grises */
  .course-row-white .course-cell {
    background-color: var(--background-card);
    color: var(--text-primary);
  }

  .course-row-grey .course-cell {
    background-color: var(--background-main);
    color: var(--text-primary);
  }

  /* Ajustement des blocs de cours : padding uniforme, ombres comme weekly_vertical */
  .course-block {
    background-color: var(--background-card);
    border: none;
    border-radius: 10px;
    padding: 5px;
    margin: 2px;
    font-size: 0.9em;
    position: relative;
    text-align: left;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09), 0 1px 3px rgba(0, 0, 0, 0.05);
    width: 100%;
    box-sizing: border-box;
    min-width: 0;
  }

  /* Styles pour les cours mixtes */
  .course-block.mixte {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09), 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  /* Styles pour les cours femmes */
  .course-block.women-only {
    background-color: var(--women-color-light);
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09), 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .course-block.women-only::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-women);
    opacity: 0.4;
    border-radius: 10px;
    pointer-events: none;
    z-index: 0;
  }

  .course-block.women-only > * {
    position: relative;
    z-index: 1;
  }

  /* Styles pour les cours piscine */
  .course-block.piscine {
    background-color: var(--pool-color-light);
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09), 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .course-block.piscine::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-pool);
    opacity: 0.4;
    border-radius: 10px;
    pointer-events: none;
    z-index: 0;
  }

  .course-block.piscine > * {
    position: relative;
    z-index: 1;
  }

  /* Styles pour les cours en cours */
  .course-block.current {
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12), 0 1px 4px rgba(0, 0, 0, 0.06);
    font-weight: bold;
  }

  /* Styles pour les cours qui vont bientôt démarrer */
  .course-block.starting-soon {
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12), 0 1px 4px rgba(0, 0, 0, 0.06);
    animation: pulse 1.5s infinite;
  }

  /* Styles pour les cours passés */
  .course-block.past {
    opacity: 0.5;
    color: var(--state-past);
  }

  /* Style pour le titre du cours */
  .course-title {
    font-weight: bold;
    margin-bottom: 2px;
    font-size: 1.3em;
  }

  /* Style pour le nom du coach */
  .coach-name {
    font-size: 0.8em;
    color: var(--text-secondary);
  }

  /* Style pour le studio */
  .studio-name {
    font-size: 0.7em;
    color: var(--text-tertiary);
  }

  /* Animation de pulsation optimisée */
  @keyframes pulse {
    0% { 
      transform: scale(1) translateZ(0);
      opacity: 1;
    }
    50% { 
      transform: scale(1.02) translateZ(0);
      opacity: 0.95;
    }
    100% { 
      transform: scale(1) translateZ(0);
      opacity: 1;
    }
  }

/* Styles pour la pilule de compte à rebours */
.countdown-pill {
    position: absolute;
    top: 5px; /* Changé de -11px à 5px pour descendre la pilule */
    right: 0;
    transform: translateX(0);
    width: 30px;
    height: 15px;
    background-color: var(--secondary-color);
    color: var(--primary-color);
    border-radius: 7px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
    font-weight: bold;
    padding: 0 2px;
    box-shadow: 0 1px 3px var(--shadow-medium);
    z-index: 5;
}


  /* Styles pour les cours "100% Femmes" */
  .course-block.women-only {
    background-color: var(--women-color-light);
    border: none;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09), 0 1px 3px rgba(0, 0, 0, 0.05);
    position: relative;
  }

  .course-block.women-only::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-women);
    opacity: 0.4;
    border-radius: 10px;
    pointer-events: none;
    z-index: 0;
  }

  .course-block.women-only > * {
    position: relative;
    z-index: 1;
  }

  /* Styles pour les cours "Piscine" */
  .course-block.piscine {
    background-color: var(--pool-color-light);
    border: none;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09), 0 1px 3px rgba(0, 0, 0, 0.05);
    position: relative;
  }

  .course-block.piscine::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-pool);
    opacity: 0.4;
    border-radius: 10px;
    pointer-events: none;
    z-index: 0;
  }

  .course-block.piscine > * {
    position: relative;
    z-index: 1;
  }

  /* Styles spécifiques pour les logos de cours (+10 %) */
  .logo-cours {
    max-width: 100%;
    max-height: 12px;
    object-fit: contain;
    display: block;
    margin: 0;
  }

  /* Styles pour les cours : nom de cours -5 %, conteneur pleine largeur */
  .course-info {
    font-size: 1.24em;
    font-weight: bold;
    color: var(--text-primary);
    margin-right: 0;
    padding-right: 0;
    text-align: left;
    width: 100%;
    min-width: 0;
    box-sizing: border-box;
  }

  /* Nom du cours : une seule ligne, sans retour à la ligne */
  .course-name-text {
    display: block;
    width: 100%;
    max-width: 100%;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-align: left;
    box-sizing: border-box;
  }

  .course-block .course-info .course-name-text.multiline {
    font-size: 0.78em;
  }

  .single-coach {
    font-size: 0.85em;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin-top: 1px;
    color: var(--primary-color);
    width: 100%;
    min-width: 0;
  }

  .single-coach span {
    color: var(--primary-color);
    white-space: nowrap;
    overflow: hidden;
    min-width: 0;
  }

  .single-coach img {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    margin-right: 5px;
    margin-left: 10px; /* Ajoute de l'espace à gauche de l'image */
    margin-bottom: 2px;
  }

  /* Couleur des noms de coachs selon le type de cours */
  .course-block.piscine .single-coach span {
    color: var(--text-light);
  }

  .course-block.women-only:not(.piscine) .single-coach span {
    color: var(--text-light);
  }

  /* Styles pour les coachs multiples avec uniquement les images */
  .multiple-coaches {
    display: flex;
    justify-content: flex-start;
    gap: 1px; /* Espacement entre les images */
  }

  .coach-image {
    width: 30px; /* Largeur de l'image */
    height: 30px; /* Hauteur de l'image */
    border-radius: 50%; /* Pour que l'image soit ronde */
  }

  /* Cacher les coachs si le filtre est décoché */
  .hide-coaches .single-coach,
  .hide-coaches .multiple-coaches {
    display: none;
  }

  #weeklySchedule {
    height: 100%;
  }

  /* Styles spécifiques pour les appareils mobiles avec rotation */
  @media screen and (max-width: 767px) {
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: fixed;
    }

    body {
      transform: rotate(90deg);
      transform-origin: bottom left;
      position: fixed;
      top: -100vw;
      left: 0;
      width: 100vh;
      height: 100vw;
    }

    .content-wrapper {
      width: 100%;
      height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 10px;
      box-sizing: border-box;
      -webkit-overflow-scrolling: touch;
      position: relative;
    }

    #weeklySchedule {
      width: 100%;
      height: auto;
      transform: none !important;
      touch-action: pan-y;
    }

    .weekly-schedule {
      width: 100%;
      font-size: 0.7em;
      table-layout: fixed;
      transform: none !important;
      touch-action: pan-y;
    }

    /* En rotation 90° : colonne heures légèrement élargie pour voir toute l'heure */
    .weekly-schedule col.col-hours {
      width: 36px !important;
    }

    .weekly-schedule th,
    .weekly-schedule td {
      padding: 5px 2px;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
      border: none;
      margin: 0;
      touch-action: pan-y;
    }

      /* Colonne des heures au strict minimum en rotation 90° (weekly.html) */
    .weekly-schedule th:first-child {
      width: 22px !important;
      min-width: 22px !important;
      max-width: 26px !important;
      text-align: center;
      writing-mode: vertical-rl;
      white-space: nowrap;
      padding: 1px;
      transform: none;
      font-size: 1em;
    }

      .weekly-schedule th:not(:first-child) {
      width: calc((100% - 22px) / 7) !important;
      padding: 2px;
    }

    .weekly-schedule .time-cell {
      width: 22px !important;
      min-width: 22px !important;
      max-width: 26px !important;
      writing-mode: unset;
      font-size: 1em;
      white-space: nowrap;
      padding: 1px;
      text-align: center;
      transform: none;
    }

    .weekly-schedule .course-cell {
      width: calc((100% - 22px) / 7) !important;
      padding: 2px;
    }

    /* Padding uniforme, justification à gauche, largeur pleine pour éviter retours prématurés */
    .weekly-schedule .course-block {
      padding: 5px;
      margin-bottom: 2px;
      text-align: left;
      width: 100% !important;
      min-width: 0;
      box-sizing: border-box;
    }

    .weekly-schedule .course-info {
      margin-bottom: 2px;
      font-size: 1em !important;
      width: 100% !important;
      min-width: 0;
    }

    .weekly-schedule .course-name-text {
      white-space: nowrap;
      overflow: hidden;
      width: 100% !important;
      min-width: 0;
    }

    .weekly-schedule .course-block .course-info .course-name-text.multiline {
      font-size: 0.74em !important;
    }

    .single-coach,
    .multiple-coaches {
      font-size: 0.7em !important;
      white-space: nowrap;
      overflow: hidden;
    }

    .single-coach span {
      white-space: nowrap;
      overflow: hidden;
    }

    .single-coach img {
      width: 20px;
      height: 20px;
      margin-left: 0px;
      margin-bottom: 0px;
    }

    /* Logos de cours en mobile (+10 %) */
    .weekly-schedule .logo-cours {
      max-width: 100% !important;
      max-height: 20px !important;
    }

    .multiple-coaches .coach-image {
      width: 15px;
      height: 15px;
    }

    /* Ajustement de la taille du cercle de compte à rebours en rotation */
    .countdown-circle {
      width: 15px;
      height: 15px;
      font-size: 0.5em;
      top: -8px;
      right: -8px;
    }

    /* Styles pour les filtres en vue mobile */
    .header-wrapper {
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      flex-wrap: nowrap;
    }

    .header-wrapper h1 {
      font-size: 1.5em;
      margin: 0;
      flex-shrink: 1;
    }

    .filters {
      justify-content: center;
      flex-wrap: nowrap;
      gap: 5px;
    }

    .filters label {
      font-size: 0.8em;
    }
/* Masquer la liste déroulante de coachs uniquement en mode paysage sur mobile */
    #coachFilter {
      display: none;
    }

  }

  /* Masquer tous les éléments pendant le chargement */
  body.loading .content-wrapper,
  body.loading .header-wrapper,
  body.loading .today-view-button,
  body.loading .filters,
  body.loading h1,
  body.loading #weeklySchedule {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
  }

  /* Nouveau système de modal */
  .modal-backdrop {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background-color: rgba(72,6,7, 1) !important;
    z-index: 999999 !important;
    display: none;
    overflow: hidden !important;
    pointer-events: all !important;
    opacity: 1 !important;
  }

  .modal-content {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 1000000 !important;
    display: none;
    overflow: hidden !important;
    pointer-events: none !important;
    background-color: transparent !important;
  }

  .modal-center-container {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    width: auto !important;
    height: auto !important;
    pointer-events: none !important;
    gap: 50px !important;
    background-color: transparent !important;
  }

  /* Style par défaut pour mobile */
  .modal-center-container img {
    width: 100px !important;
    height: auto !important;
    animation: zoom-logo 2s infinite !important;
    pointer-events: none !important;
  }

  /* Style pour tablettes */
  @media screen and (min-width: 768px) {
    .modal-center-container img {
      width: 140px !important;
    }
  }

  /* Style pour desktop */
  @media screen and (min-width: 1024px) {
    .modal-center-container img {
      width: 170px !important;
    }
  }

  .modal-center-container #loadingMessage {
    font-size: 1.2em !important;
    color: #fff !important;
    text-align: center !important;
    width: 80% !important;
    max-width: 600px !important;
    background-color: rgba(255, 255, 255, 0.2) !important;
    padding: 10px !important;
    border-radius: 10px !important;
    pointer-events: none !important;
    margin-top: -15px !important;
  }

  /* Ajustement du modal pour la rotation */
  @media screen and (max-width: 767px) {
    body {
      transform: rotate(90deg);
      transform-origin: bottom left;
      position: fixed;
      top: -100vw;
      left: 0;
      width: 100vh;
      height: 100vw;
    }

    .modal-backdrop {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vh !important;
      height: 100vw !important;
      background-color: rgba(72,6,7, 0.95) !important;
      z-index: 999999 !important;
      display: none;
      overflow: hidden !important;
      pointer-events: all !important;
      opacity: 1 !important;
      transform: none !important;
    }

    .modal-content {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vh !important;
      height: 100vw !important;
      z-index: 1000000 !important;
      display: none;
      overflow: hidden !important;
      pointer-events: none !important;
      background-color: transparent !important;
      transform: none !important;
    }

    .modal-center-container {
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
      width: auto !important;
      height: auto !important;
      pointer-events: none !important;
      gap: 50px !important;
      background-color: transparent !important;
    }

    /* Ajout de l'animation de rotation pour mobile */
    .modal-center-container img {
      animation: rotateAndPulse 1.5s ease-in-out forwards !important;
    }
  }

  @keyframes rotateAndPulse {
    0% {
      transform: rotate(-90deg) translateZ(0);
    }
    100% {
      transform: rotate(0deg) translateZ(0);
    }
  }

  @keyframes zoom-logo {
    0%, 100% {
      transform: scale(1) translateZ(0);
      opacity: 0.9;
    }
    50% {
      transform: scale(1.05) translateZ(0);
      opacity: 1;
    }
  }

  /* Ajout des styles pour le masquage initial */
  body.loading .content-wrapper {
    visibility: hidden;
    opacity: 0;
  }

  body.loading .header-wrapper {
    visibility: hidden;
    opacity: 0;
  }

  .loading-logo img {
    width: 80px;
    height: auto;
    animation: zoom-logo 2s ease-in-out infinite;
  }

  @keyframes rotate-icon {
    0% {
      transform: rotate(0deg) translateZ(0);
    }
    50% {
      transform: rotate(180deg) translateZ(0);
    }
    100% {
      transform: rotate(360deg) translateZ(0);
    }
  }

  @keyframes auraPulse {
    0%, 100% {
      box-shadow: 0 0 15px var(--overlay-light), 0 0 30px var(--overlay-lighter), 0 0 45px var(--overlay-lighter);
    }
    5% {
      box-shadow: 0 0 25px var(--overlay-lighter), 0 0 40px var(--overlay-lighter), 0 0 55px var(--overlay-lighter);
    }
    10% {
      box-shadow: 0 0 15px var(--overlay-light), 0 0 30px var(--overlay-lighter), 0 0 45px var(--overlay-lighter);
    }
    15%, 100% {
      box-shadow: 0 0 15px var(--overlay-light), 0 0 30px var(--overlay-lighter), 0 0 45px var(--overlay-lighter);
    }
  }

  /* Styles pour l'ascenseur personnalisé */
  .custom-scrollbar {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    height: calc(100% - 200px);
    width: 50px;
    z-index: 1000;
    pointer-events: auto;
    opacity: 1;
  }

  .scrollbar-track {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 60%;
    background-color: var(--primary-lighter);
    box-shadow: 0 0 8px var(--primary-lighter);
    border-radius: 2px;
    opacity: 0.3;
  }

  /* Masquer le track sur les résolutions non mobiles */
  @media screen and (min-width: 768px) {
    .scrollbar-track {
      display: none;
    }
  }

  .scrollbar-thumb {
    position: absolute;
    right: 0;
    width: 4px;
    background-color: transparent;
    border-radius: 2px;
    transition: all 0.2s ease;
    box-shadow: none;
    opacity: 0;
  }

  .scrollbar-thumb:hover,
  .scrollbar-thumb:active {
    background-color: transparent;
    box-shadow: none;
    width: 4px;
    right: 0;
    opacity: 0;
  }

  .scrollbar-touch-area {
    position: absolute;
    right: -20px;
    width: 50px;
    height: 100%;
    cursor: pointer;
    background-color: transparent;
    border-radius: 25px;
  }

  /* Ajustement pour la rotation mobile */
  @media screen and (max-width: 767px) {
    .custom-scrollbar {
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      height: calc(100% - 200px);
      width: 50px;
    }

    .scrollbar-track {
      width: 4px;
      opacity: 0.3;
      display: block;
      height: 60%;
      top: 50%;
      transform: translateY(-50%);
    }

    .scrollbar-thumb {
      width: 4px;
      opacity: 0;
    }

    .scrollbar-thumb:hover,
    .scrollbar-thumb:active {
      width: 4px;
      right: 0;
      opacity: 0;
    }

    .scrollbar-touch-area {
      right: -20px;
      width: 50px;
    }
  }

</style>
</head>
<body onload="initializeWeeklyPage();">
  <!-- Nouveau système de modal -->
  <div class="modal-backdrop" style="background-color: rgba(72,6,7, 1) !important;"></div>
  <div class="modal-content">
    <div class="modal-center-container">
      <img src="https://mcusercontent.com/74abea872abd45d46efed5d41/images/8fd797c9-5e06-60a8-1720-128bcf9390cf.png" alt="Logo du Club">
      <div id="loadingMessage">Chargement du planning hebdomadaire</div>
    </div>
  </div>

  <div class="content-wrapper">

    <!-- Bouton de rotation vers weekly_vertical.html -->
    <div class="rotation-view-button" id="rotationViewButton" role="button" tabindex="0" aria-label="Vue verticale du planning" onclick="goToWeeklyVertical()">
      <button type="button" aria-label="Vue verticale du planning"></button>
    </div>

    <!-- Bouton pour revenir à aujourd'hui -->
    <div class="today-view-button" id="todayViewButton">
      <button onclick="returnToToday()">
      </button>
    </div>

    <!-- En-tête avec le titre et les filtres -->
    <div class="header-wrapper">
      <h1>Planning Hebdomadaire</h1>
      <div class="filters">
        <label>
          <input type="checkbox" id="filter-mixte" checked>
          Mixte
        </label>
        <label>
          <input type="checkbox" id="filter-women-only" checked>
          100% Femmes
        </label>
        <label>
          <input type="checkbox" id="filter-piscine" checked>
          Piscine
        </label>
        <label>
          <input type="checkbox" id="filter-coach" checked>
          Coach
        </label>
      </div>
    </div>

    <!-- Le planning hebdomadaire sera inséré ici -->
    <div id="weeklySchedule"></div>

  </div>

  <!-- Bouton switch planning Ramadan (au-dessus du bouton de rotation, mobile uniquement) -->
  <button id="ramadanSwitchButton" class="ramadan-switch-button">
    <img src="https://mcusercontent.com/74abea872abd45d46efed5d41/images/4ec582c4-20c6-2c4a-8bc6-9121f0913a3c.png" alt="Switch Ramadan" class="ramadan-icon">
    <div class="confetti-container"></div>
  </button>

  <!-- Barre de filtres en bas avec le bouton intégré -->
  <div class="filters-sidebar" id="filtersSidebar">
    <button class="filter-button" onclick="toggleFiltersSidebar(event)">
      <div class="filter-icon"><span></span></div>
    </button>
    <div class="filters-sidebar-content">
      <div class="filters">
        <label>
          <input type="checkbox" id="filter-mixte-sidebar" checked>
          Mixte
        </label>
        <label>
          <input type="checkbox" id="filter-women-only-sidebar" checked>
          Femmes
        </label>
        <label>
          <input type="checkbox" id="filter-piscine-sidebar" checked>
          Piscine
        </label>
        <label>
          <input type="checkbox" id="filter-coach-sidebar" checked>
          Coach
        </label>
        <div class="coach-dropdown">
          <button class="coach-dropdown-button" id="coachDropdownButton">
            <span id="coachDropdownText">Sélection coach</span>
            <span class="coach-dropdown-arrow">▼</span>
          </button>
          <div class="coach-dropdown-content" id="coachDropdownContent">
            <!-- Les options seront ajoutées ici dynamiquement -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Option pour afficher/masquer les logos de cours
    const SHOW_COURSE_IMAGES = true;
    
    // Initialiser les variables
    var scheduleData = [];
    var activePlanningView = 'regulier'; // 'regulier' | 'ramadan'

    // Mise à jour de la visibilité du bouton Ramadan au resize et attacher l'event listener
    (function initRamadanButtonResize() {
      function update() {
        if (scheduleData && typeof renderPlanningViewSwitcher === 'function') renderPlanningViewSwitcher(scheduleData);
      }
      function attachListener() {
        var ramadanButton = document.getElementById('ramadanSwitchButton');
        if (ramadanButton) {
          // Retirer l'ancien listener s'il existe et en ajouter un nouveau
          ramadanButton.removeEventListener('click', toggleRamadanPlanning);
          ramadanButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Clic détecté sur le bouton Ramadan');
            toggleRamadanPlanning();
          });
          console.log('Event listener attaché au bouton Ramadan');
        } else {
          console.warn('Bouton ramadanSwitchButton non trouvé lors de l\'initialisation');
        }
        window.addEventListener('resize', update);
      }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', attachListener);
      } else {
        attachListener();
      }
    })();

    /** Retourne le planning actuellement affiché (régulier ou Ramadan). Si Ramadan vide, affiche le régulier. */
    function getCurrentPlanning() {
      if (!scheduleData || !scheduleData.planning) return {};
      if (activePlanningView === 'ramadan' && scheduleData.planningRamadan) {
        var pr = scheduleData.planningRamadan;
        var hasCourses = Object.keys(pr).some(function(day) { return pr[day] && pr[day].length > 0; });
        if (hasCourses) return pr;
      }
      return scheduleData.planning;
    }

    /** Initialise activePlanningView depuis URL, localStorage ou période (ramadanStart/ramadanEnd). */
    function initPlanningView(data) {
      var params = new URLSearchParams(window.location.search);
      var urlView = params.get('planning');
      var stored = localStorage.getItem('planningView');
      var today = new Date().toISOString().slice(0, 10);
      var ramadanStart = data.metadata && data.metadata.ramadanStart;
      var ramadanEnd = data.metadata && data.metadata.ramadanEnd;
      var inRamadan = ramadanStart && ramadanEnd && today >= ramadanStart && today <= ramadanEnd;
      var daysBeforeRamadan = 7;
      var showRamadanButton = ramadanStart && data.planningRamadan && today < ramadanStart && (new Date(ramadanStart) - new Date(today)) / (24*60*60*1000) <= daysBeforeRamadan;

      if (urlView === 'ramadan' || urlView === 'regulier') {
        activePlanningView = urlView;
        localStorage.setItem('planningView', urlView);
      } else if (stored === 'ramadan' || stored === 'regulier') {
        activePlanningView = stored;
      } else if (inRamadan) {
        activePlanningView = 'ramadan';
        localStorage.setItem('planningView', 'ramadan');
      } else {
        activePlanningView = 'regulier';
        localStorage.setItem('planningView', 'regulier');
      }
      document.body.classList.toggle('planning-ramadan', activePlanningView === 'ramadan');
    }

    /** Affiche ou masque le bouton flottant Ramadan selon période et contexte (mobile uniquement). */
    function renderPlanningViewSwitcher(data) {
      var ramadanButton = document.getElementById('ramadanSwitchButton');
      if (!ramadanButton) {
        console.warn('renderPlanningViewSwitcher: bouton ramadanSwitchButton non trouvé');
        return;
      }
      if (!data) {
        console.warn('renderPlanningViewSwitcher: pas de données');
        return;
      }
      var isMobile = window.innerWidth <= 768;
      console.log('renderPlanningViewSwitcher: isMobile=', isMobile, 'window.innerWidth=', window.innerWidth);
      if (!isMobile) {
        ramadanButton.style.display = 'none';
        return;
      }
      var meta = data.metadata || {};
      var ramadanStart = meta.ramadanStart;
      var ramadanEnd = meta.ramadanEnd;
      var today = new Date().toISOString().slice(0, 10);
      var inRamadan = ramadanStart && ramadanEnd && today >= ramadanStart && today <= ramadanEnd;
      var daysBefore = 7;
      var showSwitcher = (data.planningRamadan && ramadanStart) && (
        inRamadan || (today < ramadanStart && (new Date(ramadanStart) - new Date(today)) / (24*60*60*1000) <= daysBefore)
      );
      console.log('renderPlanningViewSwitcher: showSwitcher=', showSwitcher, 'ramadanStart=', ramadanStart, 'planningRamadan présent=', !!data.planningRamadan);
      if (showSwitcher) {
        ramadanButton.style.display = 'flex';
        ramadanButton.style.pointerEvents = 'auto';
        setTimeout(function() { ramadanButton.classList.add('loaded'); }, 100);
        console.log('Bouton Ramadan affiché');
      } else {
        ramadanButton.style.display = 'none';
        console.log('Bouton Ramadan masqué');
      }
    }
    function toggleRamadanPlanning() {
      console.log('toggleRamadanPlanning appelé, activePlanningView actuel:', activePlanningView);
      var button = document.getElementById('ramadanSwitchButton');
      if (!button) {
        console.error('Bouton ramadanSwitchButton non trouvé');
        return;
      }
      
      // Animation d'explosion de paillettes sur toute la page
      var color = document.body.classList.contains('planning-ramadan') ? '#480607' : '#26462d';
      var pageConfettiContainer = document.getElementById('pageConfettiContainer');
      if (!pageConfettiContainer) {
        pageConfettiContainer = document.createElement('div');
        pageConfettiContainer.id = 'pageConfettiContainer';
        pageConfettiContainer.style.cssText = 'position: fixed; inset: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2147483647; overflow: visible;';
        (document.documentElement || document.body).appendChild(pageConfettiContainer);
      }
      
      // Créer beaucoup plus de paillettes qui se répandent sur toute la page
      var buttonRect = button.getBoundingClientRect();
      var centerX = buttonRect.left + buttonRect.width / 2;
      var centerY = buttonRect.top + buttonRect.height / 2;
      
      for (var i = 0; i < 100; i++) {
        var burst = document.createElement('div');
        burst.className = 'confetti-burst';
        burst.style.cssText = 'position: absolute; width: 8px; height: 8px; border-radius: 50%; background: ' + color + '; z-index: 2147483647;';
        burst.style.left = centerX + 'px';
        burst.style.top = centerY + 'px';
        var angle = (Math.random() * 360) * Math.PI / 180;
        var distance = 200 + Math.random() * 400;
        var x = Math.cos(angle) * distance;
        var y = Math.sin(angle) * distance;
        burst.style.setProperty('--burst-x', x + 'px');
        burst.style.setProperty('--burst-y', y + 'px');
        pageConfettiContainer.appendChild(burst);
        setTimeout(function(el) { if (el && el.parentNode) el.remove(); }, 2000, burst);
      }
      
      var currentView = activePlanningView === 'ramadan' ? 'regulier' : 'ramadan';
      console.log('Basculement vers:', currentView);
      setPlanningView(currentView);
    }

    /** Bascule l’affichage vers planning Ramadan ou régulier et rafraîchit. */
    function setPlanningView(view) {
      console.log('setPlanningView appelé avec view:', view, 'scheduleData:', scheduleData ? 'présent' : 'absent');
      activePlanningView = view;
      try {
        localStorage.setItem('planningView', view);
      } catch(e) {
        console.warn('Erreur localStorage:', e);
      }
      document.body.classList.toggle('planning-ramadan', view === 'ramadan');
      refreshPlanningDisplay();
      if (scheduleData) {
        renderPlanningViewSwitcher(scheduleData);
      }
    }

    /** Re-génère le planning et met à jour la liste des coachs (sidebar). */
    function refreshPlanningDisplay() {
      if (!scheduleData || !scheduleData.planning) return;
      document.getElementById('weeklySchedule').innerHTML = generateWeeklyScheduleHtml();
      markMultilineCourseNames();
      var planningData = getCurrentPlanning();
      var coachsData = scheduleData.coachs;
      var defaultCoachImage = 'https://mcusercontent.com/74abea872abd45d46efed5d41/images/8fd797c9-5e06-60a8-1720-128bcf9390cf.png';
      var uniqueCoachesMap = new Map();
      Object.values(planningData).forEach(dayCourses => {
        (dayCourses || []).forEach(course => {
          if (course.coachIds) {
            course.coachIds.forEach(coachId => {
              var coach = coachsData.find(c => c.id === coachId);
              if (coach && !uniqueCoachesMap.has(coach.name)) uniqueCoachesMap.set(coach.name, { name: coach.name, imageUrl: coach.imageUrl || defaultCoachImage });
            });
          }
        });
      });
      var coachDropdownContent = document.querySelector('#filtersSidebar .coach-dropdown-content');
      var coachDropdownText = document.querySelector('#filtersSidebar #coachDropdownText');
      if (coachDropdownContent) {
        coachDropdownContent.innerHTML = '';
        Array.from(uniqueCoachesMap.values()).sort((a,b) => a.name.localeCompare(b.name)).forEach(function(coachObj) {
          var option = document.createElement('div');
          option.className = 'coach-dropdown-option';
          var label = document.createElement('label');
          label.style.cssText = 'display:flex;justify-content:space-between;align-items:center;width:100%;cursor:pointer';
          var img = document.createElement('img');
          img.className = 'coach-dropdown-option-photo';
          img.src = coachObj.imageUrl;
          img.alt = coachObj.name;
          var span = document.createElement('span');
          span.textContent = coachObj.name;
          span.style.flex = '1';
          var cb = document.createElement('input');
          cb.type = 'checkbox';
          cb.value = coachObj.name;
          label.appendChild(img);
          label.appendChild(span);
          label.appendChild(cb);
          option.appendChild(label);
          coachDropdownContent.appendChild(option);
        });
      }
      renderPlanningViewSwitcher(scheduleData);
      applyFilters();
    }

    // Paramètre pour activer/désactiver l'overlay de chargement
    const SHOW_LOADING_OVERLAY = false; // Mettre à true pour réactiver l'overlay
    
    function initializeWeeklyPage() {
      // Ajouter la classe loading au body seulement si l'overlay est activé
      if (SHOW_LOADING_OVERLAY) {
        document.body.classList.add('loading');
      }
      
      // Masquer le bouton today-view au démarrage
      const todayButton = document.getElementById('todayViewButton');
      if (todayButton) {
        todayButton.style.display = 'none';
        todayButton.classList.remove('visible');
      }
      
      // Afficher l'overlay de chargement seulement si activé
      const loadingOverlay = document.getElementById('loadingOverlay');
      if (loadingOverlay && SHOW_LOADING_OVERLAY) {
        loadingOverlay.style.display = 'flex';
      } else if (loadingOverlay) {
        loadingOverlay.style.display = 'none';
      }

      // Afficher le modal de chargement seulement si activé
      const modalBackdrop = document.querySelector('.modal-backdrop');
      const modalContent = document.querySelector('.modal-content');
      
      if (modalBackdrop && modalContent && SHOW_LOADING_OVERLAY) {
        modalBackdrop.style.display = 'block';
        modalContent.style.display = 'block';
        document.getElementById('loadingMessage').innerHTML = 'Chargement du planning hebdomadaire';
      } else if (modalBackdrop && modalContent) {
        modalBackdrop.style.display = 'none';
        modalContent.style.display = 'none';
      }

      // Ajouter un délai artificiel de 2 secondes seulement si l'overlay est activé
      const delay = SHOW_LOADING_OVERLAY ? 2000 : 0;
      setTimeout(() => {
        fetchWeeklyData().then(data => {
          scheduleData = data;
          initPlanningView(data);
          
          // Attacher l'event listener AVANT renderPlanningViewSwitcher
          var ramadanButton = document.getElementById('ramadanSwitchButton');
          if (ramadanButton) {
            // Cloner le bouton pour retirer tous les anciens listeners
            var newButton = ramadanButton.cloneNode(true);
            ramadanButton.parentNode.replaceChild(newButton, ramadanButton);
            ramadanButton = newButton;
            
            ramadanButton.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              console.log('Clic détecté sur le bouton Ramadan');
              toggleRamadanPlanning();
            });
            
            console.log('Event listener attaché au bouton Ramadan');
          }
          
          renderPlanningViewSwitcher(data);


          console.group('Traitement des données');
          console.log('Données reçues:', data);
          console.log('Planning actif:', activePlanningView, 'Planning:', getCurrentPlanning());
          console.groupEnd();

          document.getElementById('weeklySchedule').innerHTML = generateWeeklyScheduleHtml();
          markMultilineCourseNames();

          // Cacher le modal de chargement et retirer la classe loading seulement si activé
          if (modalBackdrop && modalContent && SHOW_LOADING_OVERLAY) {
            modalBackdrop.style.display = 'none';
            modalContent.style.display = 'none';
            modalBackdrop.style.opacity = '0';
            modalContent.style.opacity = '0';
          }
          
          // Retirer la classe loading du body seulement si activé
          if (SHOW_LOADING_OVERLAY) {
            document.body.classList.remove('loading');
          }
          
          // S'assurer que l'overlay est bien caché
          if (loadingOverlay) {
            loadingOverlay.style.display = 'none';
            loadingOverlay.style.opacity = '0';
          }

          // Récupérer la liste unique de coachs (nom -> { name, imageUrl }) pour le menu déroulant
          var planningData = getCurrentPlanning();
          var coachsData = scheduleData.coachs;
          let uniqueCoachesMap = new Map();
          const defaultCoachImage = 'https://mcusercontent.com/74abea872abd45d46efed5d41/images/8fd797c9-5e06-60a8-1720-128bcf9390cf.png';
          Object.values(planningData).forEach(dayCourses => {
            (dayCourses || []).forEach(course => {
              if (course.coachIds) {
                course.coachIds.forEach(coachId => {
                  const coach = coachsData.find(c => c.id === coachId);
                  if (coach && !uniqueCoachesMap.has(coach.name)) {
                    uniqueCoachesMap.set(coach.name, { name: coach.name, imageUrl: coach.imageUrl || defaultCoachImage });
                  }
                });
              }
            });
          });
          let uniqueCoaches = new Set(uniqueCoachesMap.keys());

          // Cibler spécifiquement la liste déroulante dans la filters-sidebar
          let coachDropdownContent = document.querySelector('#filtersSidebar .coach-dropdown-content');
          let coachDropdownButton = document.querySelector('#filtersSidebar .coach-dropdown-button');
          let coachDropdownText = document.querySelector('#filtersSidebar #coachDropdownText');
          
          if (!coachDropdownContent || !coachDropdownButton || !coachDropdownText) {
            console.error('Éléments de la liste déroulante des coachs non trouvés');
            return;
          }
          
          let selectedCoaches = new Set(); // Aucun sélectionné par défaut
          
          // Créer les options avec photo + checkboxes
          Array.from(uniqueCoachesMap.values()).sort((a, b) => a.name.localeCompare(b.name)).forEach(function(coachObj) {
            let option = document.createElement('div');
            option.className = 'coach-dropdown-option';
            
            let label = document.createElement('label');
            label.style.display = 'flex';
            label.style.justifyContent = 'space-between';
            label.style.alignItems = 'center';
            label.style.width = '100%';
            label.style.cursor = 'pointer';
            
            let img = document.createElement('img');
            img.className = 'coach-dropdown-option-photo';
            img.src = coachObj.imageUrl;
            img.alt = coachObj.name;
            
            let span = document.createElement('span');
            span.textContent = coachObj.name;
            span.style.flex = '1';
            
            let checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = coachObj.name;
            checkbox.checked = false; // Aucun sélectionné par défaut
            checkbox.style.display = 'none';
            
            let checkmark = document.createElement('span');
            checkmark.className = 'checkmark';
            checkmark.textContent = '✓';
            checkmark.style.display = 'none'; // Masqué par défaut
            
            checkbox.addEventListener('change', function() {
              if (checkbox.checked) {
                selectedCoaches.add(coachObj.name);
              } else {
                selectedCoaches.delete(coachObj.name);
              }
              checkmark.style.display = checkbox.checked ? 'inline' : 'none';
              updateCoachDropdownText();
              applyFilters();
            });
            
            option.addEventListener('click', function(e) {
              if (e.target !== checkbox) {
                e.preventDefault();
                checkbox.checked = !checkbox.checked;
                checkbox.dispatchEvent(new Event('change'));
              }
            });
            
            label.appendChild(img);
            label.appendChild(span);
            label.appendChild(checkmark);
            label.appendChild(checkbox);
            option.appendChild(label);
            coachDropdownContent.appendChild(option);
          });
          
          function updateCoachDropdownText() {
            if (selectedCoaches.size === 0) {
              coachDropdownText.textContent = 'Sélection coach';
            } else if (selectedCoaches.size === uniqueCoaches.size) {
              coachDropdownText.textContent = 'Sélection coach';
            } else {
              coachDropdownText.textContent = selectedCoaches.size === 1 ? '1 coach' : selectedCoaches.size + ' coachs';
            }
          }
          
          // Mettre à jour le texte initial du bouton
          updateCoachDropdownText();
          
          coachDropdownButton.addEventListener('click', function(e) {
            e.stopPropagation();
            const dropdown = coachDropdownButton.closest('.coach-dropdown');
            const content = coachDropdownContent;
            
            dropdown.classList.toggle('open');
          });
          
          document.addEventListener('click', function(e) {
            if (!e.target.closest('.coach-dropdown')) {
              document.querySelectorAll('.coach-dropdown').forEach(dropdown => {
                dropdown.classList.remove('open');
              });
            }
          });

          // Ajouter des écouteurs d'événements pour les filtres de cases à cocher et le filtre de coachs
          function addFilterListeners(name) {
            const header = document.getElementById('filter-' + name);
            const sidebar = document.getElementById('filter-' + name + '-sidebar');
            function onChange() {
              if (header && sidebar) sidebar.checked = header.checked;
              applyFilters();
            }
            function onSidebarChange() {
              if (header && sidebar) header.checked = sidebar.checked;
              applyFilters();
            }
            if (header) header.addEventListener('change', onChange);
            if (sidebar) sidebar.addEventListener('change', onSidebarChange);
          }
          addFilterListeners('mixte');
          addFilterListeners('women-only');
          addFilterListeners('piscine');
          addFilterListeners('coach');

          // Appliquer les filtres initiaux
          applyFilters();
          
          // Attendre que le contenu soit complètement chargé avant de faire défiler
          setTimeout(() => {
            scrollToCurrentTime();
          }, 1000);
          
          updateCountdownCircles();

          // Mettre à jour les cercles de compte à rebours toutes les secondes
          setInterval(updateCountdownCircles, 1000);

          // Afficher les boutons immédiatement
          const todayButton = document.getElementById('todayViewButton');
          if (todayButton) {
            todayButton.style.display = 'block';
            todayButton.classList.add('visible');
          }

          // Vérifier l'état des cours toutes les minutes
          setInterval(checkCourseStates, 60000);
          
          // Vérifier immédiatement après le chargement
          setTimeout(checkCourseStates, 1000);
        }).catch(error => {
          console.error('Erreur lors de la récupération des données :', error);
          document.getElementById('loadingMessage').innerHTML = 'Erreur lors du chargement des données';
          
          // En cas d'erreur, s'assurer que l'overlay est caché seulement si activé
          if (modalBackdrop && modalContent && SHOW_LOADING_OVERLAY) {
            modalBackdrop.style.display = 'none';
            modalContent.style.display = 'none';
            modalBackdrop.style.opacity = '0';
            modalContent.style.opacity = '0';
          }
          if (SHOW_LOADING_OVERLAY) {
            document.body.classList.remove('loading');
          }
          if (loadingOverlay) {
            loadingOverlay.style.display = 'none';
            loadingOverlay.style.opacity = '0';
          }
        });
      }, delay); // Délai conditionnel selon SHOW_LOADING_OVERLAY
    }

    // Fonction pour récupérer les données avec mise en cache via localStorage
    function fetchWeeklyData() {
      const cacheKey = 'weeklyData';
      const cacheExpirationKey = 'weeklyDataExpiration';
      
      // Vérifie si les données sont déjà en cache et si elles ne sont pas expirées
      const cachedData = localStorage.getItem(cacheKey);
      const cacheExpiration = localStorage.getItem(cacheExpirationKey);
      const now = new Date().getTime();

      if (cachedData && cacheExpiration && now < cacheExpiration) {
        console.log('Utilisation des données en cache');
        return Promise.resolve(JSON.parse(cachedData));
      }

      // Récupération du fichier local
      //return fetch('planning-v2.json')
      return fetch('https://raw.githubusercontent.com/canalforme-official/app-data/main/planning-v2.json')
        .then(response => {
          if (!response.ok) {
            throw new Error(`Erreur HTTP: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          // Logs détaillés de validation
          console.group('Validation des données');
          
          // Validation de la structure de base
          console.log('Structure de base:', {
            metadata: data.metadata ? '✅ Présent' : '❌ Manquant',
            coachs: data.coachs ? `✅ ${data.coachs.length} coachs` : '❌ Manquant',
            studios: data.studios ? `✅ ${data.studios.length} studios` : '❌ Manquant',
            cours: data.cours ? `✅ ${data.cours.length} cours` : '❌ Manquant',
            planning: data.planning ? `✅ ${Object.keys(data.planning).length} jours` : '❌ Manquant'
          });

          // Validation des jours du planning
          const jours = Object.keys(data.planning || {});
          console.log('Jours avec planning:', jours);
          if (data.planningRamadan) console.log('Planning Ramadan: présent');

          // Validation d'un échantillon de données
          if (jours.length > 0 && data.planning) {
            const premierJour = jours[0];
            console.log(`Exemple de cours pour ${premierJour}:`, data.planning[premierJour][0]);
          }

          console.groupEnd();

          // Stockage en cache
          localStorage.setItem(cacheKey, JSON.stringify(data));
          localStorage.setItem(cacheExpirationKey, now + 360000);
          console.log('✅ Données récupérées et stockées dans le cache');
          
          return data;
        })
        .catch(error => {
          console.error('❌ Erreur lors de la récupération des données:', error);
          throw error;
        });
    }

    // Optimisation du rendu et de la mémoire
    function optimizeRender() {
      const blocks = document.querySelectorAll('.course-block');
      const viewportHeight = window.innerHeight;

      for (const block of blocks) {
        const rect = block.getBoundingClientRect();
        const isVisible = rect.top < viewportHeight && rect.bottom > 0;
        
        if (isVisible) {
          block.style.willChange = 'transform';
          block.style.transform = 'translateZ(0)';
        } else {
          block.style.willChange = 'auto';
          block.style.transform = 'none';
        }
      }
    }

    // Gestionnaire de scroll simplifié
    function handleScroll() {
      requestAnimationFrame(optimizeRender);
    }

    // Ajouter l'écouteur d'événements avec l'option passive
    document.querySelector('.content-wrapper').addEventListener('scroll', handleScroll, { passive: true });

    // Optimisation de la fonction applyFilters (lit sidebar ou header pour éviter IDs dupliqués)
    function applyFilters() {
      const showMixte = (document.getElementById('filter-mixte-sidebar') || document.getElementById('filter-mixte')).checked;
      const showWomenOnly = (document.getElementById('filter-women-only-sidebar') || document.getElementById('filter-women-only')).checked;
      const showPiscine = (document.getElementById('filter-piscine-sidebar') || document.getElementById('filter-piscine')).checked;
      const showCoachImages = (document.getElementById('filter-coach-sidebar') || document.getElementById('filter-coach')).checked;
      
      // Récupérer tous les coachs sélectionnés
      const coachCheckboxes = document.querySelectorAll('#filtersSidebar #coachDropdownContent input[type="checkbox"]');
      const selectedCoaches = Array.from(coachCheckboxes)
        .filter(cb => cb.checked)
        .map(cb => cb.value);

      const blocks = document.querySelectorAll('.course-block');
      const contentWrapper = document.querySelector('.content-wrapper');

      for (const block of blocks) {
        const dataCoaches = block.getAttribute('data-coaches') || '';
        const courseCoaches = dataCoaches.split(',').map(coach => coach.trim());
        
        // Vérifier si au moins un des coachs du cours est dans la liste des coachs sélectionnés
        const showByCoach = selectedCoaches.length === 0 || 
          courseCoaches.some(coach => selectedCoaches.includes(coach));
        const isPiscine = block.classList.contains('piscine');
        const courseType = block.classList;
        const showByType = (
          (courseType.contains('mixte') && showMixte) ||
          (courseType.contains('women-only') && showWomenOnly)
        );

        block.style.display = (showByCoach && showByType && (!isPiscine || showPiscine)) ? 'block' : 'none';
      }

      if (showCoachImages) {
        contentWrapper.classList.remove('hide-coaches');
      } else {
        contentWrapper.classList.add('hide-coaches');
      }
    }

    // Optimisation de la fonction updateCountdownCircles
    function updateCountdownCircles() {
      const badges = document.querySelectorAll('.countdown-pill');
      
      for (const badge of badges) {
        const timeDiff = parseInt(badge.getAttribute('data-time-diff'));

        if (timeDiff >= 0) {
          const minutes = Math.floor(timeDiff / 60);
          const seconds = timeDiff % 60;
          const timeString = (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
          badge.textContent = timeString;
          badge.setAttribute('data-time-diff', timeDiff - 1);
        } else {
          badge.parentElement.classList.remove('starting-soon');
          badge.remove();
        }
      }
    }

    // Fonction pour générer le planning hebdomadaire
    function generateWeeklyScheduleHtml() {
      var weekDays = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
      var todayIndex = new Date().getDay();
      var todayName = weekDays[todayIndex];

      // Récupération des données nécessaires (planning actif = régulier ou Ramadan)
      const planning = getCurrentPlanning();
      const cours = scheduleData.cours;
      const coachs = scheduleData.coachs;
      const studios = scheduleData.studios;

      // Création d'un objet pour stocker les cours par jour et heure
      var scheduleByTimeAndDay = {};

      // Parcours de chaque jour du planning
      Object.entries(planning).forEach(([day, courses]) => {
        // Conversion du nom du jour en français
        const dayIndex = weekDays.findIndex(d => d.toLowerCase() === day);
        const frenchDay = weekDays[dayIndex];

        courses.forEach(course => {
          const startTime = course.startTime;
          
          // Initialisation de la structure si nécessaire
          if (!scheduleByTimeAndDay[startTime]) {
            scheduleByTimeAndDay[startTime] = {};
          }
          if (!scheduleByTimeAndDay[startTime][frenchDay]) {
            scheduleByTimeAndDay[startTime][frenchDay] = [];
          }

          // Recherche des informations complémentaires
          const courseInfo = cours.find(c => c.id === course.coursId);
          const studioInfo = studios.find(s => s.id === course.studioId);
          const coachsInfo = course.coachIds.map(coachId => 
            coachs.find(c => c.id === coachId)
          );

          // Ajout du cours avec toutes les informations
          scheduleByTimeAndDay[startTime][frenchDay].push({
            courseName: courseInfo ? courseInfo.name : 'Cours inconnu',
            logo: courseInfo ? courseInfo.logo : '',
            studio: studioInfo ? studioInfo.name : 'Studio inconnu',
            endTime: course.endTime,
            startTime: course.startTime,
            duration: course.duration,
            type: course.type,
            coachs: coachsInfo.map(coach => ({
              name: coach ? coach.name : 'Coach inconnu',
              imageUrl: coach ? coach.imageUrl : ''
            }))
          });
        });
      });

      var daysWithCourses = new Set();
      var timesWithCourses = new Set();

      for (var time in scheduleByTimeAndDay) {
        for (var day in scheduleByTimeAndDay[time]) {
          daysWithCourses.add(day);
          timesWithCourses.add(time);
        }
      }

      var daysArray = Array.from(daysWithCourses);
      var timesArray = Array.from(timesWithCourses);

      daysArray.sort(function(a, b) {
        return weekDays.indexOf(a) - weekDays.indexOf(b);
      });

      timesArray.sort();

      var numDays = daysArray.length;
      var html = '<table class="weekly-schedule">';
      html += '<colgroup><col class="col-hours">';
      for (var c = 0; c < numDays; c++) {
        html += '<col class="col-day">';
      }
      html += '</colgroup>';
      html += '<thead><tr><th></th>';
      for (var i = 0; i < daysArray.length; i++) {
        var dayClass = '';
        if (daysArray[i] === todayName) {
          dayClass = 'today';
        }
        html += '<th class="' + dayClass + '">' + daysArray[i] + '</th>';
      }
      html += '</tr></thead>';

      html += '<tbody>';

      var isWhiteRow = true;

      function isAfterNoon(timeStr) {
        var parts = (timeStr || '').split(':');
        var h = parseInt(parts[0], 10) || 0;
        return h >= 12;
      }

      for (var t = 0; t < timesArray.length; t++) {
        var time = timesArray[t];

        /* Ligne de séparation entre matinée et après-midi (avant la première heure >= 12:00) */
        if (t > 0 && isAfterNoon(time) && !isAfterNoon(timesArray[t - 1])) {
          html += '<tr class="noon-separator">';
          html += '<td class="noon-separator-line" colspan="' + (daysArray.length + 1) + '"></td>';
          html += '</tr>';
        }

        // Détermine la classe pour la couleur de la ligne (blanche ou grise)
        var rowClass = isWhiteRow ? 'course-row-white' : 'course-row-grey';
        var timeCellClass = isWhiteRow ? 'time-cell-white' : 'time-cell-grey';

        isWhiteRow = !isWhiteRow;

        html += '<tr class="' + rowClass + '">';

        html += '<td class="time-cell ' + timeCellClass + '">' + time + '</td>';

        for (var d = 0; d < daysArray.length; d++) {
          var day = daysArray[d];
          var courses = scheduleByTimeAndDay[time][day];

          html += '<td class="course-cell">';
          if (courses && courses.length > 0) {
            for (var c = 0; c < courses.length; c++) {
              var course = courses[c];
              var courseDisplay = '';

              var logoUrl = course.logo || '';
              var courseNameDisplay = '';

              // Affichage selon la présence du logo et la constante SHOW_COURSE_IMAGES
              if (SHOW_COURSE_IMAGES && logoUrl) {
                courseNameDisplay = '<img class="logo-cours" src="' + logoUrl + '" alt="' + course.courseName + ' Logo">';
              } else {
                courseNameDisplay = '<div class="course-name-text">' + course.courseName + '</div>';
              }

              var coachImagesHtml = '';
              if (course.coachs.length === 1) {
                var coachImageUrl = course.coachs[0].imageUrl || 'https://mcusercontent.com/74abea872abd45d46efed5d41/images/a340beeb-f8a3-d937-7eb8-e17882fc82ec.png';
                coachImagesHtml = '<div class="single-coach">' +
                                  '<img src="' + coachImageUrl + '" alt="' + course.coachs[0].name + '">' +
                                  '<span>' + course.coachs[0].name + '</span></div>';
              } else if (course.coachs.length > 1) {
                coachImagesHtml = '<div class="multiple-coaches">';
                var coachImages = course.coachs.map(coach => coach.imageUrl).filter(Boolean);
                coachImages.forEach(function(coachImageUrl, index) {
                  coachImagesHtml += '<img src="' + coachImageUrl + '" alt="Coach Image" class="coach-image">';
                });
                coachImagesHtml += '</div>';
              }

              var courseClasses = 'course-block';
              if (course.type === '100% Femmes') {
                courseClasses += ' women-only';
              } else {
                courseClasses += ' mixte';
              }

              if (course.studio.toLowerCase().includes('piscine') || course.studio.toLowerCase().includes('aqua')) {
                courseClasses += ' piscine';
              }

              // Vérifier si le cours commence dans moins de 15 minutes
              var now = new Date();
              var courseDate = new Date();
              
              var startTimeParts = course.startTime ? course.startTime.split(':') : ['00', '00'];
              var startHour = parseInt(startTimeParts[0]) || 0;
              var startMinute = parseInt(startTimeParts[1]) || 0;
              
              var currentDay = now.getDay();
              var targetDay = weekDays.indexOf(day);
              
              var dayDiff = targetDay - currentDay;
              if (dayDiff < 0) {
                dayDiff += 7;
              }
              
              courseDate.setDate(now.getDate() + dayDiff);
              courseDate.setHours(startHour, startMinute, 0, 0);
              
              var timeDifference = Math.floor((courseDate - now) / 1000);
              
              var isStartingSoon = timeDifference >= 0 && timeDifference <= 900;
              var isInProgress = timeDifference < 0 && timeDifference > -course.duration * 60;
              
              if (isStartingSoon) {
                courseClasses += ' starting-soon';
              } else if (isInProgress) {
                courseClasses += ' current';
              }

              courseDisplay += '<div class="' + courseClasses + '" data-coaches="' + course.coachs.map(coach => coach.name).join(',') + '">';

              if (isStartingSoon) {
                courseDisplay += '<div class="countdown-pill starting-soon" data-time-diff="' + Math.floor(timeDifference) + '"></div>';
              }

              courseDisplay += '<div class="course-info">' + courseNameDisplay + '</div>';
              courseDisplay += coachImagesHtml;
              courseDisplay += '</div>';

              html += courseDisplay;
            }
          }
          html += '</td>';
        }

        html += '</tr>';
      }
      html += '</tbody>';
      html += '</table>';

      return html;
    }

    /** Si le nom de cours est sur 2+ lignes, ajoute .multiline pour réduire la taille et tenir sur une ligne */
    function markMultilineCourseNames() {
      requestAnimationFrame(function() {
        var els = document.querySelectorAll('.course-info .course-name-text');
        var lineHeightPx = 18;
        els.forEach(function(el) {
          if (el.scrollHeight > lineHeightPx + 4) {
            el.classList.add('multiline');
          } else {
            el.classList.remove('multiline');
          }
        });
      });
    }

    // Optimisation de la fonction scrollToCurrentTime
    function scrollToCurrentTime() {
      // Attendre que le DOM soit complètement chargé
      setTimeout(() => {
        requestAnimationFrame(() => {
          const contentWrapper = document.querySelector('.content-wrapper');
          if (!contentWrapper) return;

          // Recherche d'abord un cours en cours
          let targetRow = document.querySelector('.course-block.current')?.closest('tr');
          
          // Si aucun cours en cours, cherche un cours qui va bientôt commencer
          if (!targetRow) {
            targetRow = document.querySelector('.course-block.starting-soon')?.closest('tr');
          }
          
          // Si toujours rien, cherche la ligne de l'heure actuelle
          if (!targetRow) {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinutes = now.getMinutes();
            const times = document.querySelectorAll('.time-cell');
            
            for (let i = 0; i < times.length; i++) {
              const timeText = times[i].textContent.trim();
              const [hour, minute] = timeText.split(':').map(Number);
              
              if (hour > currentHour || (hour === currentHour && minute >= currentMinutes)) {
                targetRow = times[i].parentElement;
                break;
              }
            }
          }

          if (targetRow) {
            const headerWrapper = document.querySelector('.header-wrapper');
            const thead = document.querySelector('.weekly-schedule thead');
            
            const headerHeight = headerWrapper ? headerWrapper.offsetHeight : 0;
            const theadHeight = thead ? thead.offsetHeight : 0;
            
            // Calcul de la position avec un petit décalage pour une meilleure visibilité
            const targetPosition = targetRow.offsetTop - headerHeight - theadHeight - 10;
            
            // Forcer le défilement avec un délai supplémentaire
            setTimeout(() => {
              contentWrapper.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
              });
            }, 100);
          }
        });
      }, 500); // Délai initial pour s'assurer que le contenu est chargé
    }

    // Exécute la fonction de scroll à chaque 15 minutes (900 000 ms)
    setInterval(scrollToCurrentTime, 900000);

    // Rafraîchit la page toutes les heures (3600 000 millisecondes = 1 heure)
    setInterval(function() {
      location.reload();
    }, 3600000);  // 1 heure = 60 minutes * 60 secondes * 1000 millisecondes

    function hideLoadingOverlay() {
      const loadingOverlay = document.getElementById('loadingOverlay');
      
      // Ajouter la classe fade-out à l'overlay
      loadingOverlay.classList.add('fade-out');

      // Attendre que l'animation de fade-out soit terminée
      setTimeout(() => {
        loadingOverlay.style.display = 'none';
        document.body.classList.remove('loading');

        // Rétablir l'affichage des conteneurs
        document.querySelectorAll('.container').forEach(el => el.style.display = 'flex');
        document.querySelectorAll('.month-block').forEach(el => el.style.display = 'block');
        document.querySelectorAll('.podium-wrapper').forEach(el => el.style.display = 'flex');
        document.querySelector('.competition-container').style.display = 'block';
      }, 500);
    }

    // Ajout de la classe loading au body au chargement seulement si activé
    document.addEventListener('DOMContentLoaded', function() {
      if (SHOW_LOADING_OVERLAY) {
        document.body.classList.add('loading');
        
        // Suppression de la classe loading une fois l'overlay prêt
        const loadingOverlay = document.getElementById('loadingOverlay');
        if (loadingOverlay) {
          loadingOverlay.addEventListener('transitionend', function() {
            if (loadingOverlay.classList.contains('fade-out')) {
              document.body.classList.remove('loading');
            }
          });
        }
      }
    });

    // Initialisation du planning
    function initSchedule() {
      var scheduleContainer = document.getElementById('schedule-container');
      if (scheduleContainer) {
        scheduleContainer.innerHTML = generateWeeklyScheduleHtml(scheduleData);
        markMultilineCourseNames();
      }
    }

    // Rafraîchissement automatique toutes les 5 minutes
    setInterval(function() {
      initSchedule();
    }, 5 * 60 * 1000);

    function returnToToday() {
      window.location.href = './daily.html';
    }

    function goToWeeklyVertical() {
      window.location.href = './weekly_vertical.html';
    }

    // Animation de clic fiable au toucher sur le bouton rotation (mobile)
    (function initRotationButtonTapAnimation() {
      var el = document.getElementById('rotationViewButton');
      if (!el) return;
      function removeTapActive() {
        var target = el;
        setTimeout(function() { target.classList.remove('tap-active'); }, 320);
      }
      el.addEventListener('pointerdown', function() { el.classList.add('tap-active'); });
      el.addEventListener('pointerup', removeTapActive);
      el.addEventListener('pointerleave', removeTapActive);
      el.addEventListener('pointercancel', removeTapActive);
    })();

    // Fonction pour ouvrir/fermer la barre de filtres
    function toggleFiltersSidebar(event) {
      if (event) {
        event.stopPropagation();
        event.preventDefault();
      }
      const sidebar = document.getElementById('filtersSidebar');
      
      if (!sidebar) {
        console.error('Sidebar not found');
        return;
      }
      
      // Toggle la classe open pour ouvrir/fermer la barre
      sidebar.classList.toggle('open');
    }

    // Fermer la barre de filtres quand on clique ailleurs (mais pas sur le bouton ni la barre)
    document.addEventListener('click', function(event) {
      const sidebar = document.getElementById('filtersSidebar');
      const filterButton = document.querySelector('.filter-button');
      
      if (sidebar && sidebar.classList.contains('open')) {
        // Si le clic n'est pas sur la barre de filtres ni sur le bouton
        if (!sidebar.contains(event.target) && !filterButton.contains(event.target)) {
          sidebar.classList.remove('open');
        }
      }
    });

    // Fonction pour vérifier l'état des cours et mettre à jour les animations
    function checkCourseStates() {
      const now = new Date();
      const weekDays = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
      const currentDay = now.getDay();
      const currentDayName = weekDays[currentDay];
      const currentHour = now.getHours();
      const currentMinutes = now.getMinutes();
      const currentTimeInMinutes = currentHour * 60 + currentMinutes;

      const courseBlocks = document.querySelectorAll('.course-block');
      
      courseBlocks.forEach(block => {
        try {
          // Vérifier si le block existe
          if (!block) return;

          // Récupérer les informations du cours avec vérification de nullité
          const dayCell = block.closest('tr')?.querySelector('th');
          if (!dayCell) return;

          const dayName = dayCell.textContent?.trim();
          if (!dayName) return;
          
          // Ne vérifier que les cours du jour actuel
          if (dayName === currentDayName) {
            const timeCell = block.closest('tr')?.querySelector('.time-cell');
            if (!timeCell) return;

            const startTime = timeCell.textContent?.trim();
            if (!startTime) return;

            const [startHour, startMinute] = startTime.split(':').map(Number);
            const startTimeInMinutes = startHour * 60 + startMinute;
            
            // Calculer la différence de temps
            const timeDifference = startTimeInMinutes - currentTimeInMinutes;
            
            // Vérifier si le cours est en cours ou sur le point de démarrer
            const isStartingSoon = timeDifference >= 0 && timeDifference <= 15;
            const isInProgress = timeDifference < 0 && timeDifference > -60;
            
            // Mettre à jour les classes en conséquence
            if (isStartingSoon) {
              block.classList.add('starting-soon');
              block.classList.remove('current');
              // Ajouter ou mettre à jour la pilule de compte à rebours
              let countdownPill = block.querySelector('.countdown-pill');
              if (!countdownPill) {
                countdownPill = document.createElement('div');
                countdownPill.className = 'countdown-pill starting-soon';
                block.insertBefore(countdownPill, block.firstChild);
              }
              countdownPill.setAttribute('data-time-diff', timeDifference * 60);
            } else if (isInProgress) {
              block.classList.add('current');
              block.classList.remove('starting-soon');
              // Supprimer la pilule de compte à rebours si elle existe
              const countdownPill = block.querySelector('.countdown-pill');
              if (countdownPill) {
                countdownPill.remove();
              }
            } else {
              block.classList.remove('starting-soon', 'current');
              // Supprimer la pilule de compte à rebours si elle existe
              const countdownPill = block.querySelector('.countdown-pill');
              if (countdownPill) {
                countdownPill.remove();
              }
            }
          } else {
            // Pour les autres jours, supprimer toutes les animations
            block.classList.remove('starting-soon', 'current');
            const countdownPill = block.querySelector('.countdown-pill');
            if (countdownPill) {
              countdownPill.remove();
            }
          }
        } catch (error) {
          console.error('Erreur lors de la vérification de l\'état du cours:', error);
        }
      });
    }

    // Fonction pour initialiser l'ascenseur personnalisé
    function initCustomScrollbar() {
      const scrollbar = document.createElement('div');
      scrollbar.className = 'custom-scrollbar';
      
      const track = document.createElement('div');
      track.className = 'scrollbar-track';
      
      const thumb = document.createElement('div');
      thumb.className = 'scrollbar-thumb';
      
      const touchArea = document.createElement('div');
      touchArea.className = 'scrollbar-touch-area';
      
      scrollbar.appendChild(track);
      scrollbar.appendChild(thumb);
      scrollbar.appendChild(touchArea);
      document.body.appendChild(scrollbar);

      let isDragging = false;
      let startX;
      let startScrollTop;
      let lastTouchY;
      let velocity = 0;
      let lastTime = 0;
      let animationFrame;
      let isScrolling = false;

      function updateScrollbar() {
        const contentWrapper = document.querySelector('.content-wrapper');
        const scrollHeight = contentWrapper.scrollHeight;
        const clientHeight = contentWrapper.clientHeight;
        const scrollTop = contentWrapper.scrollTop;
        
        if (scrollHeight > clientHeight) {
          const thumbHeight = (clientHeight / scrollHeight) * clientHeight;
          const thumbTop = (scrollTop / scrollHeight) * clientHeight;
          
          thumb.style.height = `${thumbHeight}px`;
          thumb.style.top = `${thumbTop}px`;
        }
      }

      function handleScroll() {
        updateScrollbar();
      }

      function handleMouseDown(e) {
        isDragging = true;
        startX = e.clientX;
        startScrollTop = document.querySelector('.content-wrapper').scrollTop;
        lastTouchY = e.clientY;
        lastTime = performance.now();
        velocity = 0;
        isScrolling = false;
        
        if (animationFrame) {
          cancelAnimationFrame(animationFrame);
        }
        
        thumb.style.backgroundColor = 'var(--secondary-color)';
        thumb.style.boxShadow = '0 0 12px var(--secondary-color)';
        thumb.style.width = '6px';
        thumb.style.right = '-1px';
      }

      function handleMouseMove(e) {
        if (!isDragging) return;
        
        const contentWrapper = document.querySelector('.content-wrapper');
        const deltaX = e.clientX - startX;
        const currentTime = performance.now();
        const deltaTime = currentTime - lastTime;
        
        if (deltaTime > 0) {
          const currentTouchY = e.clientY;
          const deltaY = currentTouchY - lastTouchY;
          velocity = deltaY / deltaTime;
          lastTouchY = currentTouchY;
          lastTime = currentTime;
        }
        
        const scrollHeight = contentWrapper.scrollHeight;
        const clientHeight = contentWrapper.clientHeight;
        
        // Inversion du sens : mouvement vers la droite = défilement vers le haut
        const newScrollTop = startScrollTop + (deltaX * scrollHeight / clientHeight);
        contentWrapper.scrollTop = newScrollTop;
        isScrolling = true;
      }

      function handleMouseUp() {
        isDragging = false;
        thumb.style.backgroundColor = 'var(--primary-color)';
        thumb.style.boxShadow = '0 0 8px var(--primary-color)';
        thumb.style.width = '4px';
        thumb.style.right = '0';
        
        if (isScrolling && Math.abs(velocity) > 0.1) {
          const contentWrapper = document.querySelector('.content-wrapper');
          let currentScrollTop = contentWrapper.scrollTop;
          const scrollHeight = contentWrapper.scrollHeight;
          const clientHeight = contentWrapper.clientHeight;
          const maxScroll = scrollHeight - clientHeight;
          
          function animateScroll() {
            if (Math.abs(velocity) < 0.1) {
              cancelAnimationFrame(animationFrame);
              return;
            }
            
            velocity *= 0.95; // Réduction progressive de la vitesse
            currentScrollTop += velocity * 1000;
            
            // Limiter le défilement aux limites
            if (currentScrollTop < 0) {
              currentScrollTop = 0;
              velocity = 0;
            } else if (currentScrollTop > maxScroll) {
              currentScrollTop = maxScroll;
              velocity = 0;
            }
            
            contentWrapper.scrollTop = currentScrollTop;
            animationFrame = requestAnimationFrame(animateScroll);
          }
          
          animationFrame = requestAnimationFrame(animateScroll);
        }
      }

      // Ajout des événements touch pour mobile avec support du momentum
      touchArea.addEventListener('touchstart', (e) => {
        e.preventDefault();
        handleMouseDown(e.touches[0]);
      }, { passive: false });

      touchArea.addEventListener('touchmove', (e) => {
        e.preventDefault();
        handleMouseMove(e.touches[0]);
      }, { passive: false });

      touchArea.addEventListener('touchend', handleMouseUp, { passive: true });

      // Événements pour la souris
      touchArea.addEventListener('mousedown', handleMouseDown);
      document.addEventListener('mousemove', handleMouseMove);
      document.addEventListener('mouseup', handleMouseUp);
      document.querySelector('.content-wrapper').addEventListener('scroll', handleScroll);

      // Mise à jour initiale
      updateScrollbar();
    }

    // Ajouter l'initialisation de l'ascenseur après le chargement du DOM
    document.addEventListener('DOMContentLoaded', function() {
      initCustomScrollbar();
    });

  </script>

</body>
</html>
