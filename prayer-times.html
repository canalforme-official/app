<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Horaires de Pri√®re - Ramadan</title>
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://mcusercontent.com/74abea872abd45d46efed5d41/images/20d3fcd8-43fc-852e-95b2-55ad6e8befe6.png">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Oswald:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Meta viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

  <style>
    /* Variables de style */
    :root {
      --font-title: 'Oswald', sans-serif;
      --font-text: 'Lora', serif;
      --primary-color: #26462d;
      --secondary-color: #c9a227;
      --background-main: #F5F5F5;
      --background-card: #FFFFFF;
      --text-primary: #333333;
      --text-secondary: #666666;
      --text-light: #FFFFFF;
      --shadow-light: rgba(200, 200, 200, 0.3);
      --shadow-medium: rgba(150, 150, 150, 0.5);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-text);
      background-color: var(--background-main);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
      position: relative;
    }
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/46685c10-b83c-7d4f-0cbd-4ead782d61a4.png');
      background-repeat: repeat;
      background-size: 40px 40px;
      opacity: 0.04;
      filter: sepia(1) hue-rotate(335deg) saturate(2.5);
    }

    .content-wrapper {
      position: relative;
      z-index: 1;
      max-width: 900px;
      margin: 0 auto;
    }
    @media (max-width: 768px) {
      .content-wrapper {
        max-width: 100%;
      }
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      padding: 12px 16px;
      background: var(--background-card);
      border-radius: 15px;
      box-shadow: 0 4px 6px var(--shadow-light);
    }

    .header h1 {
      font-family: var(--font-title);
      font-size: 2em;
      color: var(--primary-color);
      margin-bottom: 6px;
      text-transform: uppercase;
    }

    .header .subtitle {
      font-size: 0.95em;
      color: var(--text-secondary);
      font-style: italic;
      margin-bottom: 6px;
    }

    .source-reference {
      font-size: 0.75em;
      color: var(--text-secondary);
      margin-top: 8px;
      font-style: italic;
    }

    .source-reference a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
    }

    .source-reference a:hover {
      text-decoration: underline;
    }

    .back-button {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--primary-color);
      color: var(--text-light);
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-family: var(--font-title);
      font-size: 1em;
      cursor: pointer;
      z-index: 1000;
      transition: background 0.3s ease;
      text-decoration: none;
      display: inline-block;
      opacity: 0.9;
    }

    .back-button:hover {
      background: #1e3523;
    }

    .today-info {
      background: linear-gradient(135deg, var(--primary-color) 0%, #1e3523 100%);
      color: var(--text-light);
      padding: 14px 16px;
      border-radius: 15px;
      margin-bottom: 20px;
      text-align: center;
      box-shadow: 0 4px 6px var(--shadow-medium);
    }

    .today-info h2 {
      font-family: var(--font-title);
      font-size: 1.5em;
      margin-bottom: 8px;
    }

    .today-maghrib {
      font-size: 2em;
      font-weight: 600;
      margin-top: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .prayer-table {
      background: var(--background-card);
      border-radius: 15px;
      overflow: visible;
      box-shadow: 0 4px 6px var(--shadow-light);
      margin-bottom: 30px;
      display: flex;
      flex-direction: column;
    }

    .table-header {
      position: sticky;
      top: 0;
      z-index: 5;
      background: var(--primary-color);
      color: var(--text-light);
      padding: 12px 15px;
      font-family: var(--font-title);
      font-size: 1.2em;
      text-align: center;
      text-transform: uppercase;
      line-height: 1.4;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .table-content {
      overflow-x: auto;
      overflow-y: auto;
      flex: 1;
      position: relative;
      max-height: calc(100vh - 250px);
    }
    @media (max-width: 768px) {
      .table-content {
        overflow-x: visible;
      }
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    @media (max-width: 768px) {
      table {
        width: 100%;
        table-layout: fixed;
      }
    }

    thead {
      position: sticky;
      top: 0;
      z-index: 4;
      display: table-header-group;
    }
    
    /* S'assurer que le thead a un background opaque pour chaque th */
    thead th {
      background: #e8e8e8;
    }
    thead th:nth-child(1), thead th:nth-child(3), thead th:nth-child(5), thead th:nth-child(7) {
      background: #fafafa;
    }
    thead th:nth-child(2), thead th:nth-child(4), thead th:nth-child(6), thead th:nth-child(8) {
      background: #fff;
    }
    
    tbody {
      display: table-row-group;
    }

    th {
      font-family: var(--font-title);
      padding: 10px 8px;
      text-align: center;
      font-weight: 600;
      color: var(--primary-color);
      text-transform: uppercase;
      font-size: 0.85em;
      border-bottom: 2px solid var(--primary-color);
      letter-spacing: -0.3px;
    }
    /* Alternance gris clair / blanc pour toutes les colonnes */
    th:nth-child(1), th:nth-child(3), th:nth-child(5), th:nth-child(7), td:nth-child(1), td:nth-child(3), td:nth-child(5), td:nth-child(7) { background: #fafafa; }
    th:nth-child(2), th:nth-child(4), th:nth-child(6), th:nth-child(8), td:nth-child(2), td:nth-child(4), td:nth-child(6), td:nth-child(8) { background: #fff; }
    /* Colonnes 1 et 2 fig√©es au d√©filement horizontal */
    th:nth-child(1), td:nth-child(1) { position: sticky; left: 0; z-index: 2; box-shadow: 2px 0 4px rgba(0,0,0,0.06); white-space: nowrap; }
    th:nth-child(2), td:nth-child(2) { position: sticky; left: 0; z-index: 2; box-shadow: 2px 0 4px rgba(0,0,0,0.06); }
    thead th:nth-child(1) { z-index: 7; width: 55px; min-width: 55px; }
    thead th:nth-child(2) { z-index: 7; left: 55px; width: 70px; min-width: 70px; }
    tbody td:nth-child(1) { width: 55px; min-width: 55px; }
    tbody td:nth-child(2) { width: 70px; min-width: 70px; left: 55px; }
    /* Ligne aujourd'hui avec fond jaune - z-index plus √©lev√© pour passer au-dessus des colonnes fig√©es */
    tbody tr.today td:nth-child(1), tbody tr.today td:nth-child(3), tbody tr.today td:nth-child(5), tbody tr.today td:nth-child(7) { background: rgba(201, 162, 39, 0.2); }
    tbody tr.today td:nth-child(2), tbody tr.today td:nth-child(4), tbody tr.today td:nth-child(6), tbody tr.today td:nth-child(8) { background: rgba(201, 162, 39, 0.18); }
    tbody tr.today td:nth-child(1), tbody tr.today td:nth-child(2) { z-index: 3; }

    td {
      padding: 8px 6px;
      text-align: center;
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      font-size: 0.9em;
      font-family: var(--font-text);
      letter-spacing: -0.5px;
    }

    tbody tr:hover td:nth-child(n+3) {
      background: rgba(38, 70, 45, 0.06) !important;
    }

    tbody tr.today {
      font-weight: 600;
    }

    .day-number {
      font-weight: 600;
      color: var(--primary-color);
    }
    /* Chiffres en gras pour colonnes jour, date et maghrib uniquement */
    td:nth-child(1) .day-number {
      font-weight: 600;
    }
    /* Colonne date : le chiffre est d√©j√† en gras via <strong> dans le HTML */
    td:nth-child(2) {
      font-weight: 400;
    }
    td:nth-child(2) strong {
      font-weight: 600;
    }
    td:nth-child(7).prayer-time.maghrib {
      font-weight: 600;
    }
    /* Les autres colonnes ne sont pas en gras */
    td:nth-child(3).prayer-time,
    td:nth-child(4).prayer-time,
    td:nth-child(5).prayer-time,
    td:nth-child(6).prayer-time,
    td:nth-child(8).prayer-time {
      font-weight: 400;
    }
    /* Le jour de la semaine n'est pas en gras */
    td:nth-child(1) .day-name {
      font-weight: 400;
    }
    /* Premi√®re colonne : jour ramadan et jour de la semaine sur une ligne */
    td:nth-child(1) {
      white-space: nowrap;
    }
    td:nth-child(1) br {
      display: none;
    }
    td:nth-child(1) .day-name {
      margin-left: 4px;
    }

    .observation-badge {
      font-size: 0.75em;
      font-weight: 500;
      color: var(--secondary-color);
      font-style: italic;
      display: inline-block;
      padding: 2px 6px;
      background: rgba(201, 162, 39, 0.1);
      border-radius: 4px;
    }

    .day-name {
      font-weight: 500;
      color: var(--text-primary);
    }
    .day-name-short {
      display: none;
    }

    .prayer-time {
      font-family: 'Courier New', monospace;
      font-weight: 400;
      color: var(--text-primary);
    }

    .prayer-time.maghrib {
      color: var(--secondary-color);
      font-size: 1em;
      font-weight: 600;
    }

    /* Bouton retour √† aujourd'hui (comme daily.html) */
    .today-view-button {
      position: fixed;
      bottom: 24px;
      right: 20px;
      z-index: 1000;
      width: 55px;
      height: 55px;
      background: none;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      pointer-events: all;
      display: block;
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .today-view-button.visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }
    .today-view-button::before {
      content: '';
      position: absolute;
      width: 55px;
      height: 55px;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/d983712e-5b70-9ebc-9696-6a677290a963.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      animation: rotate-icon-prayer 6s cubic-bezier(0.4, 0, 0.2, 1) infinite;
      transform-origin: center;
      pointer-events: none;
      filter: brightness(0) saturate(0%) invert(27%) sepia(8%) saturate(2000%) hue-rotate(95deg) brightness(90%) contrast(85%);
    }
    .today-view-button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      background-color: var(--background-main);
      border-radius: 50%;
      box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      pointer-events: none;
      z-index: 2;
    }
    .today-view-button a {
      z-index: 3;
      width: 100%;
      height: 100%;
      display: block;
      position: relative;
    }
    .today-view-button button {
      z-index: 3;
      width: 100%;
      height: 100%;
      background: none;
      border: none;
      cursor: pointer;
      display: block;
      position: relative;
    }
    @keyframes rotate-icon-prayer {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(180deg); }
      100% { transform: rotate(360deg); }
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 1.2em;
      color: var(--text-secondary);
    }

    .error {
      text-align: center;
      padding: 40px;
      background: #ffebee;
      color: #c62828;
      border-radius: 15px;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 2em;
      }

      .today-maghrib {
        font-size: 2em;
      }

      th, td {
        padding: 8px 3px;
        font-size: 0.75em;
      }
      th {
        padding: 8px 2px;
        letter-spacing: -0.5px;
      }

      .back-button {
        position: fixed;
        top: 10px;
        left: 10px;
        padding: 10px 16px;
        font-size: 0.9em;
        z-index: 1000;
        opacity: 0.85;
      }

      /* Colonnes 1 et 2 avec largeur minimale en mobile */
      thead th:nth-child(1), tbody td:nth-child(1) { 
        width: 45px; 
        min-width: 45px; 
      }
      thead th:nth-child(2), tbody td:nth-child(2) { 
        width: 55px; 
        min-width: 55px; 
        left: 45px;
      }

      /* R√©duire la largeur des autres colonnes pour voir toutes les colonnes */
      th, td {
        white-space: nowrap;
        letter-spacing: -0.6px;
      }
      thead th:nth-child(3), tbody td:nth-child(3),
      thead th:nth-child(4), tbody td:nth-child(4),
      thead th:nth-child(5), tbody td:nth-child(5),
      thead th:nth-child(6), tbody td:nth-child(6),
      thead th:nth-child(7), tbody td:nth-child(7),
      thead th:nth-child(8), tbody td:nth-child(8) {
        width: calc((100% - 100px) / 6);
        min-width: 48px;
        padding: 8px 2px;
      }
      
      /* R√©duire la taille du texte maghrib en mobile */
      td:nth-child(7).prayer-time.maghrib {
        font-size: 0.95em;
      }
    }

    /* Vue mobile : pas de retour √† la ligne, date courte (3 lettres) */
    .date-cell .date-short {
      display: none;
    }
    @media (max-width: 768px) {
      .date-cell {
        white-space: nowrap;
      }
      .date-cell .date-full {
        display: none;
      }
      .date-cell .date-short {
        display: inline;
      }
    }

    @media (max-width: 480px) {
      th, td {
        padding: 8px 2px;
        font-size: 0.7em;
      }

      .day-name-full {
        display: none;
      }
      .day-name-short {
        display: inline;
      }

      /* Colonnes encore plus compactes pour tr√®s petits √©crans */
      thead th:nth-child(1), tbody td:nth-child(1) { 
        width: 40px; 
        min-width: 40px; 
      }
      thead th:nth-child(2), tbody td:nth-child(2) { 
        width: 50px; 
        min-width: 50px; 
        left: 40px;
      }
      thead th:nth-child(3), tbody td:nth-child(3),
      thead th:nth-child(4), tbody td:nth-child(4),
      thead th:nth-child(5), tbody td:nth-child(5),
      thead th:nth-child(6), tbody td:nth-child(6),
      thead th:nth-child(7), tbody td:nth-child(7),
      thead th:nth-child(8), tbody td:nth-child(8) {
        width: calc((100% - 90px) / 6);
        min-width: 42px;
        padding: 8px 1px;
        letter-spacing: -0.7px;
      }
      
      /* R√©duire encore plus la taille du texte maghrib sur tr√®s petits √©crans */
      td:nth-child(7).prayer-time.maghrib {
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <a href="./daily.html" class="back-button">‚Üê Retour</a>

  <!-- Bouton pour revenir √† aujourd'hui (daily.html) -->
  <div class="today-view-button" id="todayViewButton">
    <a href="./daily.html" title="Revenir √† aujourd'hui">
      <button type="button"></button>
    </a>
  </div>

  <div class="content-wrapper">
    <div class="header">
      <h1>Horaires de Pri√®re</h1>
      <div class="subtitle" id="ramadanYear">Ramadan</div>
      <div class="source-reference">
        Source : <a href="https://www.habous.gov.ma/fr/horaires-de-pri%C3%A8re.html" target="_blank" rel="noopener noreferrer">Minist√®re des Habous et des Affaires Islamiques</a> - Marrakech
      </div>
    </div>

    <div class="today-info" id="todayInfo" style="display: none;">
      <h2>Aujourd'hui</h2>
      <div class="today-maghrib" id="todayMaghrib"></div>
    </div>

    <div class="prayer-table">
      <div class="table-header" id="tableHeader">Calendrier Complet</div>
      <div class="table-content">
        <div class="loading" id="loading">Chargement des horaires...</div>
        <div class="error" id="error" style="display: none;"></div>
        <table id="prayerTable" style="display: none;">
          <thead>
            <tr>
              <th>Jour</th>
              <th>Date</th>
              <th>Fajr</th>
              <th>Chourouq</th>
              <th>Dhuhr</th>
              <th>Asr</th>
              <th>Maghrib</th>
              <th>Isha</th>
            </tr>
          </thead>
          <tbody id="prayerTableBody">
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const daysOfWeek = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
    const daysOfWeekShort = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
    const months = ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'];
    const monthsShort = ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Ao√ª', 'Sep', 'Oct', 'Nov', 'D√©c'];

    async function loadPrayerTimes() {
      const loadingEl = document.getElementById('loading');
      const errorEl = document.getElementById('error');
      const tableEl = document.getElementById('prayerTable');
      const tableBody = document.getElementById('prayerTableBody');
      const todayInfoEl = document.getElementById('todayInfo');
      const todayMaghribEl = document.getElementById('todayMaghrib');
      const ramadanYearEl = document.getElementById('ramadanYear');

      try {
        // Essayer d'abord le fichier local, puis GitHub en fallback
        let response = null;
        let data = null;
        
        try {
          // Tentative 1 : Fichier local (fonctionne si servi par un serveur local)
          response = await fetch('./prayer-times.json');
          if (response.ok) {
            data = await response.json();
            console.log('‚úÖ Donn√©es charg√©es depuis le fichier local');
          } else {
            throw new Error('Fichier local non disponible');
          }
        } catch (localError) {
          console.log('‚ö†Ô∏è Fichier local non disponible, utilisation de GitHub...');
          // Tentative 2 : GitHub (fallback)
          response = await fetch('https://raw.githubusercontent.com/canalforme-official/app-data/main/prayer-times.json');
          if (!response.ok) {
            throw new Error('Impossible de charger les horaires de pri√®re depuis GitHub');
          }
          data = await response.json();
          console.log('‚úÖ Donn√©es charg√©es depuis GitHub');
        }
        
        if (!data.prayerTimes || Object.keys(data.prayerTimes).length === 0) {
          throw new Error('Aucune donn√©e d\'horaires disponible');
        }

        // Nom de la p√©riode tel quel depuis Sheets (ex. Ramadan 2026, Ramadan 1447-2026)
        if (data.metadata) {
          ramadanYearEl.textContent = data.metadata.periodName || data.metadata.period || (data.metadata.year ? `Ramadan ${data.metadata.year}` : 'Ramadan');
        }

        // Obtenir la date d'aujourd'hui
        const today = new Date().toISOString().slice(0, 10);
        const todayPrayer = data.prayerTimes[today];

        // Afficher l'info d'aujourd'hui si disponible
        if (todayPrayer && todayPrayer.maghrib) {
          todayInfoEl.style.display = 'block';
          todayMaghribEl.innerHTML = `Maghrib: üåô ${todayPrayer.maghrib}`;
        }

        // Trier les dates
        const sortedDates = Object.keys(data.prayerTimes).sort();

        // Remplir le tableau
        tableBody.innerHTML = '';
        sortedDates.forEach(dateStr => {
          const prayer = data.prayerTimes[dateStr];
          const date = new Date(dateStr + 'T12:00:00');
          const isToday = dateStr === today;

          const row = document.createElement('tr');
          if (isToday) {
            row.classList.add('today');
          }

          const dayOfWeek = daysOfWeek[date.getDay()];
          const dayOfWeekShort = daysOfWeekShort[date.getDay()];
          const dayNumber = date.getDate();
          const month = months[date.getMonth()];
          const monthShort = monthsShort[date.getMonth()];

          const dayDisplay = prayer.isObservation 
            ? `<span class="observation-badge">Selon l'observation</span>` 
            : `<span class="day-number">${prayer.day || ''}</span>`;
          
          row.innerHTML = `
            <td>
              ${dayDisplay}<span class="day-name day-name-full"> ${dayOfWeek}</span><span class="day-name day-name-short"> ${dayOfWeekShort}</span>
            </td>
            <td class="date-cell" data-day-number="${dayNumber}"><span class="date-full"><strong>${dayNumber}</strong> ${month}</span><span class="date-short"><strong>${dayNumber}</strong> ${monthShort}</span></td>
            <td class="prayer-time">${prayer.fajr || '-'}</td>
            <td class="prayer-time">${prayer.chourouq || '-'}</td>
            <td class="prayer-time">${prayer.dhuhr || '-'}</td>
            <td class="prayer-time">${prayer.asr || '-'}</td>
            <td class="prayer-time maghrib">${prayer.maghrib || '-'}</td>
            <td class="prayer-time">${prayer.isha || '-'}</td>
          `;

          tableBody.appendChild(row);
        });

        loadingEl.style.display = 'none';
        tableEl.style.display = 'table';

        // S'assurer que le thead sticky fonctionne correctement
        // Le probl√®me √©tait que border-collapse: collapse emp√™chait le sticky de fonctionner
        // On utilise maintenant border-collapse: separate avec border-spacing: 0
        // Le thead devrait maintenant prendre sa place dans le flux et √™tre sticky correctement
        requestAnimationFrame(() => {
          const thead = tableEl.querySelector('thead');
          const tbody = tableEl.querySelector('tbody');
          if (thead && tbody) {
            // S'assurer que le thead garde sa position dans le flux
            thead.style.position = 'sticky';
            thead.style.top = '0';
            thead.style.zIndex = '4';
            // Forcer un reflow
            void thead.offsetHeight;
            void tbody.offsetHeight;
          }
        });

        // D√©filement automatique vers la ligne du jour apr√®s 5 secondes
        setTimeout(function() {
          const todayRow = tableEl.querySelector('tbody tr.today');
          if (todayRow) {
            todayRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }, 5000);

        // Le bouton est toujours visible maintenant, pas besoin d'observer

      } catch (error) {
        console.error('Erreur:', error);
        loadingEl.style.display = 'none';
        errorEl.style.display = 'block';
        errorEl.textContent = 'Erreur lors du chargement des horaires de pri√®re. Veuillez r√©essayer plus tard.';
      }
    }


    // Charger les donn√©es au chargement de la page
    loadPrayerTimes();
  </script>
</body>
</html>
