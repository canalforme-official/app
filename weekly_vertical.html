<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Planning Hebdomadaire Vertical</title>

  <!-- Favicon -->
  <link rel="icon" href="https://mcusercontent.com/74abea872abd45d46efed5d41/images/20d3fcd8-43fc-852e-95b2-55ad6e8befe6.png" type="image/png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  

  <style>
    /* Styles généraux */
    :root {
      /* Couleurs principales */
      --primary-color: #480607;
      --secondary-color: #FFA630;
      
      /* Dégradé piscine/aqua (bleu uniquement) */
      --pool-blue: #35767c;
      --pool-middle: #42464d;
      --gradient-pool: radial-gradient(circle, var(--pool-blue) 0%, var(--pool-middle) 100%);
      
      /* Dégradé femmes uniquement (violet uniquement) */
      --women-light: #ddace7;
      --women-middle: #9e6187;
      --gradient-women: radial-gradient(circle, var(--women-light) 0%, var(--women-middle) 100%);
      
      /* Couleurs spécifiques */
      --women-color: #E4A672;
      --pool-color: #78D1B6;
      
      /* Couleurs de fond */
      --background-main: #F5F5F5;
      --background-card: #FFFFFF;
      
      /* Couleurs de texte */
      --text-primary: #333333;
      --text-secondary: #666666;
      --text-tertiary: #555555;
      --text-light: #FFFFFF;
      
      /* Transparences primary */
      --primary-overlay: rgba(72, 6, 7, 0.95);
      --primary-light: rgba(72, 6, 7, 0.8);
      --primary-lighter: rgba(72, 6, 7, 0.5);
      
      /* Transparences secondary */
      --secondary-light: rgba(255, 166, 48, 0.75);
      --secondary-lighter: rgba(255, 166, 48, 0.7);
      
      /* Transparences spécifiques */
      --women-color-light: rgba(228, 166, 114, 0.3);
      --pool-color-light: rgba(120, 209, 182, 0.3);
      
      /* Ombres */
      --shadow-light: rgba(200, 200, 200, 0.3);
      --shadow-medium: rgba(150, 150, 150, 0.5);
      --shadow-dark: rgba(0, 0, 0, 0.4);
      
      /* États */
      --state-past: #aaaaaa;
      --overlay-light: rgba(255, 255, 255, 0.3);
      --overlay-lighter: rgba(255, 255, 255, 0.2);
      /* Planning vertical : 4 jours et quelques visibles, scroll pour le reste */
      --schedule-hours-width: 38px;
      --schedule-hours-min-width: 38px;
      --schedule-day-width: calc((100vw - var(--schedule-hours-width)) / 4.4);
    }
    body.planning-ramadan { --primary-color: #1a472a; --primary-overlay: rgba(26, 71, 42, 0.95); --primary-light: rgba(26, 71, 42, 0.85); --secondary-color: #c9a227; position: relative; }
    body.planning-ramadan::before {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      min-height: 100vh;
      z-index: 0;
      pointer-events: none;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/46685c10-b83c-7d4f-0cbd-4ead782d61a4.png');
      background-repeat: repeat;
      background-size: 40px 40px;
      background-position: 0 0;
      opacity: 0.04;
      filter: sepia(1) hue-rotate(335deg) saturate(2.5);
    }
    body.planning-ramadan .content-wrapper { position: relative; z-index: 1; }
    #planningViewSwitcher { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; padding: 2px 0; margin: 0 0 2px 0; }
    #planningViewSwitcher button { padding: 8px 14px; border-radius: 8px; border: 1px solid var(--primary-color); background: var(--background-card); color: var(--primary-color); font-size: 0.9em; cursor: pointer; }
    #planningViewSwitcher button.active { background: var(--primary-color); color: var(--text-light); }

    body, button, a, img {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: fixed;
      width: 100%;
      font-family: Arial, sans-serif;
      background-color: var(--background-main);
      color: var(--primary-color);
    }

    body {
      display: flex;
      flex-direction: column;
    }

    .content-wrapper {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      height: 100vh;
      padding: 5px;
      box-sizing: border-box;
      -webkit-overflow-scrolling: touch;
      position: relative;
      scrollbar-width: none;
      -ms-overflow-style: none;
      /* Vertical uniquement ici : le horizontal est géré par les wrappers enfants */
      touch-action: pan-y;
    }

    /* Masquer la barre de défilement pour Chrome, Safari et Opera */
    .content-wrapper::-webkit-scrollbar {
      display: none;
    }

    /* Barre des jours sticky — en dehors du scroll horizontal pour que sticky fonctionne */
    .sticky-days-bar {
      position: sticky;
      top: 0;
      z-index: 10;
      background-color: var(--background-main);
      flex-shrink: 0;
    }

    .sticky-days-bar .weekly-schedule-header {
      width: calc(var(--schedule-hours-width) + 7 * var(--schedule-day-width));
      min-width: calc(var(--schedule-hours-width) + 7 * var(--schedule-day-width));
      border-collapse: collapse;
      table-layout: fixed;
      margin: 0;
    }

    .sticky-days-bar .weekly-schedule-header th {
      background-color: var(--primary-color);
      color: var(--text-light);
      text-align: center;
      font-size: 1.5em !important;
      font-weight: 600;
      border-bottom: 2px solid var(--shadow-light);
      padding: 6px 4px;
      margin: 0;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }

    /* Noms des jours : taille lisible sans être trop grande */
    .sticky-days-bar .weekly-schedule-header th:not(:first-child) {
      font-size: 1.5em !important;
    }

    /* Première cellule (heures) en haut à gauche : transparente, l’ombre gauche ne la recouvre pas */
    .sticky-days-bar .weekly-schedule-header th:first-child {
      background-color: transparent;
      border: none;
      box-shadow: none;
      font-size: 1em !important;
    }

    .sticky-days-bar .weekly-schedule-header th.today {
      background-color: #981010;
    }

    .sticky-days-bar .weekly-schedule-header th:nth-child(2) {
      border-top-left-radius: 3px;
      border-bottom-left-radius: 3px;
    }

    .sticky-days-bar .weekly-schedule-header th:last-child {
      border-top-right-radius: 3px;
      border-bottom-right-radius: 3px;
    }

    .sticky-days-bar .weekly-schedule-header th:first-child {
      min-width: 38px;
      width: var(--schedule-hours-width);
    }

    .sticky-days-bar .weekly-schedule-header col.col-hours {
      width: var(--schedule-hours-width);
      min-width: 38px;
    }

    .sticky-days-bar .weekly-schedule-header col.col-day {
      width: var(--schedule-day-width);
    }

    /* Barre des jours : contenu déplacé par transform (synchro fluide, pas de reflow) */
    .sticky-scroll-wrapper {
      overflow-x: hidden;
      overflow-y: hidden;
      width: 100%;
      touch-action: none;
      transform: translateZ(0);
      backface-visibility: hidden;
    }

    #stickyHeaderContent {
      display: inline-block;
      will-change: transform;
      transform: translateZ(0);
      contain: layout;
    }

    /* Wrapper scroll horizontal : inertie préservée (pas d'écriture scrollLeft depuis la barre sticky) */
    .schedule-scroll-wrapper {
      overflow-x: auto;
      overflow-y: visible;
      width: 100%;
      -webkit-overflow-scrolling: touch;
      position: relative;
      overscroll-behavior-x: contain;
    }

    .schedule-scroll-wrapper::-webkit-scrollbar {
      height: 6px;
    }

    .schedule-scroll-wrapper::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 3px;
    }

    /* Ombre à droite tant qu'il y a du contenu à défiler — pleine hauteur de la page */
    .scroll-shadow-right {
      position: fixed;
      right: 0;
      top: 0;
      bottom: 0;
      width: 40px;
      pointer-events: none;
      z-index: 50;
      background: linear-gradient(to left, rgba(0, 0, 0, 0.32), rgba(0, 0, 0, 0.12), transparent);
      transition: opacity 0.25s ease;
    }

    .scroll-shadow-right.at-end {
      opacity: 0;
    }

    /* Ombre à droite de la colonne sticky (heures) : left positionné en JS au bord droit de la colonne, même style que la droite mais inversée */
    .scroll-shadow-left {
      position: fixed;
      top: 0;
      bottom: 0;
      width: 40px;
      pointer-events: none;
      z-index: 50;
      background: linear-gradient(to right, rgba(0, 0, 0, 0.32), rgba(0, 0, 0, 0.12), transparent);
      transition: opacity 0.25s ease;
      opacity: 0;
    }

    .scroll-shadow-left.visible {
      opacity: 1;
    }

    /* Style pour la disposition du titre et des filtres */
    .header-wrapper {
      display: none;
    }

    .header-wrapper h1 {
      display: none;
    }

    /* Styles pour le conteneur des filtres */
    .filters {
      display: flex;
      align-items: center;
      gap: 5px;
      pointer-events: auto;
      flex-wrap: wrap;
    }

    .filters label {
      font-size: 0.7em;
      cursor: pointer;
      display: flex;
      align-items: center;
      color: var(--primary-color);
      pointer-events: auto;
    }

    .filters input[type="checkbox"] {
      margin-right: 3px;
      accent-color: var(--secondary-color);
      pointer-events: auto;
      width: 12px;
      height: 12px;
    }

    /* Style personnalisé pour les checkboxes */
    .filters input[type="checkbox"] {
      appearance: none;
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      border: 2px solid var(--secondary-color);
      border-radius: 3px;
      margin-right: 3px;
      position: relative;
      cursor: pointer;
    }

    .filters input[type="checkbox"]:checked {
      background-color: var(--secondary-color);
    }

    .filters input[type="checkbox"]:checked::after {
      content: '✓';
      position: absolute;
      color: var(--primary-color);
      font-size: 8px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    /* Style pour le select des coachs */
    .filters select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-color: var(--background-card);
      border: 2px solid var(--secondary-color);
      border-radius: 3px;
      padding: 3px 20px 3px 8px;
      font-size: 0.7em;
      color: var(--primary-color);
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23480607' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 6px center;
      background-size: 10px;
      margin-left: 3px;
      min-width: 100px;
    }

    .filters select:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .filters select option {
      background-color: var(--background-card);
      color: var(--primary-color);
      padding: 3px;
    }

    .filters select option:checked {
      background-color: var(--secondary-color);
      color: var(--primary-color);
    }

    .filters select option:hover {
      background-color: var(--secondary-light);
    }

    /* Styles pour le tableau du planning hebdomadaire — 4 jours et quelques visibles */
    .weekly-schedule {
      width: calc(var(--schedule-hours-width) + 7 * var(--schedule-day-width));
      min-width: calc(var(--schedule-hours-width) + 7 * var(--schedule-day-width));
      border-collapse: collapse;
      margin: 0;
      table-layout: fixed;
      font-size: 0.72em;
    }

    /* Aucun background sur les colonnes : alternance uniquement par tranche horaire (ligne) */
    .weekly-schedule col.col-hours,
    .weekly-schedule col.col-day {
      background: transparent !important;
    }

    .weekly-schedule col.col-hours {
      width: var(--schedule-hours-width);
      min-width: 38px;
    }

    .weekly-schedule col.col-day {
      width: var(--schedule-day-width);
    }

    .weekly-schedule th, .weekly-schedule td {
      padding: 1px;
      vertical-align: top;
      border: none;
    }

    /* Ligne des titres (barre des jours) — sticky comme weekly.html */
    .weekly-schedule thead th {
      background-color: var(--primary-color);
      color: var(--text-light);
      text-align: center;
      font-size: 1.35em;
      font-weight: 600;
      border-bottom: 2px solid var(--shadow-light);
      position: sticky;
      top: 0;
      z-index: 10;
      pointer-events: none;
      border-radius: 0;
      margin: 0;
      padding: 6px 5px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }

    /* Première cellule du thead (horaires) — sticky en haut à gauche */
    .weekly-schedule thead th:first-child {
      background-color: var(--background-main);
      border: none;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      position: sticky;
      left: 0;
      top: 0;
      z-index: 20;
    }

    /* Arrondir uniquement les extrémités de la barre de titres */
    .weekly-schedule thead th:nth-child(2) {
      border-top-left-radius: 3px;
      border-bottom-left-radius: 3px;
    }

    .weekly-schedule thead th:last-child {
      border-top-right-radius: 3px;
      border-bottom-right-radius: 3px;
    }

    /* Animation améliorée pour le jour actuel */
    .weekly-schedule thead th.today {
      background-color: #981010;
      position: sticky;
      top: 0;
      z-index: 10;
      color: var(--text-light);
      overflow: hidden;
      pointer-events: none;
      margin: 0;
    }

    /* Préserver les bordures courbées même quand le jour est surligné */
    .weekly-schedule thead th.today:nth-child(2) {
      border-top-left-radius: 3px;
      border-bottom-left-radius: 3px;
    }

    .weekly-schedule thead th.today:last-child {
      border-top-right-radius: 3px;
      border-bottom-right-radius: 3px;
    }

    /* Colonne des heures — largeur et padding réduits, taille des heures légèrement augmentée */
    .weekly-schedule th:first-child,
    .weekly-schedule td.time-cell {
      width: var(--schedule-hours-width);
      min-width: 38px;
      max-width: none;
      text-align: center;
      padding: 5px 1px;
      font-weight: bold;
      color: var(--primary-color);
      font-size: 1.28em;
      line-height: 1.15;
    }

    .weekly-schedule td.time-cell {
      position: sticky;
      left: 0;
      z-index: 2;
    }

    /* Alternance blanc / gris par tranche horaire uniquement (pas par colonne de jour) */
    .weekly-schedule td.time-cell-white {
      background-color: var(--background-card);
      color: var(--primary-color);
      text-align: center;
    }

    .weekly-schedule td.time-cell-grey {
      background-color: var(--background-main);
      color: var(--primary-color);
      text-align: center;
    }

    /* Cellules des cours — largeur fixe par jour, espace entre colonnes (+2px entre les jours) */
    .course-cell {
      width: var(--schedule-day-width);
      min-width: var(--schedule-day-width);
      text-align: center;
      border-bottom: 1px solid var(--shadow-light);
      position: relative;
      padding: 2px 9px;
    }

    /* Même alternance par tranche horaire pour les cellules cours (pas de fond par colonne jour) */
    .course-row-white .course-cell {
      background-color: var(--background-card);
      color: var(--text-primary);
    }

    .course-row-grey .course-cell {
      background-color: var(--background-main);
      color: var(--text-primary);
    }

    /* Ajustement des blocs de cours — padding interne (nom pas collé au bord), ombre marquée */
    .course-block {
      background-color: var(--background-card);
      border: none;
      border-radius: 10px;
      padding: 10px 12px 10px 14px;
      padding-right: 20px;
      margin: 0;
      font-size: 0.82em;
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09), 0 1px 3px rgba(0, 0, 0, 0.05);
      text-align: left;
    }

    /* Espace entre blocs de la même heure */
    .course-block + .course-block {
      margin-top: 8px;
    }

    /* Styles pour les cours mixtes */
    .course-block.mixte {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09), 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    /* Styles pour les cours femmes */
    .course-block.women-only {
      background-color: var(--women-color-light);
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09), 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .course-block.women-only::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--gradient-women);
      opacity: 0.4;
      border-radius: 10px;
      pointer-events: none;
      z-index: 0;
    }

    .course-block.women-only > * {
      position: relative;
      z-index: 1;
    }

    /* Styles pour les cours piscine */
    .course-block.piscine {
      background-color: var(--pool-color-light);
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.09), 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .course-block.piscine::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--gradient-pool);
      opacity: 0.4;
      border-radius: 10px;
      pointer-events: none;
      z-index: 0;
    }

    .course-block.piscine > * {
      position: relative;
      z-index: 1;
    }

    /* Styles pour les cours en cours */
    .course-block.current {
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12), 0 1px 4px rgba(0, 0, 0, 0.06);
      font-weight: bold;
    }

    /* Styles pour les cours qui vont bientôt démarrer */
    .course-block.starting-soon {
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12), 0 1px 4px rgba(0, 0, 0, 0.06);
      animation: pulse 1.5s infinite;
    }

    /* Styles pour les cours passés */
    .course-block.past {
      opacity: 0.5;
      color: var(--state-past);
    }

    /* Style pour le titre du cours — bien lisible */
    .course-title {
      font-weight: bold;
      margin-bottom: 3px;
      font-size: 1.6em;
      text-align: left;
    }

    /* Style pour le nom du coach */
    .coach-name {
      font-size: 0.68em;
      color: var(--text-secondary);
    }

    /* Style pour le studio */
    .studio-name {
      font-size: 0.55em;
      color: var(--text-tertiary);
    }

    /* Animation de pulsation optimisée */
    @keyframes pulse {
      0% { 
        transform: scale(1) translateZ(0);
        opacity: 1;
      }
      50% { 
        transform: scale(1.02) translateZ(0);
        opacity: 0.95;
      }
      100% { 
        transform: scale(1) translateZ(0);
        opacity: 1;
      }
    }

    /* Styles pour la pilule de compte à rebours */
    .countdown-pill {
      position: absolute;
      top: 2px;
      right: 0;
      transform: translateX(0);
      width: 25px;
      height: 12px;
      background-color: var(--secondary-color);
      color: var(--primary-color);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65em;
      font-weight: bold;
      padding: 0 2px;
      box-shadow: 0 1px 2px var(--shadow-medium);
      z-index: 5;
    }

    /* Styles spécifiques pour les logos de cours (+10 %) */
    .logo-cours {
      max-width: 100%;
      max-height: 23px;
      width: auto;
      height: auto;
      object-fit: contain;
      display: block;
      margin: 0 0 0 0;
    }

    /* Styles pour les cours (titre) — -5 % */
    .course-info {
      font-size: 1.14em;
      font-weight: bold;
      color: var(--text-primary);
      margin-right: 0;
      padding-right: 0;
      line-height: 1.3;
      text-align: left;
    }

    /* Retour à la ligne uniquement quand le nom complet dépasse la largeur du bloc (pas de coupure entre 2 mots si tout tient) */
    .course-name-text {
      text-align: left;
      display: block;
      width: max-content;
      max-width: 100%;
      overflow-wrap: break-word;
      word-break: normal;
      white-space: normal;
    }

    /* Quand un retour à la ligne est détecté (classe .multiline) : réduire la taille de police uniquement alors */
    .course-block .course-info .course-name-text.multiline {
      font-size: 0.84em;
    }

    .single-coach {
      font-size: 0.82em;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      margin-top: 5px;
      color: var(--primary-color);
    }

    .single-coach span {
      color: var(--primary-color);
    }

    .single-coach img {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      margin-right: 4px;
      margin-left: 2px;
      margin-bottom: 0;
    }

    /* Couleur des noms de coachs selon le type de cours */
    .course-block.piscine .single-coach span {
      color: var(--text-light);
    }

    .course-block.women-only:not(.piscine) .single-coach span {
      color: var(--text-light);
    }

    /* Styles pour les coachs multiples avec uniquement les images */
    .multiple-coaches {
      display: flex;
      justify-content: center;
      gap: 1px;
    }

    .coach-image {
      width: 22px;
      height: 22px;
      border-radius: 50%;
    }

    /* Cacher les coachs si le filtre est décoché */
    .hide-coaches .single-coach,
    .hide-coaches .multiple-coaches {
      display: none;
    }

    #weeklySchedule {
      height: 100%;
    }

    /* Bouton de filtre intégré dans la barre */
    .filters-sidebar .filter-button {
      position: absolute;
      right: 0;
      top: 0;
      background: transparent;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      min-width: 50px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      outline: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      box-shadow: none;
      margin: 0;
      padding: 0;
      z-index: 1001;
      pointer-events: all;
    }

    .filters-sidebar .filter-button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.05);
    }

    .filters-sidebar.open .filter-button:hover {
      background: var(--primary-color);
    }

    .filters-sidebar.open .filter-button:hover .filter-icon::before,
    .filters-sidebar.open .filter-button:hover .filter-icon::after,
    .filters-sidebar.open .filter-button:hover .filter-icon span {
      background: white;
    }

    .filters-sidebar .filter-button:active {
      transform: scale(0.95);
    }

    .filter-icon {
      width: 24px;
      height: 24px;
      position: relative;
      display: block;
    }

    /* Trois barres horizontales qui diminuent de taille */
    .filter-icon::before {
      content: '';
      position: absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      width: 18px;
      height: 2.5px;
      background: var(--primary-color);
      border-radius: 1px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }

    .filter-icon::after {
      content: '';
      position: absolute;
      top: 11px;
      left: 50%;
      transform: translateX(-50%);
      width: 14px;
      height: 2.5px;
      background: var(--primary-color);
      border-radius: 1px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }

    /* Troisième barre (la plus petite) via un span dans le HTML */
    .filter-icon span {
      position: absolute;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      width: 10px;
      height: 2.5px;
      background: var(--primary-color);
      border-radius: 1px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: block;
      z-index: 1;
    }

    .filter-button:hover .filter-icon::before,
    .filter-button:hover .filter-icon::after,
    .filter-button:hover .filter-icon span {
      background: white;
    }

    /* Panneau fermé : forcer les barres en bordeaux (annule le :hover collant sur mobile au 2e clic) */
    .filters-sidebar:not(.open) .filter-icon::before,
    .filters-sidebar:not(.open) .filter-icon::after,
    .filters-sidebar:not(.open) .filter-icon span {
      background: var(--primary-color) !important;
    }

    /* Barre de filtres qui part du bouton */
    .filters-sidebar {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: rgba(255, 255, 255, 0.35);
      backdrop-filter: blur(10px);
      border-radius: 25px;
      z-index: 1000;
      transition: width 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), border-radius 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      overflow: hidden;
      padding: 0;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .filters-sidebar.open {
      width: calc(100% - 40px);
      border-radius: 25px;
      overflow: visible;
    }

    .filters-sidebar-content {
      display: none;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex: 1;
      padding: 0 60px 0 15px;
      white-space: nowrap;
    }

    .filters-sidebar.open .filters-sidebar-content {
      display: flex;
    }

    .filters-sidebar h2 {
      display: none;
    }

    .filters-sidebar .filters {
      display: flex;
      flex-direction: row;
      gap: 8px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .filters-sidebar .filters label {
      font-size: 0.85em;
      color: var(--primary-color);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }

    .filters-sidebar .filters input[type="checkbox"] {
      appearance: none;
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border: 2px solid #ffffff;
      border-radius: 3px;
      margin: 0;
      position: relative;
      cursor: pointer;
    }

    .filters-sidebar .filters input[type="checkbox"]:checked {
      background-color: rgba(255, 255, 255, 0.8);
    }

    .filters-sidebar .filters input[type="checkbox"]:checked::after {
      content: '✓';
      position: absolute;
      color: var(--primary-color);
      font-size: 12px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-weight: bold;
    }

    .filters-sidebar .filters select {
      font-size: 0.8em;
      padding: 5px 25px 5px 10px;
      min-width: 110px;
      background-color: rgba(255, 255, 255, 0.9);
    }
    
    /* Style pour la liste déroulante personnalisée des coachs */
    .coach-dropdown {
      position: relative;
      min-width: 140px;
    }
    
    .coach-dropdown-button {
      width: 100%;
      padding: 6px 28px 6px 12px;
      font-size: 0.85em;
      background-color: rgba(255, 255, 255, 0.8);
      border: 1px solid #ffffff;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--primary-color);
    }
    
    .coach-dropdown-button:hover {
      background-color: rgba(255, 255, 255, 1);
    }
    
    .coach-dropdown-arrow {
      font-size: 0.7em;
      transition: transform 0.3s;
    }
    
    .coach-dropdown.open .coach-dropdown-arrow {
      transform: rotate(180deg);
    }
    
    .coach-dropdown-content {
      display: none !important;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background-color: rgba(255, 255, 255, 0.8);
      border: 1px solid #ffffff;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1002;
      margin-top: 2px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.2s, visibility 0.2s;
    }
    
    .coach-dropdown.open .coach-dropdown-content {
      display: block !important;
      visibility: visible;
      opacity: 1;
    }
    
    /* Classe pour ouvrir vers le haut */
    .coach-dropdown-content.open-up {
      top: auto !important;
      bottom: 100% !important;
      margin-top: 0 !important;
      margin-bottom: 2px !important;
    }
    
    .coach-dropdown-option {
      padding: 8px 10px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75em;
      color: var(--primary-color);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .coach-dropdown-option:last-child {
      border-bottom: none;
    }
    
    .coach-dropdown-option:hover {
      background-color: rgba(72, 6, 7, 0.1);
    }
    
    .coach-dropdown-option input[type="checkbox"] {
      width: 14px;
      height: 14px;
      margin: 0;
      cursor: pointer;
      display: none;
    }
    
    .coach-dropdown-option .checkmark {
      color: var(--primary-color);
      font-weight: bold;
      margin-left: auto;
      font-size: 1em;
    }
    
    .coach-dropdown-option label {
      display: flex;
      align-items: center;
      width: 100%;
      cursor: pointer;
      gap: 10px;
    }

    .coach-dropdown-option-photo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
      background-color: rgba(72, 6, 7, 0.1);
    }

    .coach-dropdown-option label span:first-of-type {
      flex: 1;
      font-size: 1.15em;
      color: var(--primary-color);
    }

    .filters-sidebar-close {
      display: none;
    }

    /* Style pour le bouton today-view (en haut) */
    .today-view-button {
      position: fixed;
      top: 55px;
      right: 10px;
      z-index: 1000;
      background: none;
      padding: 0;
      width: 55px;
      height: 55px;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      pointer-events: all;
      animation: none;
      display: block;
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    /* Style pour le bouton today-view (en haut) */
    .today-view-button-bottom {
      position: fixed;
      top: 55px;
      right: 10px;
      z-index: 1000;
      background: none;
      padding: 0;
      width: 55px;
      height: 55px;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      pointer-events: all;
      display: block;
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .today-view-button-bottom::before {
      content: '';
      position: absolute;
      width: 55px;
      height: 55px;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/d983712e-5b70-9ebc-9696-6a677290a963.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      animation: rotate-icon 6s cubic-bezier(0.4, 0, 0.2, 1) infinite;
      transform-origin: center;
      pointer-events: none;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      -webkit-transform-style: preserve-3d;
      transform-style: preserve-3d;
      will-change: transform;
    }

    .today-view-button-bottom::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      background-color: var(--background-main);
      border-radius: 50%;
      box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      pointer-events: none;
      z-index: 2;
    }

    .today-view-button-bottom button {
      z-index: 3;
      width: 100%;
      height: 100%;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      outline: none;
      pointer-events: all;
    }

    .today-view-button.visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }

    .today-view-button::before {
      content: '';
      position: absolute;
      width: 55px;
      height: 55px;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/d983712e-5b70-9ebc-9696-6a677290a963.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      animation: rotate-icon 6s cubic-bezier(0.4, 0, 0.2, 1) infinite;
      transform-origin: center;
      pointer-events: none;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      -webkit-transform-style: preserve-3d;
      transform-style: preserve-3d;
      will-change: transform;
    }

    .today-view-button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      background-color: var(--background-main);
      border-radius: 50%;
      box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      pointer-events: none;
      z-index: 2;
    }

    .today-view-button button {
      z-index: 3;
      width: 100%;
      height: 100%;
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      outline: none;
      pointer-events: all;
    }

    @keyframes rotate-icon {
      0% {
        transform: rotate(0deg);
      }
      50% {
        transform: rotate(180deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    /* Style pour le bouton de rotation */
    .rotation-view-button {
      position: fixed;
      bottom: 80px;
      right: 20px;
      z-index: 1001;
      background: rgba(255, 255, 255, 0.35);
      backdrop-filter: blur(10px);
      border-radius: 25px;
      padding: 0;
      width: 50px;
      height: 50px;
      min-width: 48px;
      min-height: 48px;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      pointer-events: all;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), background 0.2s ease;
      touch-action: manipulation;
    }

    .rotation-view-button::before {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      background-image: url('https://mcusercontent.com/74abea872abd45d46efed5d41/images/665404b9-0908-8116-6c7b-5c61a7075d36.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      transform-origin: center;
      pointer-events: none;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      -webkit-transform-style: preserve-3d;
      transform-style: preserve-3d;
    }

    .rotation-view-button button {
      position: absolute;
      inset: 0;
      z-index: 3;
      width: 100%;
      height: 100%;
      background: none;
      border: none;
      cursor: pointer;
      display: block;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
      outline: none;
      pointer-events: all;
      border-radius: 25px;
      touch-action: manipulation;
    }

    /* Animation de clic (compatible mobile : active + classe JS) */
    .rotation-view-button:active::before,
    .rotation-view-button.tap-active::before {
      animation: click-zoom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .rotation-view-button:hover {
      background: rgba(255, 255, 255, 0.5);
      transform: scale(1.05);
    }

    .rotation-view-button:active {
      transform: scale(0.98);
    }

    @keyframes click-zoom {
      0% { transform: scale(1) translateZ(0); }
      50% { transform: scale(0.95) translateZ(0); }
      100% { transform: scale(1) translateZ(0); }
    }

    /* Styles responsives pour différentes tailles d'écran */
    @media screen and (max-width: 480px) {
      :root {
        --schedule-hours-width: 36px;
        --schedule-hours-min-width: 36px;
        --schedule-day-width: calc((100vw - 36px) / 4.4);
      }

      .header-wrapper h1 {
        font-size: 1em;
      }

      .filters {
        gap: 3px;
      }

      .filters label {
        font-size: 0.6em;
      }

      .filters select {
        font-size: 0.6em;
        min-width: 80px;
        padding: 2px 18px 2px 6px;
      }

      .weekly-schedule {
        font-size: 0.55em;
      }

      .weekly-schedule thead th:not(:first-child) {
        font-size: 1.2em;
        padding: 6px 4px;
      }

      /* Colonne heures mobile : plus étroite, padding réduit, texte un peu plus grand */
      .weekly-schedule th:first-child,
      .weekly-schedule td.time-cell {
        width: 36px;
        min-width: 36px;
        font-size: 1.28em;
        line-height: 1.15;
        padding: 3px 1px;
      }

      .sticky-days-bar .weekly-schedule-header th:first-child,
      .sticky-days-bar .weekly-schedule-header col.col-hours {
        width: 36px;
        min-width: 36px;
      }

      .course-block {
        padding: 5px 6px 5px 8px;
        padding-right: 16px;
        font-size: 0.5em;
      }

      .logo-cours {
        max-width: 100%;
        max-height: 22px;
        width: auto;
        height: auto;
      }

      .course-info {
        font-size: 0.34em;
        width: 100%;
        text-align: left;
      }

      .course-name-text {
        font-size: 0.71em;
        text-align: left;
      }

      /* Nom du cours en texte (sans logo) sur mobile : pleine largeur du bloc, retour à la ligne seulement si débordement */
      .course-block .course-info .course-name-text {
        font-size: 9.5px !important;
        line-height: 1.2;
        display: block;
        transform: none;
        margin-bottom: 6px;
        max-width: 100%;
      }

      /* 2+ lignes : taille de police réduite (classe .multiline ajoutée par JS), léger rapprochement sans chevauchement */
      .course-block .course-info .course-name-text.multiline {
        font-size: 8px !important;
        margin-bottom: 4px;
      }

      .course-block:has(.course-info .course-name-text) .course-info + .single-coach,
      .course-block:has(.course-info .course-name-text) .course-info + .multiple-coaches {
        margin-top: 0;
      }

      .course-block:has(.course-info .course-name-text.multiline) .course-info + .single-coach,
      .course-block:has(.course-info .course-name-text.multiline) .course-info + .multiple-coaches {
        margin-top: 0;
      }

      .single-coach {
        font-size: 0.78em;
      }

      .single-coach img,
      .coach-image {
        width: 20px;
        height: 20px;
      }

      .countdown-pill {
        width: 20px;
        height: 10px;
        font-size: 0.55em;
      }

      /* Réduire de 15% les éléments du filtre pour qu'ils tiennent sur une ligne */
      .filters-sidebar .filters label {
        font-size: 0.7225em; /* 0.85em * 0.85 */
        gap: 4.25px; /* 5px * 0.85 */
      }

      .filters-sidebar .filters input[type="checkbox"] {
        width: 13.6px; /* 16px * 0.85 */
        height: 13.6px; /* 16px * 0.85 */
      }

      .filters-sidebar .filters input[type="checkbox"]:checked::after {
        font-size: 10.2px; /* 12px * 0.85 */
      }

      .coach-dropdown {
        min-width: 119px; /* 140px * 0.85 */
      }

      .coach-dropdown-button {
        padding: 5.1px 23.8px 5.1px 10.2px; /* 6px 28px 6px 12px * 0.85 */
        font-size: 0.7225em; /* 0.85em * 0.85 */
      }

      .filters-sidebar .filters {
        gap: 6.8px; /* 8px * 0.85 */
      }
    }

    @media screen and (min-width: 481px) and (max-width: 768px) {
      .header-wrapper h1 {
        font-size: 1.1em;
      }

      .weekly-schedule {
        font-size: 0.6em;
      }

      .course-block {
        font-size: 0.65em;
        padding: 8px 10px 8px 10px;
        padding-right: 18px;
      }

      .course-info {
        font-size: 0.55em;
        width: 100%;
        text-align: left;
      }

      .single-coach {
        font-size: 0.28em;
      }

      .logo-cours {
        max-height: 24px;
      }
    }

    @media screen and (min-width: 769px) and (max-width: 1024px) {
      .header-wrapper h1 {
        font-size: 1.15em;
      }

      .weekly-schedule {
        font-size: 0.7em;
      }

      .course-block {
        font-size: 0.68em;
        padding: 8px 10px 8px 12px;
        padding-right: 18px;
      }

      .course-info {
        font-size: 0.64em;
        width: 100%;
        text-align: left;
      }

      .single-coach {
        font-size: 0.29em;
      }

      .logo-cours {
        max-height: 26px;
      }
    }

    @media screen and (min-width: 1025px) {
      .header-wrapper h1 {
        font-size: 1.3em;
      }

      .weekly-schedule {
        font-size: 0.75em;
      }

      .course-block {
        font-size: 0.72em;
        padding: 10px 12px 10px 16px;
        padding-right: 20px;
      }

      .course-info {
        font-size: 0.68em;
        width: 100%;
        text-align: left;
      }

      .single-coach {
        font-size: 0.3em;
      }

      .logo-cours {
        max-height: 29px;
      }
    }

    /* Séparation matin / après-midi : motif 64×64 en tuilage, 50 % opaque ; colonne heures 100 % opaque */
    tr.noon-separator td {
      height: 60px;
      min-height: 60px;
      padding: 0;
      margin: 0;
      border: none;
      background-color: rgba(72, 6, 7, 0.12);
      position: relative;
      vertical-align: middle;
    }

    tr.noon-separator td::before {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      background-image: url(https://mcusercontent.com/74abea872abd45d46efed5d41/images/2d4c73b7-fe42-6a75-9542-d52da9dcc082.png);
      background-size: 67px 67px;
      background-repeat: repeat;
      opacity: 0.4;
      pointer-events: none;
      z-index: 0;
    }

    /* Colonne des heures (sticky) : ni fond ni motif */
    tr.noon-separator td.time-cell {
      background-color: transparent;
    }

    tr.noon-separator td.time-cell::before {
      display: none;
    }

    tr.noon-separator td.noon-separator-line {
      background-color: rgba(72, 6, 7, 0.12);
    }

  </style>
</head>
<body onload="initializeWeeklyPage();">
  <div class="content-wrapper">
    <div id="planningViewSwitcher" style="display: none;"></div>
    <!-- Barre des jours sticky (hors overflow-x) + scroll horizontal synchronisé -->
    <div class="sticky-days-bar" id="stickyDaysBar" aria-hidden="true">
      <div class="sticky-scroll-wrapper" id="stickyScrollWrapper">
        <div id="stickyHeaderContent"></div>
      </div>
    </div>
    <div class="schedule-scroll-wrapper" id="scheduleScrollWrapper">
      <div id="weeklySchedule"></div>
    </div>
  </div>
  <div class="scroll-shadow-left" id="scrollShadowLeft" aria-hidden="true"></div>
  <div class="scroll-shadow-right" id="scrollShadowRight" aria-hidden="true"></div>

  <!-- Bouton pour revenir à aujourd'hui -->
  <div class="today-view-button" id="todayViewButton">
    <button onclick="returnToToday()">
    </button>
  </div>

  <!-- Bouton de rotation vers weekly.html -->
  <div class="rotation-view-button" id="rotationViewButton" role="button" tabindex="0" aria-label="Vue horizontale du planning" onclick="goToWeekly()">
    <button type="button" aria-label="Vue horizontale du planning"></button>
  </div>

  <!-- Barre de filtres en bas avec le bouton intégré -->
  <div class="filters-sidebar" id="filtersSidebar">
    <button class="filter-button" onclick="toggleFiltersSidebar(event)">
      <div class="filter-icon"><span></span></div>
    </button>
    <div class="filters-sidebar-content">
      <div class="filters">
        <label>
          <input type="checkbox" id="filter-mixte" checked>
          Mixte
        </label>
        <label>
          <input type="checkbox" id="filter-women-only" checked>
          Femmes
        </label>
        <label>
          <input type="checkbox" id="filter-piscine" checked>
          Piscine
        </label>
        <label>
          <input type="checkbox" id="filter-coach" checked>
          Coach
        </label>
        <div class="coach-dropdown">
          <button class="coach-dropdown-button" id="coachDropdownButton">
            <span id="coachDropdownText">Sélection coach</span>
            <span class="coach-dropdown-arrow">▼</span>
          </button>
          <div class="coach-dropdown-content" id="coachDropdownContent">
            <!-- Les options seront ajoutées ici dynamiquement -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Option pour afficher/masquer les logos de cours
    const SHOW_COURSE_IMAGES = true;
    
    // Initialiser les variables
    var scheduleData = [];
    var activePlanningView = 'regulier';
    function getCurrentPlanning() {
      if (!scheduleData || !scheduleData.planning) return {};
      if (activePlanningView === 'ramadan' && scheduleData.planningRamadan) {
        var pr = scheduleData.planningRamadan;
        var hasCourses = Object.keys(pr).some(function(day) { return pr[day] && pr[day].length > 0; });
        if (hasCourses) return pr;
      }
      return scheduleData.planning;
    }
    function initPlanningView(data) {
      var params = new URLSearchParams(window.location.search);
      var urlView = params.get('planning');
      var stored = localStorage.getItem('planningView');
      var today = new Date().toISOString().slice(0, 10);
      var ramadanStart = data.metadata && data.metadata.ramadanStart;
      var ramadanEnd = data.metadata && data.metadata.ramadanEnd;
      var inRamadan = ramadanStart && ramadanEnd && today >= ramadanStart && today <= ramadanEnd;
      if (urlView === 'ramadan' || urlView === 'regulier') { activePlanningView = urlView; localStorage.setItem('planningView', urlView); }
      else if (stored === 'ramadan' || stored === 'regulier') { activePlanningView = stored; }
      else if (inRamadan) { activePlanningView = 'ramadan'; localStorage.setItem('planningView', 'ramadan'); }
      else { activePlanningView = 'regulier'; localStorage.setItem('planningView', 'regulier'); }
      document.body.classList.toggle('planning-ramadan', activePlanningView === 'ramadan');
    }
    function renderPlanningViewSwitcher(data) {
      var container = document.getElementById('planningViewSwitcher');
      if (!container) return;
      var meta = data.metadata || {};
      var ramadanStart = meta.ramadanStart, ramadanEnd = meta.ramadanEnd;
      var today = new Date().toISOString().slice(0, 10);
      var inRamadan = ramadanStart && ramadanEnd && today >= ramadanStart && today <= ramadanEnd;
      var daysBefore = 7;
      var showSwitcher = (data.planningRamadan && ramadanStart) && (inRamadan || (today < ramadanStart && (new Date(ramadanStart) - new Date(today)) / (24*60*60*1000) <= daysBefore));
      if (!showSwitcher) { container.style.display = 'none'; container.innerHTML = ''; return; }
      container.innerHTML = '';
      var btn = document.createElement('button');
      if (activePlanningView === 'ramadan') { btn.textContent = 'Voir planning régulier'; btn.classList.add('active'); btn.onclick = function() { setPlanningView('regulier'); }; }
      else { var dateDebut = ramadanStart ? (function(s) { var p = s.split('-'); if (p.length !== 3) return ''; var mois = ['janvier','février','mars','avril','mai','juin','juillet','août','septembre','octobre','novembre','décembre']; return p[2] + ' ' + (mois[parseInt(p[1],10)-1] || ''); })(ramadanStart) : ''; btn.textContent = inRamadan ? 'Voir planning Ramadan' : 'Voir planning Ramadan' + (dateDebut ? ' (' + dateDebut + ')' : ' (à venir)'); btn.onclick = function() { setPlanningView('ramadan'); }; }
      container.appendChild(btn);
      container.style.display = 'flex';
    }
    function setPlanningView(view) {
      activePlanningView = view;
      localStorage.setItem('planningView', view);
      document.body.classList.toggle('planning-ramadan', view === 'ramadan');
      refreshPlanningDisplay();
    }
    function refreshPlanningDisplay() {
      if (!scheduleData || !scheduleData.planning) return;
      document.getElementById('weeklySchedule').innerHTML = generateWeeklyScheduleHtml();
      markMultilineCourseNames();
      renderPlanningViewSwitcher(scheduleData);
      var stickyContent = document.getElementById('stickyHeaderContent');
      var scheduleWrapper = document.getElementById('scheduleScrollWrapper');
      var mainTable = document.querySelector('#weeklySchedule .weekly-schedule');
      var thead = mainTable && mainTable.querySelector('thead');
      if (stickyContent && thead) {
        stickyContent.innerHTML = '';
        var headerTable = document.createElement('table');
        headerTable.className = 'weekly-schedule weekly-schedule-header';
        headerTable.setAttribute('aria-hidden', 'true');
        var colgroup = mainTable.querySelector('colgroup');
        if (colgroup) headerTable.appendChild(colgroup.cloneNode(true));
        headerTable.appendChild(thead.cloneNode(true));
        stickyContent.appendChild(headerTable);
        thead.remove();
      }
      applyFilters();
    }

    function initializeWeeklyPage() {
      fetchWeeklyData().then(data => {
        console.group('Traitement des données');
        console.log('Données reçues:', data);
        
        const coursData = data.cours;
        const coachsData = data.coachs;
        const studiosData = data.studios;

        scheduleData = data;
        initPlanningView(data);
        renderPlanningViewSwitcher(data);

        const planningData = getCurrentPlanning();
        console.log('Planning actif:', activePlanningView, 'Planning:', planningData);
        console.log('Cours:', coursData);
        console.log('Coachs:', coachsData);
        console.log('Studios:', studiosData);
        
        console.groupEnd();

        document.getElementById('weeklySchedule').innerHTML = generateWeeklyScheduleHtml();

        /* Barre des jours sticky : cloner thead hors du scroll-wrapper pour que sticky fonctionne */
        (function setupStickyDaysBar() {
          var mainTable = document.querySelector('#weeklySchedule .weekly-schedule');
          var thead = mainTable && mainTable.querySelector('thead');
          var stickyContent = document.getElementById('stickyHeaderContent');
          var stickyWrapper = document.getElementById('stickyScrollWrapper');
          var scheduleWrapper = document.getElementById('scheduleScrollWrapper');
          if (!thead || !stickyContent || !stickyWrapper || !scheduleWrapper) return;
          var colgroup = mainTable.querySelector('colgroup');
          var headerTable = document.createElement('table');
          headerTable.className = 'weekly-schedule weekly-schedule-header';
          headerTable.setAttribute('aria-hidden', 'true');
          if (colgroup) headerTable.appendChild(colgroup.cloneNode(true));
          headerTable.appendChild(thead.cloneNode(true));
          stickyContent.appendChild(headerTable);
          thead.remove();
          /* Synchro scroll horizontal fluide : boucle rAF + transform (mise à jour à chaque frame, écriture DOM seulement si la valeur change) */
          var rafId = null;
          var lastScrollLeft = -1;
          var lastApplied = -1;
          var sameCount = 0;
          function tick() {
            var current = scheduleWrapper.scrollLeft;
            if (current !== lastApplied) {
              lastApplied = current;
              stickyContent.style.transform = 'translate3d(' + (-current) + 'px,0,0)';
            }
            if (current === lastScrollLeft) {
              sameCount++;
              if (sameCount >= 3) {
                rafId = null;
                return;
              }
            } else {
              sameCount = 0;
              lastScrollLeft = current;
            }
            rafId = requestAnimationFrame(tick);
          }
          function onScroll() {
            if (rafId === null) {
              lastScrollLeft = scheduleWrapper.scrollLeft;
              lastApplied = -1;
              sameCount = 0;
              rafId = requestAnimationFrame(tick);
            }
          }
          scheduleWrapper.addEventListener('scroll', onScroll, { passive: true });
          stickyContent.style.transform = 'translate3d(0,0,0)';
          scheduleWrapper.style.webkitOverflowScrolling = 'touch';
        })();

        markMultilineCourseNames();

        /* Ombres : droite = masquée en fin de scroll ; gauche = positionnée au bord droit de la colonne sticky (JS), visible uniquement quand on a défilé vers la droite */
        (function setupScrollShadow() {
          var wrapper = document.getElementById('scheduleScrollWrapper');
          var shadowRight = document.getElementById('scrollShadowRight');
          var shadowLeft = document.getElementById('scrollShadowLeft');
          var contentWrapper = document.querySelector('.content-wrapper');
          if (!wrapper || !shadowRight) return;
          function updateShadows() {
            var scrollLeft = wrapper.scrollLeft;
            if (scrollLeft + wrapper.clientWidth >= wrapper.scrollWidth - 2) {
              shadowRight.classList.add('at-end');
            } else {
              shadowRight.classList.remove('at-end');
            }
            if (shadowLeft) {
              var timeCell = document.querySelector('#weeklySchedule .weekly-schedule td.time-cell');
              var firstCellSticky = document.querySelector('.sticky-days-bar .weekly-schedule-header th:first-child');
              if (timeCell) {
                var rect = timeCell.getBoundingClientRect();
                shadowLeft.style.left = rect.right + 'px';
              }
              if (firstCellSticky) {
                var topRect = firstCellSticky.getBoundingClientRect();
                shadowLeft.style.top = topRect.bottom + 'px';
              } else {
                shadowLeft.style.top = '0';
              }
              if (scrollLeft > 0) {
                shadowLeft.classList.add('visible');
              } else {
                shadowLeft.classList.remove('visible');
              }
            }
          }
          wrapper.addEventListener('scroll', updateShadows, { passive: true });
          if (contentWrapper) contentWrapper.addEventListener('scroll', updateShadows, { passive: true });
          window.addEventListener('resize', updateShadows);
          updateShadows();
        })();

        let uniqueCoachesMap = new Map();
        const defaultCoachImage = 'https://mcusercontent.com/74abea872abd45d46efed5d41/images/8fd797c9-5e06-60a8-1720-128bcf9390cf.png';
        Object.values(planningData).forEach(dayCourses => {
          dayCourses.forEach(course => {
            if (course.coachIds) {
              course.coachIds.forEach(coachId => {
                const coach = coachsData.find(c => c.id === coachId);
                if (coach && !uniqueCoachesMap.has(coach.name)) {
                  uniqueCoachesMap.set(coach.name, { name: coach.name, imageUrl: coach.imageUrl || defaultCoachImage });
                }
              });
            }
          });
        });
        let uniqueCoaches = new Set(uniqueCoachesMap.keys());

        let coachDropdownContent = document.getElementById('coachDropdownContent');
        let coachDropdownButton = document.getElementById('coachDropdownButton');
        let coachDropdownText = document.getElementById('coachDropdownText');
        let selectedCoaches = new Set(); // Aucun sélectionné par défaut
        
        // Créer les options avec photo + checkboxes
        Array.from(uniqueCoachesMap.values()).sort((a, b) => a.name.localeCompare(b.name)).forEach(function(coachObj) {
          let option = document.createElement('div');
          option.className = 'coach-dropdown-option';
          
          let label = document.createElement('label');
          label.style.display = 'flex';
          label.style.justifyContent = 'space-between';
          label.style.alignItems = 'center';
          label.style.width = '100%';
          label.style.cursor = 'pointer';
          
          let img = document.createElement('img');
          img.className = 'coach-dropdown-option-photo';
          img.src = coachObj.imageUrl;
          img.alt = coachObj.name;
          
          let span = document.createElement('span');
          span.textContent = coachObj.name;
          
          let checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.value = coachObj.name;
          checkbox.checked = false; // Aucun sélectionné par défaut
          
          let checkmark = document.createElement('span');
          checkmark.className = 'checkmark';
          checkmark.textContent = '✓';
          checkmark.style.display = 'none'; // Masqué par défaut
          
          checkbox.addEventListener('change', function() {
            if (checkbox.checked) {
              selectedCoaches.add(coachObj.name);
            } else {
              selectedCoaches.delete(coachObj.name);
            }
            checkmark.style.display = checkbox.checked ? 'inline' : 'none';
            updateCoachDropdownText();
            applyFilters();
          });
          
          option.addEventListener('click', function(e) {
            if (e.target !== checkbox) {
              e.preventDefault();
              checkbox.checked = !checkbox.checked;
              checkbox.dispatchEvent(new Event('change'));
            }
          });
          
          label.appendChild(img);
          label.appendChild(span);
          label.appendChild(checkmark);
          label.appendChild(checkbox);
          option.appendChild(label);
          coachDropdownContent.appendChild(option);
        });
        
        // Fonction pour mettre à jour le texte du bouton
        function updateCoachDropdownText() {
          if (selectedCoaches.size === 0) {
            coachDropdownText.textContent = 'Sélection coach';
          } else if (selectedCoaches.size === uniqueCoaches.size) {
            coachDropdownText.textContent = 'Sélection coach';
          } else {
            coachDropdownText.textContent = selectedCoaches.size === 1 ? '1 coach' : selectedCoaches.size + ' coachs';
          }
        }
        
        // Mettre à jour le texte initial du bouton
        updateCoachDropdownText();
        
        // Toggle dropdown avec détection de l'espace disponible
        coachDropdownButton.addEventListener('click', function(e) {
          e.stopPropagation();
          const dropdown = coachDropdownButton.closest('.coach-dropdown');
          const content = document.getElementById('coachDropdownContent');
          
          dropdown.classList.toggle('open');
          
          if (dropdown.classList.contains('open')) {
            // Vérifier l'espace disponible en bas et en haut
            const buttonRect = coachDropdownButton.getBoundingClientRect();
            const spaceBelow = window.innerHeight - buttonRect.bottom;
            const spaceAbove = buttonRect.top;
            const contentHeight = 200; // max-height
            
            // Si pas assez d'espace en bas mais assez en haut, ouvrir vers le haut
            if (spaceBelow < contentHeight && spaceAbove > spaceBelow) {
              content.classList.add('open-up');
            } else {
              // Ouvrir vers le bas (comportement par défaut)
              content.classList.remove('open-up');
            }
          } else {
            // Retirer la classe quand on ferme
            content.classList.remove('open-up');
          }
        });
        
        // Fermer le dropdown quand on clique ailleurs
        document.addEventListener('click', function(e) {
          if (!e.target.closest('.coach-dropdown')) {
            document.querySelectorAll('.coach-dropdown').forEach(dropdown => {
              dropdown.classList.remove('open');
            });
          }
        });

        document.getElementById('filter-mixte').addEventListener('change', applyFilters);
        document.getElementById('filter-women-only').addEventListener('change', applyFilters);
        document.getElementById('filter-piscine').addEventListener('change', applyFilters);
        document.getElementById('filter-coach').addEventListener('change', applyFilters);

        applyFilters();
        
        setTimeout(() => {
          scrollToCurrentTime();
        }, 500);
        
        updateCountdownCircles();
        setInterval(updateCountdownCircles, 1000);
        setInterval(checkCourseStates, 60000);
        setTimeout(checkCourseStates, 1000);
      }).catch(error => {
        console.error('Erreur lors de la récupération des données :', error);
      });
    }

    function fetchWeeklyData() {
      const cacheKey = 'weeklyData';
      const cacheExpirationKey = 'weeklyDataExpiration';
      
      const cachedData = localStorage.getItem(cacheKey);
      const cacheExpiration = localStorage.getItem(cacheExpirationKey);
      const now = new Date().getTime();

      if (cachedData && cacheExpiration && now < cacheExpiration) {
        console.log('Utilisation des données en cache');
        return Promise.resolve(JSON.parse(cachedData));
      }

      return fetch('https://raw.githubusercontent.com/canalforme-official/app-data/main/planning-v2.json')
        .then(response => {
          if (!response.ok) {
            throw new Error(`Erreur HTTP: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          console.group('Validation des données');
          
          console.log('Structure de base:', {
            metadata: data.metadata ? '✅ Présent' : '❌ Manquant',
            coachs: data.coachs ? `✅ ${data.coachs.length} coachs` : '❌ Manquant',
            studios: data.studios ? `✅ ${data.studios.length} studios` : '❌ Manquant',
            cours: data.cours ? `✅ ${data.cours.length} cours` : '❌ Manquant',
            planning: data.planning ? `✅ ${Object.keys(data.planning).length} jours` : '❌ Manquant',
            planningRamadan: data.planningRamadan ? '✅ Présent' : '—'
          });

          const jours = Object.keys(data.planning || {});
          console.log('Jours avec planning:', jours);
          if (jours.length > 0 && data.planning) {
            const premierJour = jours[0];
            console.log(`Exemple de cours pour ${premierJour}:`, data.planning[premierJour][0]);
          }

          console.groupEnd();

          localStorage.setItem(cacheKey, JSON.stringify(data));
          localStorage.setItem(cacheExpirationKey, now + 360000);
          console.log('✅ Données récupérées et stockées dans le cache');
          
          return data;
        })
        .catch(error => {
          console.error('❌ Erreur lors de la récupération des données:', error);
          throw error;
        });
    }

    function applyFilters() {
      const showMixte = document.getElementById('filter-mixte').checked;
      const showWomenOnly = document.getElementById('filter-women-only').checked;
      const showPiscine = document.getElementById('filter-piscine').checked;
      const showCoachImages = document.getElementById('filter-coach').checked;
      
      // Récupérer tous les coachs sélectionnés
      const coachCheckboxes = document.querySelectorAll('#coachDropdownContent input[type="checkbox"]');
      const selectedCoaches = Array.from(coachCheckboxes)
        .filter(cb => cb.checked)
        .map(cb => cb.value);

      const blocks = document.querySelectorAll('.course-block');
      const contentWrapper = document.querySelector('.content-wrapper');

      for (const block of blocks) {
        const dataCoaches = block.getAttribute('data-coaches') || '';
        const courseCoaches = dataCoaches.split(',').map(coach => coach.trim());
        
        // Vérifier si au moins un des coachs du cours est dans la liste des coachs sélectionnés
        const showByCoach = selectedCoaches.length === 0 || 
          courseCoaches.some(coach => selectedCoaches.includes(coach));
        
        const isPiscine = block.classList.contains('piscine');
        const courseType = block.classList;
        const showByType = (
          (courseType.contains('mixte') && showMixte) ||
          (courseType.contains('women-only') && showWomenOnly)
        );

        block.style.display = (showByCoach && showByType && (!isPiscine || showPiscine)) ? 'block' : 'none';
      }

      if (showCoachImages) {
        contentWrapper.classList.remove('hide-coaches');
      } else {
        contentWrapper.classList.add('hide-coaches');
      }
    }

    function updateCountdownCircles() {
      const badges = document.querySelectorAll('.countdown-pill');
      
      for (const badge of badges) {
        const timeDiff = parseInt(badge.getAttribute('data-time-diff'));

        if (timeDiff >= 0) {
          const minutes = Math.floor(timeDiff / 60);
          const seconds = timeDiff % 60;
          const timeString = (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
          badge.textContent = timeString;
          badge.setAttribute('data-time-diff', timeDiff - 1);
        } else {
          badge.parentElement.classList.remove('starting-soon');
          badge.remove();
        }
      }
    }

    function generateWeeklyScheduleHtml() {
      var weekDays = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
      var todayIndex = new Date().getDay();
      var todayName = weekDays[todayIndex];

      const planning = getCurrentPlanning();
      const cours = scheduleData.cours;
      const coachs = scheduleData.coachs;
      const studios = scheduleData.studios;

      var scheduleByTimeAndDay = {};

      Object.entries(planning).forEach(([day, courses]) => {
        const dayIndex = weekDays.findIndex(d => d.toLowerCase() === day);
        const frenchDay = weekDays[dayIndex];

        courses.forEach(course => {
          const startTime = course.startTime;
          
          if (!scheduleByTimeAndDay[startTime]) {
            scheduleByTimeAndDay[startTime] = {};
          }
          if (!scheduleByTimeAndDay[startTime][frenchDay]) {
            scheduleByTimeAndDay[startTime][frenchDay] = [];
          }

          const courseInfo = cours.find(c => c.id === course.coursId);
          const studioInfo = studios.find(s => s.id === course.studioId);
          const coachsInfo = course.coachIds.map(coachId => 
            coachs.find(c => c.id === coachId)
          );

          scheduleByTimeAndDay[startTime][frenchDay].push({
            courseName: courseInfo ? courseInfo.name : 'Cours inconnu',
            logo: courseInfo ? courseInfo.logo : '',
            studio: studioInfo ? studioInfo.name : 'Studio inconnu',
            endTime: course.endTime,
            startTime: course.startTime,
            duration: course.duration,
            type: course.type,
            coachs: coachsInfo.map(coach => ({
              name: coach ? coach.name : 'Coach inconnu',
              imageUrl: coach ? coach.imageUrl : ''
            }))
          });
        });
      });

      var daysWithCourses = new Set();
      var timesWithCourses = new Set();

      for (var time in scheduleByTimeAndDay) {
        for (var day in scheduleByTimeAndDay[time]) {
          daysWithCourses.add(day);
          timesWithCourses.add(time);
        }
      }

      var daysArray = Array.from(daysWithCourses);
      var timesArray = Array.from(timesWithCourses);

      daysArray.sort(function(a, b) {
        return weekDays.indexOf(a) - weekDays.indexOf(b);
      });

      timesArray.sort();

      var html = '<table class="weekly-schedule">';
      html += '<colgroup><col class="col-hours">';
      for (var i = 0; i < daysArray.length; i++) {
        html += '<col class="col-day">';
      }
      html += '</colgroup>';
      html += '<thead><tr><th></th>';
      for (var i = 0; i < daysArray.length; i++) {
        var dayClass = '';
        if (daysArray[i] === todayName) {
          dayClass = 'today';
        }
        html += '<th class="' + dayClass + '">' + daysArray[i] + '</th>';
      }
      html += '</tr></thead>';

      html += '<tbody>';

      var isWhiteRow = true;

      function isAfterNoon(timeStr) {
        var parts = (timeStr || '').split(':');
        var h = parseInt(parts[0], 10) || 0;
        return h >= 12;
      }

      for (var t = 0; t < timesArray.length; t++) {
        var time = timesArray[t];

        /* Ligne de séparation entre matinée et après-midi (avant la première heure >= 12:00), zone continue */
        if (t > 0 && isAfterNoon(time) && !isAfterNoon(timesArray[t - 1])) {
          html += '<tr class="noon-separator">';
          html += '<td class="time-cell time-cell-grey"></td>';
          html += '<td class="noon-separator-line course-cell" colspan="' + daysArray.length + '"></td>';
          html += '</tr>';
        }

        var rowClass = isWhiteRow ? 'course-row-white' : 'course-row-grey';
        var timeCellClass = isWhiteRow ? 'time-cell-white' : 'time-cell-grey';

        isWhiteRow = !isWhiteRow;

        html += '<tr class="' + rowClass + '">';

        // Afficher uniquement l'heure de début dans la colonne de gauche
        html += '<td class="time-cell ' + timeCellClass + '">' + time + '</td>';

        for (var d = 0; d < daysArray.length; d++) {
          var day = daysArray[d];
          var courses = scheduleByTimeAndDay[time][day];

          html += '<td class="course-cell">';
          if (courses && courses.length > 0) {
            for (var c = 0; c < courses.length; c++) {
              var course = courses[c];
              var courseDisplay = '';

              var logoUrl = course.logo || '';
              var courseNameDisplay = '';

              if (SHOW_COURSE_IMAGES && logoUrl) {
                courseNameDisplay = '<img class="logo-cours" src="' + logoUrl + '" alt="' + course.courseName + ' Logo">';
              } else {
                courseNameDisplay = '<div class="course-name-text">' + course.courseName + '</div>';
              }

              var coachImagesHtml = '';
              if (course.coachs.length === 1) {
                var coachImageUrl = course.coachs[0].imageUrl || 'https://mcusercontent.com/74abea872abd45d46efed5d41/images/a340beeb-f8a3-d937-7eb8-e17882fc82ec.png';
                coachImagesHtml = '<div class="single-coach">' +
                                  '<img src="' + coachImageUrl + '" alt="' + course.coachs[0].name + '">' +
                                  '<span>' + course.coachs[0].name + '</span></div>';
              } else if (course.coachs.length > 1) {
                coachImagesHtml = '<div class="multiple-coaches">';
                var coachImages = course.coachs.map(coach => coach.imageUrl).filter(Boolean);
                coachImages.forEach(function(coachImageUrl, index) {
                  coachImagesHtml += '<img src="' + coachImageUrl + '" alt="Coach Image" class="coach-image">';
                });
                coachImagesHtml += '</div>';
              }

              var courseClasses = 'course-block';
              if (course.type === '100% Femmes') {
                courseClasses += ' women-only';
              } else {
                courseClasses += ' mixte';
              }

              if (course.studio.toLowerCase().includes('piscine') || course.studio.toLowerCase().includes('aqua')) {
                courseClasses += ' piscine';
              }

              var now = new Date();
              var courseDate = new Date();
              
              var startTimeParts = course.startTime ? course.startTime.split(':') : ['00', '00'];
              var startHour = parseInt(startTimeParts[0]) || 0;
              var startMinute = parseInt(startTimeParts[1]) || 0;
              
              var currentDay = now.getDay();
              var targetDay = weekDays.indexOf(day);
              
              var dayDiff = targetDay - currentDay;
              if (dayDiff < 0) {
                dayDiff += 7;
              }
              
              courseDate.setDate(now.getDate() + dayDiff);
              courseDate.setHours(startHour, startMinute, 0, 0);
              
              var timeDifference = Math.floor((courseDate - now) / 1000);
              
              var isStartingSoon = timeDifference >= 0 && timeDifference <= 900;
              var isInProgress = timeDifference < 0 && timeDifference > -course.duration * 60;
              
              if (isStartingSoon) {
                courseClasses += ' starting-soon';
              } else if (isInProgress) {
                courseClasses += ' current';
              }

              courseDisplay += '<div class="' + courseClasses + '" data-coaches="' + course.coachs.map(coach => coach.name).join(',') + '">';

              if (isStartingSoon) {
                courseDisplay += '<div class="countdown-pill starting-soon" data-time-diff="' + Math.floor(timeDifference) + '"></div>';
              }

              courseDisplay += '<div class="course-info">' + courseNameDisplay + '</div>';
              courseDisplay += coachImagesHtml;
              courseDisplay += '</div>';

              html += courseDisplay;
            }
          }
          html += '</td>';
        }

        html += '</tr>';
      }
      html += '</tbody>';
      html += '</table>';

      return html;
    }

    /** Marque les noms de cours sur 2+ lignes (mobile) pour appliquer des marges réduites. */
    function markMultilineCourseNames() {
      requestAnimationFrame(function() {
        var els = document.querySelectorAll('.course-info .course-name-text');
        var lineHeightPx = 14;
        els.forEach(function(el) {
          if (el.scrollHeight > lineHeightPx + 4) {
            el.classList.add('multiline');
          } else {
            el.classList.remove('multiline');
          }
        });
      });
    }

    function scrollToCurrentTime() {
      setTimeout(() => {
        requestAnimationFrame(() => {
          const contentWrapper = document.querySelector('.content-wrapper');
          const scrollWrapper = document.getElementById('scheduleScrollWrapper');
          if (!contentWrapper) return;

          let targetRow = document.querySelector('.course-block.current')?.closest('tr');
          
          if (!targetRow) {
            targetRow = document.querySelector('.course-block.starting-soon')?.closest('tr');
          }
          
          if (!targetRow) {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinutes = now.getMinutes();
            const times = document.querySelectorAll('.time-cell');
            
            for (let i = 0; i < times.length; i++) {
              const timeText = times[i].textContent.trim();
              const [hour, minute] = timeText.split(':').map(Number);
              
              if (hour > currentHour || (hour === currentHour && minute >= currentMinutes)) {
                targetRow = times[i].parentElement;
                break;
              }
            }
          }

          if (targetRow) {
            const headerWrapper = document.querySelector('.header-wrapper');
            const thead = document.querySelector('.weekly-schedule thead');
            
            const headerHeight = headerWrapper ? headerWrapper.offsetHeight : 0;
            const theadHeight = thead ? thead.offsetHeight : 0;
            
            const targetPosition = targetRow.offsetTop - headerHeight - theadHeight - 10;
            
            setTimeout(() => {
              contentWrapper.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
              });
            }, 100);
          }

          /* Défilement horizontal : centrer le jour en cours */
          if (scrollWrapper) {
            var todayTh = document.querySelector('.weekly-schedule thead th.today');
            if (todayTh) {
              var targetLeft = todayTh.offsetLeft - (scrollWrapper.clientWidth / 2) + (todayTh.offsetWidth / 2);
              if (targetLeft < 0) targetLeft = 0;
              var maxLeft = scrollWrapper.scrollWidth - scrollWrapper.clientWidth;
              if (targetLeft > maxLeft) targetLeft = maxLeft;
              setTimeout(function() {
                scrollWrapper.scrollTo({
                  left: targetLeft,
                  behavior: 'smooth'
                });
              }, 300);
            }
          }
        });
      }, 500);
    }

    setInterval(scrollToCurrentTime, 900000);

    setInterval(function() {
      location.reload();
    }, 3600000);

    function checkCourseStates() {
      const now = new Date();
      const weekDays = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
      const currentDay = now.getDay();
      const currentDayName = weekDays[currentDay];
      const currentHour = now.getHours();
      const currentMinutes = now.getMinutes();
      const currentTimeInMinutes = currentHour * 60 + currentMinutes;

      const courseBlocks = document.querySelectorAll('.course-block');
      
      courseBlocks.forEach(block => {
        try {
          if (!block) return;

          const dayCell = block.closest('tr')?.querySelector('th');
          if (!dayCell) return;

          const dayName = dayCell.textContent?.trim();
          if (!dayName) return;
          
          if (dayName === currentDayName) {
            const timeCell = block.closest('tr')?.querySelector('.time-cell');
            if (!timeCell) return;

            const startTime = timeCell.textContent?.trim();
            if (!startTime) return;

            const [startHour, startMinute] = startTime.split(':').map(Number);
            const startTimeInMinutes = startHour * 60 + startMinute;
            
            const timeDifference = startTimeInMinutes - currentTimeInMinutes;
            
            const isStartingSoon = timeDifference >= 0 && timeDifference <= 15;
            const isInProgress = timeDifference < 0 && timeDifference > -60;
            
            if (isStartingSoon) {
              block.classList.add('starting-soon');
              block.classList.remove('current');
              let countdownPill = block.querySelector('.countdown-pill');
              if (!countdownPill) {
                countdownPill = document.createElement('div');
                countdownPill.className = 'countdown-pill starting-soon';
                block.insertBefore(countdownPill, block.firstChild);
              }
              countdownPill.setAttribute('data-time-diff', timeDifference * 60);
            } else if (isInProgress) {
              block.classList.add('current');
              block.classList.remove('starting-soon');
              const countdownPill = block.querySelector('.countdown-pill');
              if (countdownPill) {
                countdownPill.remove();
              }
            } else {
              block.classList.remove('starting-soon', 'current');
              const countdownPill = block.querySelector('.countdown-pill');
              if (countdownPill) {
                countdownPill.remove();
              }
            }
          } else {
            block.classList.remove('starting-soon', 'current');
            const countdownPill = block.querySelector('.countdown-pill');
            if (countdownPill) {
              countdownPill.remove();
            }
          }
        } catch (error) {
          console.error('Erreur lors de la vérification de l\'état du cours:', error);
        }
      });
    }

    // Fonction pour ouvrir/fermer la barre de filtres
    function toggleFiltersSidebar(event) {
      if (event) {
        event.stopPropagation();
        event.preventDefault();
      }
      const sidebar = document.getElementById('filtersSidebar');
      
      if (!sidebar) {
        console.error('Sidebar not found');
        return;
      }
      
      // Toggle la classe open pour ouvrir/fermer la barre
      sidebar.classList.toggle('open');
    }

    // Fermer la barre de filtres quand on clique ailleurs (mais pas sur le bouton ni la barre)
    document.addEventListener('click', function(event) {
      const sidebar = document.getElementById('filtersSidebar');
      const filterButton = document.querySelector('.filter-button');
      
      if (sidebar.classList.contains('open')) {
        // Si le clic n'est pas sur la barre de filtres ni sur le bouton
        if (!sidebar.contains(event.target) && !filterButton.contains(event.target)) {
          sidebar.classList.remove('open');
        }
      }
    });

    // Fonction pour retourner à aujourd'hui (redirige vers daily.html)
    function returnToToday() {
      window.location.href = './daily.html';
    }

    // Fonction pour aller vers weekly.html
    function goToWeekly() {
      window.location.href = './weekly.html';
    }

    // Animation de clic fiable au toucher sur le bouton rotation (mobile)
    (function initRotationButtonTapAnimation() {
      var el = document.getElementById('rotationViewButton');
      if (!el) return;
      function removeTapActive() {
        var target = el;
        setTimeout(function() { target.classList.remove('tap-active'); }, 320);
      }
      el.addEventListener('pointerdown', function() { el.classList.add('tap-active'); });
      el.addEventListener('pointerup', removeTapActive);
      el.addEventListener('pointerleave', removeTapActive);
      el.addEventListener('pointercancel', removeTapActive);
    })();

  </script>

</body>
</html>
